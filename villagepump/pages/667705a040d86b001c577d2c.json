{
  "id": "667705a040d86b001c577d2c",
  "title": "Cosenseの対話的なリストを階層スレッドに変換するプログラムを書いてみる",
  "created": 1719076267,
  "updated": 1719076920,
  "lines": [
    {
      "id": "667705a040d86b001c577d2c",
      "text": "Cosenseの対話的なリストを階層スレッドに変換するプログラムを書いてみる",
      "userId": "6619476365154e00252812e7",
      "created": 1719076267,
      "updated": 1719076375
    },
    {
      "id": "667708362812e70000b62787",
      "text": "[kawakami.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076918,
      "updated": 1719076920
    },
    {
      "id": "6677061b2812e70000b6271a",
      "text": "\t入力",
      "userId": "6619476365154e00252812e7",
      "created": 1719076380,
      "updated": 1719076400
    },
    {
      "id": "6677062c2812e70000b6271c",
      "text": "\t\tcode:input.txt",
      "userId": "6619476365154e00252812e7",
      "created": 1719076396,
      "updated": 1719076867
    },
    {
      "id": "667706602812e70000b6271f",
      "text": "\t\t\tこんちは[user1.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076448,
      "updated": 1719076500
    },
    {
      "id": "667706782812e70000b62721",
      "text": "\t\t\t\tようこそ！",
      "userId": "6619476365154e00252812e7",
      "created": 1719076473,
      "updated": 1719076477
    },
    {
      "id": "667706412812e70000b6271d",
      "text": "\t\t\t\tどうも！[user2.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076417,
      "updated": 1719076501
    },
    {
      "id": "6677067e2812e70000b62722",
      "text": "\t\t\t\t\tはじめまして[user1.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076479,
      "updated": 1719076503
    },
    {
      "id": "667706772812e70000b62720",
      "text": "\t出力",
      "userId": "6619476365154e00252812e7",
      "created": 1719076471,
      "updated": 1719076507
    },
    {
      "id": "6677069a2812e70000b62723",
      "text": "\t\tcode:output.json",
      "userId": "6619476365154e00252812e7",
      "created": 1719076507,
      "updated": 1719076859
    },
    {
      "id": "667706a92812e70000b62724",
      "text": "\t\t [",
      "userId": "6619476365154e00252812e7",
      "created": 1719076522,
      "updated": 1719076553
    },
    {
      "id": "667706ca2812e70000b6272b",
      "text": "\t\t \t{",
      "userId": "6619476365154e00252812e7",
      "created": 1719076555,
      "updated": 1719076555
    },
    {
      "id": "6677072b2812e70000b62736",
      "text": "\t\t \t\t\"id\": 1,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076652,
      "updated": 1719076655
    },
    {
      "id": "667706d32812e70000b6272e",
      "text": "\t\t \t\t\"author\": \"user1\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076564,
      "updated": 1719076591
    },
    {
      "id": "667706cd2812e70000b6272d",
      "text": "\t\t \t\t\"content\": \"こんちは\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076557,
      "updated": 1719076600
    },
    {
      "id": "667706f72812e70000b62731",
      "text": "\t\t \t\t\"parent\": null,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076600,
      "updated": 1719076606
    },
    {
      "id": "667707402812e70000b6273a",
      "text": "\t\t \t\t\"order\": 1",
      "userId": "6619476365154e00252812e7",
      "created": 1719076673,
      "updated": 1719076676
    },
    {
      "id": "667706cb2812e70000b6272c",
      "text": "\t\t \t},",
      "userId": "6619476365154e00252812e7",
      "created": 1719076555,
      "updated": 1719076595
    },
    {
      "id": "667706f32812e70000b6272f",
      "text": "\t\t \t{",
      "userId": "6619476365154e00252812e7",
      "created": 1719076595,
      "updated": 1719076596
    },
    {
      "id": "667707312812e70000b62737",
      "text": "\t\t \t\t\"id\": 2,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076657,
      "updated": 1719076662
    },
    {
      "id": "667707012812e70000b62733",
      "text": "\t\t \t  \"author\": \"user1\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076609,
      "updated": 1719076636
    },
    {
      "id": "6677071c2812e70000b62734",
      "text": " \t\t \t\t\"content\": \"ようこそ！\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076636,
      "updated": 1719076647
    },
    {
      "id": "6677071c2812e70000b62735",
      "text": " \t\t \t\t\"parent\": 1,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076636,
      "updated": 1719076666
    },
    {
      "id": "667707482812e70000b6273b",
      "text": " \t\t \t\t\"order\": 1,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076681,
      "updated": 1719076688
    },
    {
      "id": "667706f42812e70000b62730",
      "text": "\t\t \t},",
      "userId": "6619476365154e00252812e7",
      "created": 1719076596,
      "updated": 1719076668
    },
    {
      "id": "6677076f2812e70000b62741",
      "text": "\t\t \t{",
      "userId": "6619476365154e00252812e7",
      "created": 1719076720,
      "updated": 1719076720
    },
    {
      "id": "667707522812e70000b6273c",
      "text": "\t\t \t\t\"id\": 3,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076691,
      "updated": 1719076705
    },
    {
      "id": "667707572812e70000b6273d",
      "text": " \t\t \t  \"author\": \"user2\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076695,
      "updated": 1719076703
    },
    {
      "id": "667707572812e70000b6273e",
      "text": " \t\t \t\t\"content\": \"どうも！\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076695,
      "updated": 1719076710
    },
    {
      "id": "667707572812e70000b6273f",
      "text": " \t\t \t\t\"parent\": 1,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076695,
      "updated": 1719076715
    },
    {
      "id": "667707572812e70000b62740",
      "text": " \t\t \t\t\"order\": 2,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076695,
      "updated": 1719076716
    },
    {
      "id": "6677073d2812e70000b62739",
      "text": "\t\t \t},",
      "userId": "6619476365154e00252812e7",
      "created": 1719076669,
      "updated": 1719076731
    },
    {
      "id": "6677077b2812e70000b62742",
      "text": "\t\t \t{",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076732
    },
    {
      "id": "6677077c2812e70000b62743",
      "text": " \t\t \t\t\"id\": 4,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076741
    },
    {
      "id": "6677077c2812e70000b62744",
      "text": " \t\t \t  \"author\": \"user1\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076743
    },
    {
      "id": "6677077c2812e70000b62745",
      "text": " \t\t \t\t\"content\": \"はじめまして\",",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076752
    },
    {
      "id": "6677077c2812e70000b62746",
      "text": " \t\t \t\t\"parent\": 3,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076755
    },
    {
      "id": "6677077c2812e70000b62747",
      "text": " \t\t \t\t\"order\": 1,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076757
    },
    {
      "id": "6677077c2812e70000b62748",
      "text": " \t\t \t}",
      "userId": "6619476365154e00252812e7",
      "created": 1719076732,
      "updated": 1719076734
    },
    {
      "id": "667706c82812e70000b6272a",
      "text": "\t\t ]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076553,
      "updated": 1719076554
    },
    {
      "id": "667706c02812e70000b62728",
      "text": "\t[Claude 3.5 Sonnet]を使ってみる",
      "userId": "6619476365154e00252812e7",
      "created": 1719076545,
      "updated": 1719076795
    },
    {
      "id": "667707ee2812e70000b6274a",
      "text": "\t\tcode:sonnet_1.ts",
      "userId": "6619476365154e00252812e7",
      "created": 1719076847,
      "updated": 1719076877
    },
    {
      "id": "6677080d2812e70000b6274b",
      "text": "\t\t interface Message {",
      "userId": "6619476365154e00252812e7",
      "created": 1719076877,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6274c",
      "text": "       id: number;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6274d",
      "text": "       author: string | null;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6274e",
      "text": "       content: string;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6274f",
      "text": "       parent: number | null;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62750",
      "text": "       order: number;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62751",
      "text": "   }",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62752",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62753",
      "text": "   function parseCosense(text: string): Message[] {",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62754",
      "text": "       const lines = text.trim().split('\\n');",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62755",
      "text": "       const messages: Message[] = [];",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62756",
      "text": "       const stack: { indent: number; id: number }[] = [];",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62757",
      "text": "       let currentId = 1;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62758",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62759",
      "text": "       lines.forEach((line) => {",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275a",
      "text": "           const indent = line.length - line.trimLeft().length;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275b",
      "text": "           let content = line.trim();",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275c",
      "text": "           ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275d",
      "text": "           const authorMatch = content.match(/\\[([^\\]]+)\\.icon\\]/);",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275e",
      "text": "           const author = authorMatch ? authorMatch[1] : null;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6275f",
      "text": "           content = content.replace(/\\[([^\\]]+)\\.icon\\]/, '').trim();",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62760",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62761",
      "text": "           while (stack.length > 0 && stack[stack.length - 1].indent >= indent) {",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62762",
      "text": "               stack.pop();",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62763",
      "text": "           }",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62764",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62765",
      "text": "           const parent = stack.length > 0 ? stack[stack.length - 1].id : null;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62766",
      "text": "           const order = messages.filter(m => m.parent === parent).length + 1;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62767",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62768",
      "text": "           messages.push({",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62769",
      "text": "               id: currentId,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276a",
      "text": "               author,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276b",
      "text": "               content,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276c",
      "text": "               parent,",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276d",
      "text": "               order",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276e",
      "text": "           });",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6276f",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62770",
      "text": "           stack.push({ indent, id: currentId });",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62771",
      "text": "           currentId++;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62772",
      "text": "       });",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62773",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62774",
      "text": "       return messages;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62775",
      "text": "   }",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62776",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62777",
      "text": "   function convertCosenseToJson(input: string): string {",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62778",
      "text": "       const messages = parseCosense(input);",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62779",
      "text": "       return JSON.stringify(messages, null, 2);",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277a",
      "text": "   }",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277b",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277c",
      "text": "   // 使用例",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277d",
      "text": "   const input = `",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277e",
      "text": "   こんちは[user1.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b6277f",
      "text": "       ようこそ！",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62780",
      "text": "       どうも！[user2.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62781",
      "text": "           はじめまして[user1.icon]",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62782",
      "text": "   `;",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62783",
      "text": "   ",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677080e2812e70000b62784",
      "text": "   console.log(convertCosenseToJson(input));",
      "userId": "6619476365154e00252812e7",
      "created": 1719076878,
      "updated": 1719076878
    },
    {
      "id": "6677082e2812e70000b62785",
      "text": "\t\t動かしてみる",
      "userId": "6619476365154e00252812e7",
      "created": 1719076910,
      "updated": 1719076915
    },
    {
      "id": "667708322812e70000b62786",
      "text": "",
      "userId": "6619476365154e00252812e7",
      "created": 1719076915,
      "updated": 1719076915
    }
  ]
}