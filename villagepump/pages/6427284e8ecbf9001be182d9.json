{
  "id": "6427284e8ecbf9001be182d9",
  "title": "scrapbox-url-customizer",
  "created": 1680287823,
  "updated": 1680288997,
  "lines": [
    {
      "id": "6427284e8ecbf9001be182d9",
      "text": "scrapbox-url-customizer",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6601",
      "text": "from [2023/03/29]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6602",
      "text": "scrapbox-url-customizer",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6603",
      "text": "[/takker/takker99/scrapbox-url-customizer]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6604",
      "text": " 作った意味なかったかな……と少し思ったが、返信先tweetや引用tweetを取り込めるようになったから上位互換だった",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6605",
      "text": "  くそ！やられた！(演技)[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6606",
      "text": "  やったぜ[takker.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6607",
      "text": " [基素.icon]さんに先越されてちょっとくやしかった",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6608",
      "text": "  powered by [GPT-4.icon]だから…[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6609",
      "text": "  GPT使いこなせないせいでcodingが遅い……[takker.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660a",
      "text": "  人間にしては早いと思います[gpt-4.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660b",
      "text": " [https://gyazo.com/20f7f72c2fc8d13f7f06835e841db2c9.mp4]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660c",
      "text": " やったこと",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660d",
      "text": "  [/motoso/Tweetを取り込むPopup menu v2#64187b11774b170000ac5800]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660e",
      "text": "   やったー[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c660f",
      "text": "  [scrapbox-url-customizer]からは設計を完全に書き換えた",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6610",
      "text": "  　[外部リンク記法に変換するscript]ではなく、URLを任意の文字列に変換するscriptに汎用化した",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6611",
      "text": "   　余計なURL parametersを除去したり、短縮URLを展開したりするのにも使える",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6612",
      "text": "   　　いいね！[nishio.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6613",
      "text": "   code:設計の解説のつもり.ts",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6614",
      "text": "    const promise = convert(",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6615",
      "text": "      // 変換したい文字列もしくはURL object",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6616",
      "text": "      text,",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6617",
      "text": "      // 変換処理",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6618",
      "text": "      // 上から順に適用される",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6619",
      "text": "      // 非同期処理も可能",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661a",
      "text": "      (url: URL) => { /* ... */ },",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661b",
      "text": "      (url: URL) =>",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661c",
      "text": "        url.pathname.endsWith(\".pdf\") ?",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661d",
      "text": "          // 文字列を返すと、その文字列で対象のURLが置換され、以降の変換処理は実行されない",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661e",
      "text": "          `[pdf ${url}]` :",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c661f",
      "text": "          // URLで返すと、次の変換処理にそれが渡される",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6620",
      "text": "          url,",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6621",
      "text": "      // ...",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6622",
      "text": "    )",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6623",
      "text": "    ",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6624",
      "text": "    // すべての変換が同期で終わるとstringに、一つでも非同期で変換処理が走ったらPromise<string>になる",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6625",
      "text": "    const convertedText = promise instanceof Promise ? await promise : promise;",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6626",
      "text": "    ",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6627",
      "text": "   コアとなる`convert`は[Scrapboxのtweet埋め込み]とは全く関係ない",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6628",
      "text": "   変換処理のサンプルとして[Scrapboxのtweet埋め込み]や[ScrapboxのURLタイトル埋め込み]を提供している",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6629",
      "text": "    https://github.com/takker99/scrapbox-url-customizer/tree/main/middlewares",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662a",
      "text": "    [ScrapboxのURLタイトル埋め込み]の方は、[GM_fetch]がないとき[api/embed-text/url]にfallbackする",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662b",
      "text": "     https://github.com/takker99/scrapbox-url-customizer/blob/main/middlewares/formatURL.ts",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662c",
      "text": "    [Scrapboxのtweet埋め込み]は[GM_fetch]のみを使っている",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662d",
      "text": "     https://github.com/takker99/scrapbox-url-customizer/blob/main/middlewares/formatTweet.ts",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662e",
      "text": "     ✅[- [api/embed-text/twitter]][- は動いていないので使わなかった……のだが復活したらしい][.- [- [2023/03/29#6423843732ef920000370ef9]][-  ]]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c662f",
      "text": "      [- 書き直すか……]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6630",
      "text": "      [done https://github.com/takker99/scrapbox-url-customizer/pull/4]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6631",
      "text": "     引用tweetと返信先tweetのみを一緒に展開している",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6632",
      "text": "      thread中のすべてのtweetを展開するコードの記述は読者の課題とする",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6633",
      "text": "     gyazoにuploadする機能を実装し忘れてた",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6634",
      "text": "     　読者の課題とする",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6635",
      "text": "     　 [証明は読者に任せる]よくない()[yosider.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6636",
      "text": "     　 99%の読者がやらないやつ[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6637",
      "text": "     　 書きたくなってきた[takker.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6638",
      "text": "     　 code:ts",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6639",
      "text": "        import { upload, UploadResult } from \"../../takker/deno-gyazo/mod.ts\";",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663a",
      "text": "        import { getGyazoToken } from \"../../takkerscrapbox-userscript-std/rest.ts\";",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663b",
      "text": "        ",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663c",
      "text": "        const accessToken = token ?? await (async () => {",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663d",
      "text": "          const result = await getGyazoToken();",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663e",
      "text": "          if (!result.ok) throw new Error(JSON.stringify(result.value));",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c663f",
      "text": "          const accessToken = result.value;",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6640",
      "text": "          if (!accessToken) throw new Error(\"Could not get the access token\");",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6641",
      "text": "          return accessToken;",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6642",
      "text": "        })();",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6643",
      "text": "        ",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6644",
      "text": "        const image = await (await GM_fetch(url)).blob();",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6645",
      "text": "        const result = await upload(image, { refererURL: twitterURL, accessToken });",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6646",
      "text": "        if (!result.ok) throw result.value;",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6647",
      "text": "        const gyazoURL = result.value.permalink_url;",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6648",
      "text": "       あきた",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6649",
      "text": "       まあこのあたりのsnippetを",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664a",
      "text": "        [https://code2svg.vercel.app/svg/L95-96/https://raw.githubusercontent.com/takker99/scrapbox-url-customizer/0.1.2/middlewares/formatTweet.ts#.svg https://github.com/takker99/scrapbox-url-customizer/blob/0.1.2/middlewares/formatTweet.ts#L95-L96]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664b",
      "text": "       に挿入すれば動くと思います(適当)",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664c",
      "text": "    その他、t.coの展開などの処理をサンプルとして置いてある",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664d",
      "text": "  詳しい書き方等は、例によって[API reference https://doc.deno.land/https://raw.githubusercontent.com/takker99/scrapbox-url-customizer/main/mod.ts]を参照してください",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664e",
      "text": "  サンプルコード",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c664f",
      "text": "   [[https://code2svg.vercel.app/svg/https://raw.githubusercontent.com/takker99/scrapbox-url-customizer/main/examples/popup.ts#.svg https://github.com/takker99/scrapbox-url-customizer/blob/main/examples/popup.ts]]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6650",
      "text": "   同期変換、つまりfetchせずに変換が終了したときは、即座に文字列置換が走るようになっている",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6651",
      "text": "    [https://gyazo.com/44c798aa41ee218cbcbb40927a0ed31a]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "6427284e774b1700009c6652",
      "text": "",
      "userId": "59fb21121207900012774b17",
      "created": 1680287823,
      "updated": 1680287823
    },
    {
      "id": "64272878774b1700009c6653",
      "text": "",
      "userId": "59fb21121207900012774b17",
      "created": 1680287865,
      "updated": 1680287865
    },
    {
      "id": "64272878774b1700009c6654",
      "text": "[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1680287865,
      "updated": 1680287865
    },
    {
      "id": "64272879774b1700009c6655",
      "text": "　使ってみたいけどScrapboxで利用するための初期設定がまだわかっていない",
      "userId": "59fb21121207900012774b17",
      "created": 1680287865,
      "updated": 1680288971
    },
    {
      "id": "64272ccc774b1700009c665b",
      "text": "　　[scrapbox-url-customizer#6427284e774b1700009c664f]のimportはこのままでは動かないので適切にしないといけない",
      "userId": "59fb21121207900012774b17",
      "created": 1680288972,
      "updated": 1680288997
    },
    {
      "id": "64272885774b1700009c6657",
      "text": "　code:mod.ts",
      "userId": "59fb21121207900012774b17",
      "created": 1680287877,
      "updated": 1680287877
    },
    {
      "id": "64272885774b1700009c6658",
      "text": "  export * from \"https://raw.githubusercontent.com/takker99/scrapbox-url-customizer/0.1.2/mod.ts\";",
      "userId": "59fb21121207900012774b17",
      "created": 1680287877,
      "updated": 1680287877
    },
    {
      "id": "64272887774b1700009c6659",
      "text": " これでmodを読み込んで[scrapbox-url-customizer#6427284e774b1700009c664f]みたいな感じで書いていくのかな",
      "userId": "59fb21121207900012774b17",
      "created": 1680287879,
      "updated": 1680287964
    },
    {
      "id": "64272879774b1700009c6656",
      "text": " githubのdepsに依存しているからそのままだと読めない気がする",
      "userId": "59fb21121207900012774b17",
      "created": 1680287865,
      "updated": 1680288556
    },
    {
      "id": "64272b1e774b1700009c665a",
      "text": "",
      "userId": "59fb21121207900012774b17",
      "created": 1680288542,
      "updated": 1680288542
    }
  ]
}