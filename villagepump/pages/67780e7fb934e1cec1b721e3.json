{
  "id": "67780e7fb934e1cec1b721e3",
  "title": "TamperMonkeyでUserScript一式を未参加のprojectでも使う",
  "created": 1735921726,
  "updated": 1735921908,
  "lines": [
    {
      "id": "67780e7fb934e1cec1b721e3",
      "text": "TamperMonkeyでUserScript一式を未参加のprojectでも使う",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921726,
      "updated": 1735921726
    },
    {
      "id": "6778103e71b3c2000040d48d",
      "text": "[bsahd.icon]",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921726,
      "updated": 1735921727
    },
    {
      "id": "6778104771b3c2000040d4bf",
      "text": "\t.user.jsにするとインストールしやすい",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921736,
      "updated": 1735921836
    },
    {
      "id": "6778106c71b3c2000040d4c1",
      "text": "[/takker/TamperMonkeyでScrapBubbleを使う]の修正版です",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921772,
      "updated": 1735921787
    },
    {
      "id": "6778103e71b3c2000040d48f",
      "text": "code:script.user.js",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921727,
      "updated": 1735921772
    },
    {
      "id": "6778104571b3c2000040d490",
      "text": " // ==UserScript==",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921733,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d491",
      "text": " // @name         TamperMonkeyでUserScript一式を未参加のprojectでも使う",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921871
    },
    {
      "id": "6778104571b3c2000040d492",
      "text": " // @namespace    https://scrapbox.io",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d493",
      "text": " // @version      0.5",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921878
    },
    {
      "id": "6778104571b3c2000040d494",
      "text": " // @description  TamperMonkeyでUserScript一式を未参加のprojectでも使う",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921876
    },
    {
      "id": "6778104571b3c2000040d495",
      "text": " // @author       bsahd and takker",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921821
    },
    {
      "id": "6778104571b3c2000040d496",
      "text": " // @downloadURL  https://scrapbox.io/api/code/villagepump/TamperMonkeyでUserScript一式を未参加のprojectでも使う/script.user.js",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921850
    },
    {
      "id": "6778104571b3c2000040d497",
      "text": " // @updateURL  https://scrapbox.io/api/code/villagepump/TamperMonkeyでUserScript一式を未参加のprojectでも使う/script.user.js",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921849
    },
    {
      "id": "6778104571b3c2000040d498",
      "text": " // @match        https://scrapbox.io/*",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d499",
      "text": " // @exclude      https://scrapbox.io/settings",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49a",
      "text": " // @license      MIT",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49b",
      "text": " // @copyright    Copyright (C) 2025 bsahd and takker; This software is a modified version of the original software licensed under the MIT License. Original Copyright (c) 2021 takker.",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49c",
      "text": " // ==/UserScript==",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49d",
      "text": " /*",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49e",
      "text": " 改変部分",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d49f",
      "text": " 読み込み方法: dynamic importからDOMによるscriptタグの挿入に変更",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a0",
      "text": " グローバル変数scrapboxへのアクセス方法: unsafeWindowを使用しないと本体ドキュメントのグローバルにアクセスできないようになったので修正",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a1",
      "text": " fetch: \"https://scrapbox.io\"を追加しないと\"TypeError: /api/projects is not a valid URL.\"がエラー表示で出るので修正",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a2",
      "text": " インターバル間隔: 1000msから100msに変更し、ページ読み込み後すぐスクリプトを読み込めるようにした",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a3",
      "text": " 雑に1000ms待つ場所を消した",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a4",
      "text": " */",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a5",
      "text": " window.addEventListener(\"load\", async () => {",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a6",
      "text": "     // #editorが読み込まれるまで待機",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a7",
      "text": "     // cf. https://scrapbox.io/scrapbox-drinkup/puppeteerでscrapboxを自動化してイテレーション資料を宣言的に完成させる_(2019%2F9%2F5)",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a8",
      "text": "     await new Promise(resolve => {",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4a9",
      "text": "         let timer = null;",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4aa",
      "text": "         timer = setInterval(() => {",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4ab",
      "text": "             if (!document.getElementById('editor')) return;",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4ac",
      "text": "             clearInterval(timer);",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4ad",
      "text": "             resolve();",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4ae",
      "text": "         }, 100);",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4af",
      "text": "     });",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b0",
      "text": "     const res = await fetch('https://scrapbox.io/api/projects');",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b1",
      "text": "     const { projects } = await res.json();",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b2",
      "text": "     if (projects.map(({ name }) => name).includes(unsafeWindow.scrapbox.Project.name)) {",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b3",
      "text": "         console.info(`You belong to \"/${unsafeWindow.scrapbox.Project.name}\".`);",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b4",
      "text": "         return;",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b5",
      "text": "     }",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b6",
      "text": "     console.info(`You don't belong to \"/${unsafeWindow.scrapbox.Project.name}\".  Loading Userscripts via TamperMonkey...`);",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b7",
      "text": " ",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b8",
      "text": "     const script = document.createElement(\"script\");",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4b9",
      "text": "     script.type = \"module\";",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4ba",
      "text": "     script.async = true;",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4bb",
      "text": "     script.crossorigin=\"use-credentials\";",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4bc",
      "text": "     script.src = \"\"; // UserScriptの読み込み元",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921908
    },
    {
      "id": "6778104571b3c2000040d4bd",
      "text": "     document.head.appendChild(script)",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778104571b3c2000040d4be",
      "text": " }, { once: true });",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921734,
      "updated": 1735921734
    },
    {
      "id": "6778103e71b3c2000040d48e",
      "text": "",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1735921727,
      "updated": 1735921727
    }
  ]
}