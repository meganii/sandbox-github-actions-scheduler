{
  "id": "643bc128fa948c001c3932bc",
  "title": "chatGPTとchatするUserScript",
  "created": 1681637685,
  "updated": 1683466784,
  "lines": [
    {
      "id": "643bc128fa948c001c3932bc",
      "text": "chatGPTとchatするUserScript",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637685,
      "updated": 1681637685
    },
    {
      "id": "6457a192774b170000ed1c41",
      "text": "これは何をするためにつくられたものなんだろう？[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1683464595,
      "updated": 1683464643
    },
    {
      "id": "6457a46e5f1e0d0000e0810a",
      "text": "　[AskChatGPT]では返答が来るまで思考がストップされる感じが嫌だったので自動入力してくれないかなと思い作ったやつです[wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683465326,
      "updated": 1683465452
    },
    {
      "id": "6457a4eb5f1e0d0000e0810b",
      "text": "　　Notion AIがそこそこ便利だと思ったので案を置いておきたかった",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683465452,
      "updated": 1683465487
    },
    {
      "id": "6457aa0d774b170000d903a1",
      "text": "　Scrapbox上でChatするってことか〜[基素.icon]",
      "userId": "59fb21121207900012774b17",
      "created": 1683466765,
      "updated": 1683466784
    },
    {
      "id": "6457a192774b170000ed1c42",
      "text": "",
      "userId": "59fb21121207900012774b17",
      "created": 1683464595,
      "updated": 1683464595
    },
    {
      "id": "64566ade5f1e0d0000f15388",
      "text": "使い方",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385055,
      "updated": 1683385057
    },
    {
      "id": "64566ae15f1e0d0000f15389",
      "text": "　導入すると青いボタンが行ごとに出るので実行しちゃってください",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385057,
      "updated": 1683385085
    },
    {
      "id": "64566b375f1e0d0000f1538c",
      "text": "　 行の下に返答が挿入されます",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385143,
      "updated": 1683385153
    },
    {
      "id": "64566aff5f1e0d0000f1538b",
      "text": "　[** 多分]並列処理できます",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385087,
      "updated": 1683385126
    },
    {
      "id": "6456d6561280f000004c869b",
      "text": "　なるほどー。行ごとにコメントかけるってことかあ[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412567,
      "updated": 1683412593
    },
    {
      "id": "6456d6711280f000004c869c",
      "text": "　 自分のもこのUIで試してみるか",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412594,
      "updated": 1683412606
    },
    {
      "id": "64566ae15f1e0d0000f1538a",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385058,
      "updated": 1683385058
    },
    {
      "id": "643bc10b5f1e0d0000550a43",
      "text": "既知のバグ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637685,
      "updated": 1683420647
    },
    {
      "id": "6456f5e85f1e0d00003f6e1e",
      "text": " ボタンを押した後すぐに下の行を編集するとinsertされない",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683420648,
      "updated": 1683420677
    },
    {
      "id": "6456f6065f1e0d00003f6e1f",
      "text": "  下の行に依存して挿入しているため",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683420677,
      "updated": 1683420688
    },
    {
      "id": "64570f521280f0000093f432",
      "text": " リンクやアイコンを含む行にボタンが表示されない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427155,
      "updated": 1683427175
    },
    {
      "id": "64570f671280f0000093f433",
      "text": "  修正したコードはStreamのゴミ箱にある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427176,
      "updated": 1683427195
    },
    {
      "id": "643bc1445f1e0d0000550a47",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637742,
      "updated": 1681637745
    },
    {
      "id": "643bc3265f1e0d0000550a9a",
      "text": "もう[ChatGPTのAPIの無料期間]終わってるから試せない！誰か試して(投げやり)[wogikaze.icon*2]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681638224,
      "updated": 1683426938
    },
    {
      "id": "643bc3275f1e0d0000550a9b",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681638225,
      "updated": 1681638225
    },
    {
      "id": "643bc1475f1e0d0000550a48",
      "text": "必要",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637745,
      "updated": 1683384793
    },
    {
      "id": "645669d75f1e0d00003f6e1b",
      "text": " [AskChatGPT](の[TamperMonkey]部分)をtamperMonkeyに導入する",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683384792,
      "updated": 1683384792
    },
    {
      "id": "645669d45f1e0d00003f6e1a",
      "text": " [このリンク https://scrapbox-bundler.vercel.app/?url=https://scrapbox.io/api/code/villagepump/chatGPTとchatするUserScript/sc.js&run&reload&minify&bundle]でbundleした以下のコードを自分のページに貼り付ける",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683384788,
      "updated": 1683384798
    },
    {
      "id": "64566ad75f1e0d0000f15387",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683385048,
      "updated": 1683385048
    },
    {
      "id": "643bc10c5f1e0d0000550a44",
      "text": " code:sc.js",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637687,
      "updated": 1681637785
    },
    {
      "id": "643bc1ad5f1e0d0000550a8a",
      "text": "  import { joinPageRoom } from \"https://raw.githubusercontent.com/takker99/scrapbox-headless-script/0.3.1/mod.ts\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637847,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dd6",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456d68b1280f000004c869e",
      "text": " [scrapbox-headless-script]はもうメンテしてないので、[scrapbox-userscript-std]のほうを使ってほしいです[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412619,
      "updated": 1683412637
    },
    {
      "id": "6456f57d5f1e0d00003f6e1c",
      "text": "  insertメソッドがあれば使いたかったのですがサポートしないと書いてあったので",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683420541,
      "updated": 1683429036
    },
    {
      "id": "645716ab5f1e0d00009fa74f",
      "text": "  (ついでに[wogikaze.icon]の技術力的に実装できないなーと思い)こうなりました[wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683429036,
      "updated": 1683429049
    },
    {
      "id": "64570e651280f0000093f41f",
      "text": "   あれそんなこと書いてましたっけ？何も覚えていない()[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683426918,
      "updated": 1683426942
    },
    {
      "id": "645715d95f1e0d00009fa74c",
      "text": "   [/takker/✅JoinPageRoom()からpatch()以外の編集関数を消#620619311280f00000e04c5f]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683428825,
      "updated": 1683465128
    },
    {
      "id": "6457a3a71280f000003acd53",
      "text": "    使い道あったじゃん！[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465128,
      "updated": 1683465138
    },
    {
      "id": "6457a3b11280f000003acd54",
      "text": "     想像力が足りない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465138,
      "updated": 1683465142
    },
    {
      "id": "645716205f1e0d00009fa74d",
      "text": "   [/takker/📝roomを使わずにページ編集する#6204baff1280f00000d87d32]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683428896,
      "updated": 1683428898
    },
    {
      "id": "6456f5b75f1e0d00003f6e1d",
      "text": "  -stdの方で実装できますかね...",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683420598,
      "updated": 1683420626
    },
    {
      "id": "64570e831280f0000093f420",
      "text": "  `patch()`だと、特定行の下に挿入するコードを書くのが確かにめんどいですね[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683426948,
      "updated": 1683426987
    },
    {
      "id": "64570eef1280f0000093f430",
      "text": "   こうなる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427056,
      "updated": 1683427058
    },
    {
      "id": "64570eaa1280f0000093f421",
      "text": "   code:ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683426987,
      "updated": 1683427015
    },
    {
      "id": "64570ec61280f0000093f422",
      "text": "    await patch(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427015
    },
    {
      "id": "64570ec61280f0000093f423",
      "text": "      project,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427019
    },
    {
      "id": "64570ec61280f0000093f424",
      "text": "      title,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427019
    },
    {
      "id": "64570ec61280f0000093f425",
      "text": "      (lines) => lines.reduce((acc, cur) => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427022
    },
    {
      "id": "64570ec61280f0000093f426",
      "text": "        acc.push(cur.text);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427025
    },
    {
      "id": "64570ec61280f0000093f427",
      "text": "        if (cur.id === id) acc.push(...additionalLines);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427042
    },
    {
      "id": "64570ec61280f0000093f42d",
      "text": "        return acc;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427045
    },
    {
      "id": "64570ec61280f0000093f42e",
      "text": "      }, [] as string[]),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427015,
      "updated": 1683427050
    },
    {
      "id": "64570eeb1280f0000093f42f",
      "text": "    );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427052,
      "updated": 1683427053
    },
    {
      "id": "6457163c5f1e0d00009fa74e",
      "text": "   試してないのであれですがpatchだとpatchが終了する前に行を更新したら更新分が消えませんか？[wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683428925,
      "updated": 1683429021
    },
    {
      "id": "6457a3de1280f000003acd55",
      "text": "   ①から②の間で別の編集が入った場合、最初からやり直しになります[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465183,
      "updated": 1683465350
    },
    {
      "id": "6457a3f71280f000003acd57",
      "text": "    サーバからcommit idを取得(①)→`updator`で変更後の本文を生成→変更前後で差分をとってサーバに送信する(②)",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465208,
      "updated": 1683465295
    },
    {
      "id": "6457a4641280f000003acd58",
      "text": "   そのため、途中で行を更新されても、その更新を考慮して差分を作成できます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465316,
      "updated": 1683465395
    },
    {
      "id": "6457a4b21280f000003acd59",
      "text": "   `patch(project, title, () => [title, \"aaa\", \"bbb\"])`のような常に同じ本文を返すと更新が消えてしまいますが、今回のコードは変更前の本文をそのまま維持するため、更新分が消えることはないと思います",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683465395,
      "updated": 1683465489
    },
    {
      "id": "6456d6881280f000004c869d",
      "text": " code:sc.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412617,
      "updated": 1683412618
    },
    {
      "id": "6456652e5f1e0d00003f6dd7",
      "text": "  function updateButtonStyle(button, lineElement, indent) {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dd8",
      "text": "    const head = lineElement.getElementsByClassName(\"indent\")[0]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dd9",
      "text": "      ?? lineElement.getElementsByClassName(\"char-index\")[0];",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dda",
      "text": "    const offset = lineElement.getBoundingClientRect().left;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6ddb",
      "text": "    const left = indent === 0 ? offset : head.getBoundingClientRect().left;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6ddc",
      "text": "    button.style.left = `calc(${Math.round(left - offset)}px - ${lineElement.getElementsByClassName(\"code-body\").length > 0 ? 2.0 : 1.0}em)`;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6ddd",
      "text": "  }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dde",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6ddf",
      "text": "  async function onButtonClick(lineElement) { // async を追加",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de0",
      "text": "    const result = await askChatGPT(lineElement.innerText.trimStart()); // await を追加",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de1",
      "text": "    let answer;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de2",
      "text": "    if (!result.error) {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de3",
      "text": "      answer = result.choices[0].message.content.trim();",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de4",
      "text": "    } else {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de5",
      "text": "      answer = \"test\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de6",
      "text": "    }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de7",
      "text": "    const { insert, cleanup } = await joinPageRoom(scrapbox.Project.name, scrapbox.Page.title);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de8",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6de9",
      "text": "    const nextLineElement = lineElement.nextElementSibling;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dea",
      "text": "    if (nextLineElement) {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6deb",
      "text": "      await insert(lineElement.textContent.match(/^\\s*/)[0].replace(/\\t/g,\" \")+\" \"+answer, nextLineElement.id.slice(1));",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683384569
    },
    {
      "id": "6456652e5f1e0d00003f6dec",
      "text": "    } else {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6ded",
      "text": "      await insert(lineElement.textContent.match(/^\\s*/)[0].replace(/\\t/g,\" \")+\" \"+answer, \"_end\");",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683384573
    },
    {
      "id": "6456652e5f1e0d00003f6dee",
      "text": "    }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6def",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df0",
      "text": "    cleanup();",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df1",
      "text": "  }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df2",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df3",
      "text": "  function renderButton() {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df4",
      "text": "    if (scrapbox.Layout !== \"page\") return;",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df5",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df6",
      "text": "    scrapbox.Page.lines.forEach(line => {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df7",
      "text": "      const lineElement = document.querySelector(`#L${line.id}`);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df8",
      "text": "      let button = lineElement.querySelector(\"a\");",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6df9",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dfa",
      "text": "      if (button) {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dfb",
      "text": "        if (line.text.trim() === \"\") {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dfc",
      "text": "          button.style.display = \"none\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dfd",
      "text": "        } else {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dfe",
      "text": "          button.style.display = \"inline\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6dff",
      "text": "          updateButtonStyle(button, lineElement, lineElement.indent);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e00",
      "text": "        }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e01",
      "text": "      } else if (line.text.trim() !== \"\") {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e02",
      "text": "        button = document.createElement(\"a\");",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e03",
      "text": "        button.type = \"button\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e04",
      "text": "        button.style.position = \"absolute\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e05",
      "text": "        button.style.fontSize = \"20px\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e06",
      "text": "        button.style.zIndex = \"200\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e07",
      "text": "        updateButtonStyle(button, lineElement, lineElement.indent);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456e4cd1280f000004c884a",
      "text": " `HTMLElement.indent`ってなんだろう[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683416269,
      "updated": 1683416282
    },
    {
      "id": "6456e4d91280f000004c884c",
      "text": "  このようなpropertyは生えていないはず",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683416282,
      "updated": 1683416291
    },
    {
      "id": "6456f61a5f1e0d00003f6e20",
      "text": "  確かにない、なんで動いているんだ(困惑)[wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683420697,
      "updated": 1683420818
    },
    {
      "id": "64570f001280f0000093f431",
      "text": "  [/vim-jp-emojis/こわわ.icon][takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683427073,
      "updated": 1683427135
    },
    {
      "id": "6456e4d01280f000004c884b",
      "text": " code:sc.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683416273,
      "updated": 1683416273
    },
    {
      "id": "6456652e5f1e0d00003f6e08",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e09",
      "text": "        button.addEventListener(\"click\", () => onButtonClick(lineElement));",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0a",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0b",
      "text": "        const icon = document.createElement(\"i\");",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0c",
      "text": "        icon.className = \"fas fa-caret-down\";",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0d",
      "text": "  ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0e",
      "text": "        button.append(icon);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e0f",
      "text": "        lineElement.insertAdjacentElement(\"afterbegin\", button);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e10",
      "text": "      }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e11",
      "text": "    });",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e12",
      "text": "  }",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e13",
      "text": "  const start = Date.now();",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e14",
      "text": "  // 処理",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e15",
      "text": "  renderButton();",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e16",
      "text": "  scrapbox.addListener(\"lines:changed\", renderButton);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e17",
      "text": "  const end = Date.now();",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456652e5f1e0d00003f6e18",
      "text": "  console.log(`ButtonのRenderingにかかった時間: ${end - start}ミリ秒`);",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1683383597,
      "updated": 1683383597
    },
    {
      "id": "6456d6a81280f000004c869f",
      "text": " [scrapbox.Page.lines]は行数が多い時UIをブロックする[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412649,
      "updated": 1683412740
    },
    {
      "id": "6456d6ff1280f000004c86a1",
      "text": "  cf. [/takker/✅scrapbox.Page.linesと同等のデータをshallow copyして返す関数を作る]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412735,
      "updated": 1683412739
    },
    {
      "id": "6456d6ef1280f000004c86a0",
      "text": "  performanceのことを考え始めるときには、別の方法を使うといいかも",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683412721,
      "updated": 1683412748
    },
    {
      "id": "643bc1615f1e0d0000550a49",
      "text": " code:fetch.js",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637771,
      "updated": 1681637805
    },
    {
      "id": "643bc1845f1e0d0000550a5d",
      "text": "  // ==UserScript==",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a5e",
      "text": "   // @name         Fetch ChatGPT",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1683383570
    },
    {
      "id": "643bc1845f1e0d0000550a5f",
      "text": "   // @namespace    http://tampermonkey.net/",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a60",
      "text": "   // @version      0.1",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a61",
      "text": "   // @description  try to take over the world!",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a62",
      "text": "   // @author       You",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a63",
      "text": "   // @match        https://scrapbox.io/*",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a64",
      "text": "   // @icon         https://www.google.com/s2/favicons?sz=64&domain=scrapbox.io",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a65",
      "text": "   // @grant        GM_xmlhttpRequest",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a66",
      "text": "   // ==/UserScript==",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a67",
      "text": "   ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a68",
      "text": "   unsafeWindow.askChatGPT = async (",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a69",
      "text": "     text,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6a",
      "text": "     { temperature = 0.7, max_tokens = 500 } = {}",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6b",
      "text": "   ) => {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6c",
      "text": "     const headers = {",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6d",
      "text": "       \"Content-Type\": \"application/json\",",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6e",
      "text": "       Authorization: \"Bearer \" + localStorage.getItem(\"OPENAI_KEY\"),",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a6f",
      "text": "     };",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a70",
      "text": "     const data = JSON.stringify({",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a71",
      "text": "       temperature,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a72",
      "text": "       max_tokens,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a73",
      "text": "       model: \"gpt-3.5-turbo\",",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a74",
      "text": "       messages: [{ role: \"user\", content: text }],",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a75",
      "text": "     });",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a76",
      "text": "   ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a77",
      "text": "     return await new Promise((resolve, reject) =>",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a78",
      "text": "       GM_xmlhttpRequest({",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a79",
      "text": "         method: \"POST\",",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7a",
      "text": "         url: \"https://api.openai.com/v1/chat/completions\",",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7b",
      "text": "         data,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7c",
      "text": "         headers,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7d",
      "text": "         onload: ({ response }) =>",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7e",
      "text": "           resolve({",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a7f",
      "text": "             ...response,",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a80",
      "text": "           }),",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a81",
      "text": "         responseType: \"json\",",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a82",
      "text": "         onerror: (e) => reject(e),",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a83",
      "text": "       })",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a84",
      "text": "     );",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc1845f1e0d0000550a85",
      "text": "   };",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637806,
      "updated": 1681637806
    },
    {
      "id": "643bc17b5f1e0d0000550a5c",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1681637797,
      "updated": 1681637797
    },
    {
      "id": "6456d8151280f000004c86a2",
      "text": "[chatGPTとchatするUserScript (takker)]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683413013,
      "updated": 1683413017
    },
    {
      "id": "6456d8151280f000004c86a3",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1683413014,
      "updated": 1683413014
    }
  ]
}