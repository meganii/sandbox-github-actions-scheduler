{
  "id": "625bcc90c515bc001df4e0da",
  "title": "ScrapboxでRubyを動かす",
  "created": 1650183326,
  "updated": 1650184245,
  "lines": [
    {
      "id": "625bcc90c515bc001df4e0da",
      "text": "ScrapboxでRubyを動かす",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183326,
      "updated": 1650183326
    },
    {
      "id": "625bcc9f1280f00000abfa79",
      "text": "[ruby-head-wasm-wasi]を使って[Scrapbox]で[Ruby]を動かしてみる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183326,
      "updated": 1650183950
    },
    {
      "id": "625bccac1280f00000abfa7b",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183339,
      "updated": 1650183339
    },
    {
      "id": "625bce4c1280f00000abfb1d",
      "text": "お試し",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183755,
      "updated": 1650183756
    },
    {
      "id": "625bce4a1280f00000abfb1c",
      "text": " 以下のコードを開発コンソールに貼り付けてる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183752,
      "updated": 1650183772
    },
    {
      "id": "625bce5d1280f00000abfb1e",
      "text": " [/rubyonbrowser/マインスイーパ風に文字をランダムに並べる]のコードを拝借した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183772,
      "updated": 1650183772
    },
    {
      "id": "625bcde21280f00000abfab5",
      "text": " code:js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183649,
      "updated": 1650183754
    },
    {
      "id": "625bcdeb1280f00000abfab6",
      "text": "  await (async () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183658,
      "updated": 1650183754
    },
    {
      "id": "625bcdf61280f00000abfab8",
      "text": "    const { run } = await import(\"/api/code/villagepump/ScrapboxでRubyを動かす/script.js\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183669,
      "updated": 1650183754
    },
    {
      "id": "625bce2a1280f00000abfabb",
      "text": "    const result = await run(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183722,
      "updated": 1650183901
    },
    {
      "id": "625bce371280f00000abfb03",
      "text": "  `9.times do |x|",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce371280f00000abfb04",
      "text": "    9.times do |y|",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce371280f00000abfb05",
      "text": "      print [\"⬜\", \"🚩\", \"💣\"].sample",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce371280f00000abfb06",
      "text": "    end",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce371280f00000abfb07",
      "text": "    puts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce371280f00000abfb08",
      "text": "  end`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183734,
      "updated": 1650183754
    },
    {
      "id": "625bce401280f00000abfb0a",
      "text": "    );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183743,
      "updated": 1650183754
    },
    {
      "id": "625bcee11280f00000572014",
      "text": "    alert(result);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183904,
      "updated": 1650183908
    },
    {
      "id": "625bcdf21280f00000abfab7",
      "text": "  })();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183665,
      "updated": 1650183754
    },
    {
      "id": "625bcde11280f00000abfab4",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183648,
      "updated": 1650183648
    },
    {
      "id": "625bd0301280f0000020b493",
      "text": "動かないもの",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650184239,
      "updated": 1650184245
    },
    {
      "id": "625bd0331280f0000020b494",
      "text": " [/rubyonbrowser/File APIのサンプルコードがそのまま動く]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650184242,
      "updated": 1650184242
    },
    {
      "id": "625bd0301280f0000020b492",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650184239,
      "updated": 1650184239
    },
    {
      "id": "625bccac1280f00000abfa7c",
      "text": "code:script.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183339,
      "updated": 1650183343
    },
    {
      "id": "625bccb11280f00000abfa7d",
      "text": " import { DefaultRubyVM } from \"../../takker-dist/ruby-head-wasm-wasi-min/mod.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183343,
      "updated": 1650183408
    },
    {
      "id": "625bccf11280f00000abfa7e",
      "text": " const wasmURL = \"https://scrapbox.io/files/625bbaf10357fa001dfe6e98.wasm\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183561
    },
    {
      "id": "625bcd8a1280f00000abfaac",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183561,
      "updated": 1650183561
    },
    {
      "id": "625bccf11280f00000abfa7f",
      "text": " // Fetch and instntiate WebAssembly binary",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183408
    },
    {
      "id": "625bccf11280f00000abfa80",
      "text": " const response = await fetch(wasmURL);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183566
    },
    {
      "id": "625bccf11280f00000abfa83",
      "text": " const buffer = await response.arrayBuffer();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183408
    },
    {
      "id": "625bccf11280f00000abfa84",
      "text": " const module = await WebAssembly.compile(buffer);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183408
    },
    {
      "id": "625bccf11280f00000abfa85",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183408
    },
    {
      "id": "625bce111280f00000abfab9",
      "text": " export const run = async (code) => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183696,
      "updated": 1650183822
    },
    {
      "id": "625bccf11280f00000abfa86",
      "text": "   // この辺 Rudy on Browserの真似",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa87",
      "text": "   const outputBuffer = [];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa88",
      "text": "   const stdout = (line) => outputBuffer.push(line);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa8c",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa8d",
      "text": "   const { vm } = await DefaultRubyVM(module, {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa8e",
      "text": "     consolePrint: true,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa8f",
      "text": "     consoleHandler: { 1: stdout, 2: stdout },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa90",
      "text": "   });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa91",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa92",
      "text": "   vm.printVersion();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bcd2c1280f00000abfa9f",
      "text": "   try {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183467,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa93",
      "text": "     const result = vm.eval(code);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183710
    },
    {
      "id": "625bccf11280f00000abfa9b",
      "text": "     if (outputBuffer.length === 0) return result.toString();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183408,
      "updated": 1650183893
    },
    {
      "id": "625bcdc91280f00000abfab2",
      "text": "     return outputBuffer.join(\"\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183623,
      "updated": 1650183887
    },
    {
      "id": "625bcd9f1280f00000abfaad",
      "text": "   } catch(e) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183582,
      "updated": 1650183710
    },
    {
      "id": "625bcdab1280f00000abfaaf",
      "text": "     if (e instanceof Error) throw e;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183594,
      "updated": 1650184190
    },
    {
      "id": "625bcffe1280f0000020b491",
      "text": "     return e;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650184190,
      "updated": 1650184191
    },
    {
      "id": "625bcda41280f00000abfaae",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183587,
      "updated": 1650183710
    },
    {
      "id": "625bcdd61280f00000abfab3",
      "text": " };",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183637,
      "updated": 1650183711
    },
    {
      "id": "625bce201280f00000abfaba",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183711,
      "updated": 1650183711
    },
    {
      "id": "625bcca01280f00000abfa7a",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1650183327,
      "updated": 1650183327
    }
  ]
}