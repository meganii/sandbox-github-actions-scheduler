{
  "id": "65bc9793e3dece0026ede3bd",
  "title": "ScrapRun",
  "created": 1706858399,
  "updated": 1706860987,
  "lines": [
    {
      "id": "65bc9793e3dece0026ede3bd",
      "text": "ScrapRun",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858399,
      "updated": 1706858399
    },
    {
      "id": "65bc979e1280f000003d34bc",
      "text": "[コードブロック記法]に書いたものをPreviewする汎用UserScript",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858399,
      "updated": 1706858449
    },
    {
      "id": "65bc9eb11280f000003d355d",
      "text": " https://github.com/takker99/ScrapRun",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860211,
      "updated": 1706860212
    },
    {
      "id": "65bc97c11280f000003d34be",
      "text": " [/takker/ScrapRun]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858434,
      "updated": 1706858438
    },
    {
      "id": "65bc97dd1280f000003d34c3",
      "text": "少し前に[ScrapboxのMermaid記法preview]が導入されたが、あれを他の記法もサポートするよう拡張したものと捉えていい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858462,
      "updated": 1706858504
    },
    {
      "id": "65bc97d41280f000003d34c0",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858453,
      "updated": 1706858453
    },
    {
      "id": "65bc98721280f000003d34ca",
      "text": "動作例",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858611,
      "updated": 1706858613
    },
    {
      "id": "65bc98921280f000003d34cb",
      "text": " [TikZ], [SVG], [GLSL], [PlantUML]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858643,
      "updated": 1706858687
    },
    {
      "id": "65bc98921280f000003d34cc",
      "text": "  [https://gyazo.com/ea18169ee7493b2f2886f3178d6053f8]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858643,
      "updated": 1706858651
    },
    {
      "id": "65bc98931280f000003d34cd",
      "text": "  [https://gyazo.com/64ff48f5c85f737963013d08cf3e1896]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858644,
      "updated": 1706859254
    },
    {
      "id": "65bc9b211280f000003d3523",
      "text": "  [https://gyazo.com/f3cfdb5aa4e4ddf2d7f1a9b933c35eb8]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859299,
      "updated": 1706859299
    },
    {
      "id": "65bc9af51280f000003d3520",
      "text": "  [https://gyazo.com/464f96d9b30f97fdf6e10380fbecd210]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859254,
      "updated": 1706859265
    },
    {
      "id": "65bc9b201280f000003d3522",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859297,
      "updated": 1706859297
    },
    {
      "id": "65bc98131280f000003d34c4",
      "text": "[https://img.shields.io/github/v/release/takker99/ScrapRun?display_name=tag&sort=semver#.svg]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858516,
      "updated": 1706859507
    },
    {
      "id": "65bc98131280f000003d34c5",
      "text": "使い方",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858516,
      "updated": 1706858518
    },
    {
      "id": "65bc99761280f000003d34d6",
      "text": " very easy ver.",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858871,
      "updated": 1706858880
    },
    {
      "id": "65bc9a681280f000003d34f4",
      "text": "  [https://scrapbox-bundler.vercel.app?url=https://scrapbox.io/api/code/villagepump/ScrapRun/very-easy.ts&bundle&minify&run&reload ここ]をクリックして生成されたコードを自分のページの`script.js`に貼り付けてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859114,
      "updated": 1706859207
    },
    {
      "id": "65bc9a8f1280f000003d3505",
      "text": " TikZも使いたい人ver.",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859152,
      "updated": 1706859152
    },
    {
      "id": "65bc9c031280f000003ae792",
      "text": "  1. [https://scrapbox-bundler.vercel.app/?url=https://raw.githubusercontent.com/takker99/ScrapRun/0.3.1/previewers/TikZ/worker.ts&bundle&minify&run&reload ここ]をクリックして生成されたコードを、適当なページの適当なコードブロックに[* 複数回に分けて]貼り付けてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859525,
      "updated": 1706859706
    },
    {
      "id": "65bc9c8c1280f000003ae794",
      "text": "   コピペ一回では貼りきれないコードサイズなので、複数回に分けてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859662,
      "updated": 1706859682
    },
    {
      "id": "65bc9ca11280f000003ae795",
      "text": "   面倒な場合は、とりあえずhttps://scrapbox.io/api/code/takker-dist/scrapbox-tikz/mod.js を使ってもいいです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859682,
      "updated": 1706859702
    },
    {
      "id": "65bc9cbc1280f000003ae796",
      "text": "   以降、`/project/worker`の`mod.js`に貼り付けたとします",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859709,
      "updated": 1706859734
    },
    {
      "id": "65bc9d951280f000003d3551",
      "text": "  2. 以下のURLの`\"https://scrapbox.io/api/code/takker-dist/scrapbox-tikz/mod.js\"`を`\"https://scrapbox.io/api/code/project/worker/mod.js\"`に書き換えてアクセスしてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859926,
      "updated": 1706860001
    },
    {
      "id": "65bc9d911280f000003d3550",
      "text": "   $ https://scrapbox-bundler.vercel.app/?url=https://scrapbox.io/api/code/villagepump/ScrapRun/with-tikz.ts&define=WORKER_URL:\"https://scrapbox.io/api/code/takker-dist/scrapbox-tikz/mod.js\"&define=ASSETS_URL:\"https://scrapbox.io/files/65b701e5197ff10023e9b9ae\"&bundle&minify&run&reload",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859922,
      "updated": 1706859929
    },
    {
      "id": "65bc9de21280f000003d3552",
      "text": "  3. 生成されたコードを自分のページの`script.js`に貼り付けてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860003,
      "updated": 1706860010
    },
    {
      "id": "65bc9a931280f000003d3513",
      "text": " installation",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859157,
      "updated": 1706860052
    },
    {
      "id": "65bc9e1a1280f000003d3554",
      "text": "  [* ⚠ScrapRunだけでは何も動きません]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860059,
      "updated": 1706860060
    },
    {
      "id": "65bc9e1b1280f000003d3555",
      "text": "   コードブロックの中身をどうpreviewするかは、各自で実装する必要がある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860060,
      "updated": 1706860060
    },
    {
      "id": "65bc9e1b1280f000003d3556",
      "text": "   Userが自由にpreviewerを作れるよう設計しているため",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860060,
      "updated": 1706860060
    },
    {
      "id": "65bc9e1d1280f000003d3557",
      "text": "   すぐに使えるよう、[TikZ], [SVG], [GLSL], [PlantUML]のreference実装を同じrepoに用意してあります",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860063,
      "updated": 1706860095
    },
    {
      "id": "65bc9a931280f000003d3514",
      "text": "  TikZのpreviewer以外はいつもの[takker.icon]製UserScriptと要領は同じです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859157,
      "updated": 1706859157
    },
    {
      "id": "65bc9a931280f000003d3515",
      "text": "  TikZのpreviewerはweb workerを使っているため、worker codeもbuildする必要があります",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859157,
      "updated": 1706859157
    },
    {
      "id": "65bc9b331280f000003d353e",
      "text": "  code:with-tikz.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d353f",
      "text": "   import { setup, previewSVG, previewGLSL, previewPlantUML, previewTikZ } from \"https://raw.githubusercontent.com/takker99/ScrapRun/0.3.1/mod.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3540",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3541",
      "text": "   setup({ previewers: [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3542",
      "text": "     { when: /(?:^|\\.)svg$/, preview: previewSVG },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3543",
      "text": "     { when: /(?:^|\\.)glsl$/, preview: previewGLSL },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3544",
      "text": "     { when: /(?:^|\\.)(?:plantuml|puml|pu)$/, preview: previewPlantUML },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d3545",
      "text": "     { when: /(?:^|\\.)tikz\\(tex\\)$/, preview: previewTikZ(WORKER_URL, ASSETS_URL) },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859885
    },
    {
      "id": "65bc9b331280f000003d3549",
      "text": "   ]});",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9b331280f000003d354a",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859316,
      "updated": 1706859316
    },
    {
      "id": "65bc9a931280f000003d3516",
      "text": "  `previewers`(型：`Previewer[]`)に使いたいpreviewerの設定を書く",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859157,
      "updated": 1706859353
    },
    {
      "id": "65bc9b491280f000003d354b",
      "text": "  `Previewer`の`when`に指定した正規表現に一致するファイルネームのコードブロックに対して、`preview`を実行する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859338,
      "updated": 1706859390
    },
    {
      "id": "65bc9e5a1280f000003d355a",
      "text": "  `previewTikZ`にはworker codeのURLと、texのwasmやpackages,フォントデータを圧縮したzipファイルへのURLを渡す必要がある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860123,
      "updated": 1706860164
    },
    {
      "id": "65bc9e9d1280f000003d355b",
      "text": " Previewerの作成方法",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860190,
      "updated": 1706860197
    },
    {
      "id": "65bc9ee31280f000003d355f",
      "text": "  `preview`の型定義は以下の通り",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860261,
      "updated": 1706860270
    },
    {
      "id": "65bc9ed81280f000003d355e",
      "text": "   [https://code2svg.vercel.app/svg/https://raw.githubusercontent.com/takker99/ScrapRun/0.3.1/preview.ts#.svg https://github.com/takker99/ScrapRun/blob/0.3.1/preview.ts]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860249,
      "updated": 1706860272
    },
    {
      "id": "65bc9eef1280f000003d3560",
      "text": "  引数にコードブロックの`filename`と、更新前のコードブロック情報`before`、更新後のコードブロック情報`after`が渡される",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860272,
      "updated": 1706860318
    },
    {
      "id": "65bc9f861280f000003d3563",
      "text": "   コードブロックを https://github.com/takker99/ScrapRun/blob/0.3.1/codeBlock.ts にある`content`函数に通すと、同名のコードブロックの中身を全て連結した文字列を取得できる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860423,
      "updated": 1706860486
    },
    {
      "id": "65bc9f1d1280f000003d3561",
      "text": "  `Preview`内で表示するDOMを組み立てたあと、`render`にわたして描画する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860318,
      "updated": 1706860360
    },
    {
      "id": "65bc9f471280f000003d3562",
      "text": "  cleanup函数を返却できる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860360,
      "updated": 1706860382
    },
    {
      "id": "65bc9df71280f000003d3553",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860024,
      "updated": 1706860030
    },
    {
      "id": "65bca0a31280f000003d356a",
      "text": "reference実装の技術概要",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860708,
      "updated": 1706860750
    },
    {
      "id": "65bca0b11280f000003d356b",
      "text": " SVG：Data URLにして`<img>`に表示しているだけ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860723,
      "updated": 1706860743
    },
    {
      "id": "65bca0ce1280f000003d356c",
      "text": " PlantUML：[PlantUML server]用のURLを作って`<img>`に埋め込む",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860752,
      "updated": 1706860777
    },
    {
      "id": "65bca0e81280f000003d356d",
      "text": " GLSL：[GlslCanvas]で描画",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860777,
      "updated": 1706860786
    },
    {
      "id": "65bca0f11280f000003d356e",
      "text": " TikZ：Web Workerで[TikZJax]を動かして作ったSVGをData URLにして`<img>`で表示",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860786,
      "updated": 1706860828
    },
    {
      "id": "65bca18e1280f00000de8f92",
      "text": "  画像を右クリックしてダウンロードできる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860943,
      "updated": 1706860957
    },
    {
      "id": "65bca19e1280f00000de8f93",
      "text": "  システムカラーを認識してlight theme/dark themeが勝手に変わるように作ってある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860959,
      "updated": 1706860987
    },
    {
      "id": "65bca0a21280f000003d3569",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860708,
      "updated": 1706860708
    },
    {
      "id": "65bc9fd01280f000003d3564",
      "text": "[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860497,
      "updated": 1706860501
    },
    {
      "id": "65bc9fd41280f000003d3565",
      "text": " さすがに[ScrapboxのMermaid記法preview]に比べるとUXが甘い部分があるものの、十分使えている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860501,
      "updated": 1706860536
    },
    {
      "id": "65bc9ff71280f000003d3566",
      "text": " TikZのpreviewが死ぬほど便利",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860536,
      "updated": 1706860550
    },
    {
      "id": "65bca0051280f000003d3567",
      "text": "  日本語圏で主流のLuaLaTeXはcompileが遅いので、TikZのrendering結果を確認するのにかなり時間がかかり、try and errorを素早く回せない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860550,
      "updated": 1706860611
    },
    {
      "id": "65bca0421280f000003d3568",
      "text": "  [scrapbox-TikZjax](TIkZのpreviewerの名前)は複雑な3D plotを使わない限り一瞬でrenderingされるため、編集速度をと同じ速さでrendering結果を確認できる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706860611,
      "updated": 1706860700
    },
    {
      "id": "65bc9a9d1280f000003d351f",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859166,
      "updated": 1706859166
    },
    {
      "id": "65bc9a8d1280f000003d34fd",
      "text": "code:very-easy.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d34fe",
      "text": " import { setup, previewSVG, previewGLSL, previewPlantUML } from \"https://raw.githubusercontent.com/takker99/ScrapRun/0.3.1/mod.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d34ff",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d3500",
      "text": " setup({ previewers: [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d3501",
      "text": "   { when: /(?:^|\\.)svg$/, preview: previewSVG },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d3502",
      "text": "   { when: /(?:^|\\.)glsl$/, preview: previewGLSL },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d3503",
      "text": "   { when: /(?:^|\\.)(?:plantuml|puml|pu)$/, preview: previewPlantUML },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc9a8d1280f000003d3504",
      "text": " ]});",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706859150,
      "updated": 1706859164
    },
    {
      "id": "65bc98e91280f000003d34d3",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858730,
      "updated": 1706858730
    },
    {
      "id": "65bc98c61280f000003d34d0",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1706858696,
      "updated": 1706858696
    }
  ]
}