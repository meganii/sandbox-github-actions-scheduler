{
  "id": "63ff60f6b2d9c7001bd8d42e",
  "title": "LlamaIndex",
  "created": 1677680889,
  "updated": 1677910535,
  "lines": [
    {
      "id": "63ff60f6b2d9c7001bd8d42e",
      "text": "LlamaIndex",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680889,
      "updated": 1677680889
    },
    {
      "id": "63ff73aaaff09e0000e441dd",
      "text": "[nishio.icon]雑な解説:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685675,
      "updated": 1677685685
    },
    {
      "id": "63ff7319aff09e0000e441d7",
      "text": " GPT3に、学習時に使われていないデータを参考資料としてプロンプトに含めることで",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685529,
      "updated": 1677685690
    },
    {
      "id": "63ff72cbaff09e0000e441d6",
      "text": " 　学習時に存在しなかった最新の情報",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685451,
      "updated": 1677685711
    },
    {
      "id": "63ff73d9aff09e0000e441df",
      "text": " 　電子書籍などの著作権的にインターネット上でアクセス可能にできないデータ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685721,
      "updated": 1677685791
    },
    {
      "id": "63ff73f2aff09e0000e441e0",
      "text": " 　グループウェアの中の顧客コンタクト履歴のデータなど社外に公開できないもの",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685746,
      "updated": 1677685781
    },
    {
      "id": "63ff7395aff09e0000e441da",
      "text": " 〜をGPT3が使うことができるようになる仕組み",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685654,
      "updated": 1677685802
    },
    {
      "id": "63ff73a8aff09e0000e441db",
      "text": "　典型的な利用法:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685672,
      "updated": 1677685913
    },
    {
      "id": "63ff7448aff09e0000e441e1",
      "text": "　　手元の文書からOpenAI APIで埋め込みベクトルを作る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685832,
      "updated": 1677685883
    },
    {
      "id": "63ff7466aff09e0000e441e2",
      "text": "　　クエリー文章に対して、関連のある文書をベクトル検索で見つける",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685862,
      "updated": 1677685892
    },
    {
      "id": "63ff7484aff09e0000e441e3",
      "text": "　　その文書をGPT3へのプロンプトに埋め込む",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685892,
      "updated": 1677685909
    },
    {
      "id": "63ff73a8aff09e0000e441dc",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685672,
      "updated": 1677685672
    },
    {
      "id": "63ff73b7aff09e0000e441de",
      "text": "[https://note.com/npaka/n/n8c3867a55837 LlamaIndex クイックスタートガイド｜npaka｜note]",
      "userId": "59fb21121207900012774b17",
      "created": 1677685687,
      "updated": 1677910503
    },
    {
      "id": "6402e1e7774b1700005bcdb5",
      "text": " ぼっち・ざ・ろっく！のあらすじを用意して対話的に知識を質問するサンプル",
      "userId": "59fb21121207900012774b17",
      "created": 1677910503,
      "updated": 1677910531
    },
    {
      "id": "6402e202774b1700005bcdb6",
      "text": " ほぼ数行で終わっている",
      "userId": "59fb21121207900012774b17",
      "created": 1677910531,
      "updated": 1677910535
    },
    {
      "id": "63ff7322aff09e0000e441d8",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685539,
      "updated": 1677685539
    },
    {
      "id": "63ff7291aff09e00000fb06d",
      "text": "旧名称 [GPTIndex]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685394,
      "updated": 1677685403
    },
    {
      "id": "63ff728eaff09e00000fb06c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677685391,
      "updated": 1677685391
    },
    {
      "id": "63ff60f9aff09e0000bde227",
      "text": "LlamaIndexのコードを読む[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680889,
      "updated": 1677682576
    },
    {
      "id": "63ff60f9aff09e0000bde228",
      "text": "　LlamaIndexのNodeの単位をどうやって制御するのか[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680921
    },
    {
      "id": "63ff60f9aff09e0000bde229",
      "text": "　\thttps://github.com/jerryjliu/gpt_index/blob/main/gpt_index/readers/file/base.py",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde22a",
      "text": "\t　\tこれは単にファイルを読んでDocumentを返してるだけ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680893
    },
    {
      "id": "63ff60f9aff09e0000bde22b",
      "text": "　\thttps://github.com/jerryjliu/gpt_index/blob/main/gpt_index/readers/string_iterable.py",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde22c",
      "text": "　\t　これは文字列のリストを個別にDocumentにしてる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680943
    },
    {
      "id": "63ff6135aff09e0000e441cc",
      "text": "　\tトークン数を数えるのにはこれを使ってる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680949,
      "updated": 1677680967
    },
    {
      "id": "63ff60f9aff09e0000bde22d",
      "text": "　　\t`tiktoken.get_encoding(\"gpt2\")`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680969
    },
    {
      "id": "63ff614aaff09e0000e441cd",
      "text": "　　\tGPT2から変わってないのか",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680970,
      "updated": 1677680979
    },
    {
      "id": "63ff60f9aff09e0000bde22e",
      "text": "　　GPTIndexを作る際に勝手にドキュメントを結合してしまう？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680986
    },
    {
      "id": "63ff6159aff09e0000e441ce",
      "text": "　　　DocumentStoreの中身が1個になっちゃう？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680986,
      "updated": 1677681004
    },
    {
      "id": "63ff60f9aff09e0000bde22f",
      "text": "　　　ノードが分かれてるからちゃんとそのノードだけ読むようだ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677681006
    },
    {
      "id": "63ff60f9aff09e0000bde232",
      "text": "　断片にインデックスをつけて類似度top Kをプロンプトに積むのができるようになったのでクオリアさんの過去発言データを整備すれば...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677681037
    },
    {
      "id": "63ff60f9aff09e0000bde233",
      "text": "　`def get_queued_text_embeddings(self) -> Tuple[List[str], List[List[float]]]:`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677681043
    },
    {
      "id": "63ff60f9aff09e0000bde235",
      "text": "\t\t`OpenAIEmbedding#get_embedding`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde236",
      "text": "\t\t[https://platform.openai.com/docs/guides/embeddings/what-are-embeddings OpenAI API: Embeddings]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff67c9aff09e0000e441d4",
      "text": "\t\tこの辺が最終的に呼ばれるのだろう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682633,
      "updated": 1677682643
    },
    {
      "id": "63ff67d4aff09e0000e441d5",
      "text": "\t流れがあやふやなので頭から[pdb]で追う",
      "userId": "5c30ba88e98efe0017e5172d",
      "created": 1677682645,
      "updated": 1677684579
    },
    {
      "id": "63ff60f9aff09e0000bde237",
      "text": " `GPTVectorStoreIndex`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde238",
      "text": "\t\t`BaseGPTIndex`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde239",
      "text": "\t\t\tここで`OpenAIEmbedding`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff60f9aff09e0000bde23a",
      "text": "\t\t\t\tdefault: \"text-embedding-ada-002\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677680890,
      "updated": 1677680890
    },
    {
      "id": "63ff61c0aff09e0000bde23b",
      "text": "   \t\tそうなのか〜",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681088,
      "updated": 1677681111
    },
    {
      "id": "63ff61ccaff09e0000bde23e",
      "text": "    - OpenAIEmbeddingMode.SIMILARITY_MODE",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681100,
      "updated": 1677681100
    },
    {
      "id": "63ff61c0aff09e0000bde23c",
      "text": "    - OpenAIEmbeddingMode.TEXT_SEARCH_MODE",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681089,
      "updated": 1677681095
    },
    {
      "id": "63ff61c0aff09e0000bde23d",
      "text": "\t    TEXT_SEARCH_MODEがdefault",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681089,
      "updated": 1677681121
    },
    {
      "id": "63ff61dfaff09e0000bde23f",
      "text": "\t\t\t`self.build_index_from_documents(documents)`が呼ばれる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681119,
      "updated": 1677681362
    },
    {
      "id": "63ff62d2aff09e0000e441d0",
      "text": "\t\t\tそこの先は`_build_index_from_documents`が`@abstractmethod`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681363,
      "updated": 1677681394
    },
    {
      "id": "63ff629daff09e0000bde240",
      "text": "　　　で子クラスに戻る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681310,
      "updated": 1677681413
    },
    {
      "id": "63ff6408aff09e0000bde241",
      "text": "　　`self._use_async` default: Falseなので",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681673,
      "updated": 1677681696
    },
    {
      "id": "63ff640faff09e0000bde242",
      "text": " 　　code:py",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681680,
      "updated": 1677681708
    },
    {
      "id": "63ff6422aff09e0000bde243",
      "text": "    for d in documents:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681699,
      "updated": 1677681708
    },
    {
      "id": "63ff6423aff09e0000bde244",
      "text": "        self._add_document_to_index(index_struct, d)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681699,
      "updated": 1677681708
    },
    {
      "id": "63ff6423aff09e0000bde245",
      "text": "\t\t\t`self._get_node_embedding_results(...)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681699,
      "updated": 1677681778
    },
    {
      "id": "63ff6472aff09e0000bde247",
      "text": "\t\tcode:py",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681778,
      "updated": 1677681797
    },
    {
      "id": "63ff6485aff09e0000bde248",
      "text": "   def _get_node_embedding_results(",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681798,
      "updated": 1677681804
    },
    {
      "id": "63ff6486aff09e0000bde249",
      "text": "       self, nodes: List[Node], existing_node_ids: Set, doc_id: str",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681798,
      "updated": 1677681804
    },
    {
      "id": "63ff6486aff09e0000bde24a",
      "text": "   ) -> List[NodeEmbeddingResult]:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681798,
      "updated": 1677681804
    },
    {
      "id": "63ff6486aff09e0000bde24b",
      "text": "\t\t各nodeのtextをqueueに入れてから",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681798,
      "updated": 1677681971
    },
    {
      "id": "63ff6532aff09e0000bde24c",
      "text": "\t\t\t`result_ids, result_embeddings = self._embed_model.get_queued_text_embeddings()`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681971,
      "updated": 1677681971
    },
    {
      "id": "63ff6464aff09e0000bde246",
      "text": "\t\t\tここで`OpenAIEmbedding`に処理が移る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677681765,
      "updated": 1677682261
    },
    {
      "id": "63ff65d6aff09e0000e441d2",
      "text": " \t\t\tおっと違った`BaseEmbedding`の`get_queued_text_embeddings`だ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682135,
      "updated": 1677682352
    },
    {
      "id": "63ff65fcaff09e0000bde24f",
      "text": "  \t\t\tこれが`embeddings = self._get_text_embeddings(cur_batch_texts)`する",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682172,
      "updated": 1677682352
    },
    {
      "id": "63ff6619aff09e0000bde250",
      "text": "  \t\t\tで、もちろん`_get_text_embeddings`が`OpenAIEmbedding`でオーバーライドされてるわけだ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682202,
      "updated": 1677682352
    },
    {
      "id": "63ff6667aff09e0000e441d3",
      "text": "  \t\t\t　だいぶ著者の気持ちが読めるようになってきたw",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682280,
      "updated": 1677682352
    },
    {
      "id": "63ff66b1aff09e0000bde251",
      "text": "  \t\t`OpenAIEmbedding#_get_text_embeddings`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682354,
      "updated": 1677682362
    },
    {
      "id": "63ff6589aff09e0000bde24e",
      "text": "\t\t\t\t\t`embeddings = get_embeddings(texts, engine=engine)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682058,
      "updated": 1677682425
    },
    {
      "id": "63ff6703aff09e0000bde253",
      "text": "\t\t\t\t\t\t`get_embeddings`の中でOpenAIを呼んでる",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682435,
      "updated": 1677682457
    },
    {
      "id": "63ff657baff09e0000bde24d",
      "text": "\t　\t\t\t\t\t`data = openai.Embedding.create(input=list_of_text, engine=engine).data`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682043,
      "updated": 1677682458
    },
    {
      "id": "63ff66fcaff09e0000bde252",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677682429,
      "updated": 1677682429
    },
    {
      "id": "63ff7ddaaff09e0000f7c06f",
      "text": "`index.query`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688282,
      "updated": 1677688287
    },
    {
      "id": "63ff7dd3aff09e0000f7c06d",
      "text": "\t`BaseGPTIndex#query`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688276,
      "updated": 1677688288
    },
    {
      "id": "63ff7de0aff09e0000f7c070",
      "text": "\t\t`return query_runner.query(query_str, self._index_struct)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688289,
      "updated": 1677688311
    },
    {
      "id": "63ff7df7aff09e0000f7c071",
      "text": "\t\t\t`/gpt_index/indices/query/query_runner.py`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688312,
      "updated": 1677688366
    },
    {
      "id": "63ff7dd4aff09e0000f7c06e",
      "text": "\t\t\t\t`return query_obj.query(query_bundle)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688277,
      "updated": 1677688408
    },
    {
      "id": "63ff7f28aff09e0000f7c074",
      "text": "\t\t\t\t\t`/gpt_index/indices/query/base.py`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688617,
      "updated": 1677688618
    },
    {
      "id": "63ff7e58aff09e0000f7c073",
      "text": "\t\t\t\t\t`BaseGPTIndexQuery`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688409,
      "updated": 1677688598
    },
    {
      "id": "63ff7e55aff09e0000f7c072",
      "text": "\t\t\t\t\t`def _query(self, query_bundle: QueryBundle) -> Response:`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688406,
      "updated": 1677688682
    },
    {
      "id": "63ff7ff5aff09e0000f7c076",
      "text": "\t\t\t\t\t`tuples = self.get_nodes_and_similarities_for_response(query_bundle)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688822,
      "updated": 1677688822
    },
    {
      "id": "63ff815daff09e0000f7c079",
      "text": "\t\t\t\t\t\tここで類似度に基づく検索をしている",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689182,
      "updated": 1677689198
    },
    {
      "id": "63ff7ff7aff09e0000f7c077",
      "text": "\t\t\t\t\t\t`[(Node(text='56: Have Presence of Mind.\\n...', doc_id='a8e898fd-...', embedding=None, extra_info=None, index=0, child_indices=set(), ref_doc_id='a51e3fc7-...', node_info={'start': 0, 'end': 602}), 0.800589425093737)]`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688823,
      "updated": 1677688868
    },
    {
      "id": "63ff7f68aff09e0000f7c075",
      "text": "\t\t\t\t\t`text, response = self._get_text_from_node(query_bundle, node)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677688681,
      "updated": 1677689150
    },
    {
      "id": "63ff813caff09e0000f7c078",
      "text": "\t\t\t\t\t なぜ`_get_text_from_node`が`response`を返す？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689149,
      "updated": 1677689176
    },
    {
      "id": "63ff8102aff09e0000cda202",
      "text": "\t\t\t\t\t\t　recursiveのとき、リクエストを発行することがあるから",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689090,
      "updated": 1677689176
    },
    {
      "id": "63ff8184aff09e0000cda203",
      "text": "\t\t\t\t\t\t　今回の場合はしないのでNoneが返る",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689220,
      "updated": 1677689231
    },
    {
      "id": "63ff81c7aff09e0000f7c07a",
      "text": "\t\t\t\t\t`response_str = self._give_response_for_nodes(query_bundle.query_str)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689288,
      "updated": 1677689290
    },
    {
      "id": "63ff8287aff09e0000f7c07c",
      "text": "\t\t\t\t\t\t`response = self.response_builder.get_response(...)`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689479,
      "updated": 1677689488
    },
    {
      "id": "63ff81cbaff09e0000f7c07b",
      "text": "\t\t\t\t\t\t`ResponseBuilder`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689292,
      "updated": 1677689427
    },
    {
      "id": "63ff8101aff09e0000cda201",
      "text": "\t\t\t\t\t\t\t`give_response_single`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689089,
      "updated": 1677689654
    },
    {
      "id": "63ff8334aff09e0000f7c07d",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1677689653,
      "updated": 1677689653
    }
  ]
}