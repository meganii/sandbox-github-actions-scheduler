{
  "id": "648144713aa6cb001c415db2",
  "title": "time-mirror",
  "created": 1686193267,
  "updated": 1686430379,
  "lines": [
    {
      "id": "648144713aa6cb001c415db2",
      "text": "time-mirror",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193267,
      "updated": 1686193267
    },
    {
      "id": "648144741280f000001ea127",
      "text": "[未来の自分に作業配信]の実装",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193268,
      "updated": 1686193274
    },
    {
      "id": "648144731280f000001ea125",
      "text": " https://time-mirror.vercel.app/",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193267,
      "updated": 1686193267
    },
    {
      "id": "648144741280f000001ea126",
      "text": " https://github.com/blu3mo/time-mirror",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193267,
      "updated": 1686193267
    },
    {
      "id": "6481447c1280f000001ea128",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193276,
      "updated": 1686193276
    },
    {
      "id": "6481447c1280f000001ea129",
      "text": " コードはほとんどChatGPTに書かせた[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193276,
      "updated": 1686193527
    },
    {
      "id": "6481466479e1130000d79f17",
      "text": "  https://chat.openai.com/share/66cec31a-6c51-4017-b318-1472ad62f4a1",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193765,
      "updated": 1686193801
    },
    {
      "id": "6481459d1280f000001ea199",
      "text": "  だからところどころ変だったんですね(constじゃなくてletだったり)[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193565,
      "updated": 1686193581
    },
    {
      "id": "648145a879e1130000c86d34",
      "text": "　　　www[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193577,
      "updated": 1686193579
    },
    {
      "id": "648145ab79e1130000c86d35",
      "text": "　　　これは不思議、なぜだろう[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193579,
      "updated": 1686193601
    },
    {
      "id": "6481457979e1130000c86d31",
      "text": "  自分は設計とデバッグだけ",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193529,
      "updated": 1686193632
    },
    {
      "id": "6481458679e1130000c86d32",
      "text": "  　と思ったけど実装方針もChatGPTに任せてたな（[MediaRecorder]使うとか）",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193543,
      "updated": 1686195729
    },
    {
      "id": "648145c579e1130000c86d36",
      "text": "  　「映像をローカルに保存する形でこれを作りたい」というところまでは自分が決めた()",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193606,
      "updated": 1686193632
    },
    {
      "id": "64814cfb1280f000001ea2be",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195451,
      "updated": 1686195451
    },
    {
      "id": "6483eded1280f00000be7f95",
      "text": "今のところ、10秒前の状態を表示するみたい？[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686367725,
      "updated": 1686367737
    },
    {
      "id": "6483edf81280f00000be7f96",
      "text": " 理想は10分前くらいなのかな",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686367737,
      "updated": 1686367745
    },
    {
      "id": "6483f68c79e11300008590c0",
      "text": " 今（2023/6/10）の実装：再生を始めた所から再生しつ続ける[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686369932,
      "updated": 1686370062
    },
    {
      "id": "6483f6c379e11300008590c2",
      "text": " 　なので、特定のn分前を再生するのではない",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686369987,
      "updated": 1686370001
    },
    {
      "id": "6483f6d079e11300008590c3",
      "text": " 　動画の再生バーを操作すれば、任意のタイミングの過去の映像を見る事が出来る",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686370001,
      "updated": 1686370085
    },
    {
      "id": "648407f71280f00000be8068",
      "text": " 　なるほど[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686374391,
      "updated": 1686374397
    },
    {
      "id": "648407fc1280f00000be8069",
      "text": "  　[- あー、てことは、]`getDisplayMedia()`[- で取得したデータをそのまま流すだけでいいみたいですね]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686374397,
      "updated": 1686375435
    },
    {
      "id": "648408171280f00000be806a",
      "text": "  　　[- ならかなり小規模なコードで済むはずです]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686374424,
      "updated": 1686375436
    },
    {
      "id": "64840c0b1280f000003c7d9c",
      "text": "  　[MediaStream]を直接渡すと、シーク不能になるっぽい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375436,
      "updated": 1686375451
    },
    {
      "id": "64840c4b1280f000003c7da2",
      "text": "  　 seekableにできないかな",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375500,
      "updated": 1686375506
    },
    {
      "id": "64840c4a1280f000003c7da1",
      "text": "   　[/unarist/MediaRecorderAPIで作ったwebmをseekableにしたい]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375499,
      "updated": 1686375508
    },
    {
      "id": "64840d7f1280f000003c7da8",
      "text": "   　currentTimeに大きな値を入れる方法は、ライブストリーミングだと不能",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375808,
      "updated": 1686375829
    },
    {
      "id": "64840c1e1280f000003c7d9d",
      "text": "  　適宜blob URLを差し替える以外に方法がなさそう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375455,
      "updated": 1686375469
    },
    {
      "id": "6484ce0879e1130000ed0333",
      "text": "  　 [MediaSource]と[SourceBuffer]を使うと、随時データをbufferにappendしていけるらしい[blu3mo.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686425096,
      "updated": 1686430366
    },
    {
      "id": "6484e29c1280f000005cfbd3",
      "text": "  　  こいつか[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686430366,
      "updated": 1686430377
    },
    {
      "id": "6484e2a71280f000005cfbd5",
      "text": "  　   https://developer.mozilla.org/ja/docs/Web/API/Media_Source_Extensions_API",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686430378,
      "updated": 1686430379
    },
    {
      "id": "6484ced179e1130000ed0360",
      "text": "  　 ざっくり以下のコードのようなイメージ",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425297,
      "updated": 1686425304
    },
    {
      "id": "6484ce8079e1130000ed0334",
      "text": "  　 code: js",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425216,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0335",
      "text": "  　    useEffect(() => {",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0336",
      "text": "         mediaSource.current.addEventListener('sourceopen', () => {",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0337",
      "text": "           sourceBuffer.current = mediaSource.current.addSourceBuffer('video/webm;codecs=opus,vp8');",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0338",
      "text": "         });",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0339",
      "text": "       }, []);",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed033a",
      "text": "     ",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0357",
      "text": "       useInterval(() => {",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0358",
      "text": "         if (sourceBuffer.current && sourceBuffer.current.updating === false) {",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed0359",
      "text": "           let blob = new Blob(recordedChunks, { type: 'video/webm' });",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035a",
      "text": "           blob.arrayBuffer().then(data => {",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035b",
      "text": "             sourceBuffer.current.appendBuffer(data);",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035c",
      "text": "           });",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035d",
      "text": "           setRecordedChunks([]);",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035e",
      "text": "         }",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425283
    },
    {
      "id": "6484cec279e1130000ed035f",
      "text": "       }, isPlaying ? 1000 : null);",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425283,
      "updated": 1686425295
    },
    {
      "id": "6484ced979e1130000ed0361",
      "text": "   　ただ、色々エラーにぶつかって上手くいっていない[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686425305,
      "updated": 1686425362
    },
    {
      "id": "64840f7e1280f000003c7da9",
      "text": " 再生バー操作ができなくなってもいいなら、時間差でcanvasに描画した画像をvideo要素にstreamingする手があります[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686376319,
      "updated": 1686376365
    },
    {
      "id": "6483edec1280f00000be7f94",
      "text": "  再生バーをDOMで構築するなら操作もできるかも",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686367725,
      "updated": 1686376527
    },
    {
      "id": "6484106e1280f000003c7dac",
      "text": "   過去の映像をメモリにblobで保存しておき、巻き戻し操作が発生したらそれを呼び出して再生する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686376559,
      "updated": 1686376609
    },
    {
      "id": "648410501280f000003c7dab",
      "text": "   video側でのseekは依然不能だが、どうせPiPだとunseekableなので気にする必要はない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686376529,
      "updated": 1686376558
    },
    {
      "id": "6484100d1280f000003c7daa",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686376462,
      "updated": 1686376462
    },
    {
      "id": "64814cf91280f000001ea2bd",
      "text": "`cursor: \"always\"`は無効です[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195449,
      "updated": 1686195450
    },
    {
      "id": "64814cfc1280f000001ea2bf",
      "text": " 昔はあったらしいけど、Opera以外サポートしていなかった",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195452,
      "updated": 1686195492
    },
    {
      "id": "64814d241280f000001ea2c0",
      "text": " https://stackoverflow.com/questions/64250857/is-it-possible-to-disable-the-cursor-from-being-recorded-with-getdisplaymedia",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195492,
      "updated": 1686195492
    },
    {
      "id": "64814d2e1280f000001ea2c1",
      "text": " https://udn.realityripple.com/docs/Web/API/MediaTrackConstraints/cursor",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195502,
      "updated": 1686195503
    },
    {
      "id": "648145e279e1130000c86d38",
      "text": "",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1686193634,
      "updated": 1686193634
    },
    {
      "id": "648149051280f000001ea23e",
      "text": "UserScript版",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194437,
      "updated": 1686194440
    },
    {
      "id": "64814ce91280f000001ea2b6",
      "text": " [- 多分動く]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195433,
      "updated": 1686195690
    },
    {
      "id": "64814deb1280f000001ea2c3",
      "text": " 動かないや。なんかミスったな",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195691,
      "updated": 1686195696
    },
    {
      "id": "648399061280f0000094d6e6",
      "text": " 仕組み上reactを使う必要がないので消す",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686345993,
      "updated": 1686346031
    },
    {
      "id": "64814d481280f000001ea2c2",
      "text": " https://scrapbox-bundler.vercel.app?url=https://scrapbox.io/api/code/villagepump/time-mirror/script.ts&bundle&minify&run&reload",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195528,
      "updated": 1686195545
    },
    {
      "id": "64840a0e1280f00000d532d8",
      "text": " $ deno check --remote -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/time-mirror/script.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686374927,
      "updated": 1686374949
    },
    {
      "id": "648148301280f000001ea22f",
      "text": "code:script.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194224,
      "updated": 1686194227
    },
    {
      "id": "6481492b1280f000001ea243",
      "text": " /// <reference no-default-lib=\"true\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194475,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532da",
      "text": " /// <reference lib=\"esnext\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532db",
      "text": " /// <reference lib=\"dom\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532dc",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532dd",
      "text": " import { Scrapbox } from \"https://raw.githubusercontent.com/scrapbox-jp/types/0.4.2/userscript.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532de",
      "text": " declare const scrapbox: Scrapbox;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532df",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e0",
      "text": " let video: HTMLVideoElement | undefined;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e1",
      "text": " scrapbox.PageMenu.addItem({",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e2",
      "text": "   title: \"recording\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e3",
      "text": "   onClick: async () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e4",
      "text": "     if (video) return;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e5",
      "text": "     const stream = await navigator.mediaDevices.getDisplayMedia({",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e6",
      "text": "       video: true,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e7",
      "text": "       audio: false,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e8",
      "text": "     });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532e9",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532ea",
      "text": "     video = document.createElement(\"video\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532eb",
      "text": "     video.style.maxWidth = \"50%\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532ec",
      "text": "     video.style.position = \"fixed\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375781
    },
    {
      "id": "64840ad91280f00000d532ed",
      "text": "     video.style.bottom = \"5%\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532ee",
      "text": "     video.style.left = \"5%\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532ef",
      "text": "     video.controls = true;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f0",
      "text": "     video.autoplay = true;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f1",
      "text": "     video.srcObject = stream;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840d071280f000003c7da3",
      "text": "     video.currentTime = 7*24*60*1000;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375688,
      "updated": 1686375689
    },
    {
      "id": "64840d081280f000003c7da4",
      "text": "     video.onseeked = ()=>{",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375689,
      "updated": 1686375689
    },
    {
      "id": "64840d081280f000003c7da5",
      "text": "       alert(\"after-seeked: \"+video.duration);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375689,
      "updated": 1686375689
    },
    {
      "id": "64840d081280f000003c7da6",
      "text": "       video.onseeked = undefined;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375689,
      "updated": 1686375689
    },
    {
      "id": "64840d081280f000003c7da7",
      "text": "     };",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375689,
      "updated": 1686375689
    },
    {
      "id": "64840ad91280f00000d532f2",
      "text": "     document.body.append(video);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f3",
      "text": "   },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f4",
      "text": " });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f5",
      "text": " scrapbox.PageMenu.addItem({",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f6",
      "text": "   title: \"stop\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f7",
      "text": "   onClick: () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f8",
      "text": "     if (!video) return;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532f9",
      "text": "     const stream = video.srcObject;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532fa",
      "text": "     if (stream instanceof MediaStream) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532fb",
      "text": "       for (const track of stream.getTracks()) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532fc",
      "text": "         track.stop();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532fd",
      "text": "       }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532fe",
      "text": "     }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d532ff",
      "text": "     video.srcObject = null;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d53300",
      "text": "     video.remove();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d53301",
      "text": "     video = undefined;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d53302",
      "text": "   },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d53303",
      "text": " });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "64840ad91280f00000d53304",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686375130,
      "updated": 1686375130
    },
    {
      "id": "648148fc1280f000001ea23d",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194428,
      "updated": 1686194428
    },
    {
      "id": "648148301280f000001ea22e",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194224,
      "updated": 1686194224
    },
    {
      "id": "6481449c1280f000001ea12a",
      "text": "code:mod.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193309,
      "updated": 1686368619
    },
    {
      "id": "648149101280f000001ea23f",
      "text": " /// <reference no-default-lib=\"true\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686194448,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8021",
      "text": " /// <reference lib=\"esnext\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8022",
      "text": " /// <reference lib=\"dom\" />",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8023",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8024",
      "text": " export const start = async (): Promise<readonly [MediaStream, () => void]> => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8025",
      "text": "   const stream = await navigator.mediaDevices.getDisplayMedia({",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8026",
      "text": "     video: true,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8027",
      "text": "     audio: false,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8028",
      "text": "   });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8029",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802a",
      "text": "   const chunks: Blob[] = [];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802b",
      "text": "   const offscreen = document.createElement(\"canvas\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802c",
      "text": "   const ctx = offscreen.getContext(\"2d\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802d",
      "text": "   if (!ctx) throw Error(\"cannot get a contex from <canvas>\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802e",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be802f",
      "text": "   const recorder = new MediaRecorder(stream);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8030",
      "text": "   let animationId: number | undefined;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8031",
      "text": "   recorder.addEventListener(\"dataavailable\", async (event) => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8032",
      "text": "     if (event.data.size === 0) return;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8033",
      "text": "     chunks.push(event.data);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8034",
      "text": "     const url = URL.createObjectURL(event.data);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8035",
      "text": "     const video = document.createElement(\"video\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8036",
      "text": "     video.src = url;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8037",
      "text": "     await new Promise(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8038",
      "text": "       (resolve) =>",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8039",
      "text": "         video.addEventListener(\"loadedmetadata\", resolve, { once: true }),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803a",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803b",
      "text": "     video.play();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803c",
      "text": "     offscreen.width = video.videoWidth;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803d",
      "text": "     offscreen.height = video.videoHeight;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803e",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be803f",
      "text": "     const tick = () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8040",
      "text": "       ctx.drawImage(video, 0, 0);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8041",
      "text": "       animationId = requestAnimationFrame(tick);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8042",
      "text": "     };",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8043",
      "text": "     tick();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8044",
      "text": "   });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8045",
      "text": "   recorder.start(5 * 1000); // collect data by 10min",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369344
    },
    {
      "id": "6483f3e61280f00000be8046",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8047",
      "text": "   return [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8048",
      "text": "     offscreen.captureStream(),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8049",
      "text": "     /** disposer */",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804a",
      "text": "     () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804b",
      "text": "       recorder.stop();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804c",
      "text": "       recorder.stream.getTracks().forEach((track) => track.stop());",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804d",
      "text": "       if (animationId !== undefined) cancelAnimationFrame(animationId);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804e",
      "text": "     },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be804f",
      "text": "   ] as const;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8050",
      "text": " };",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "6483f3e61280f00000be8051",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686369255,
      "updated": 1686369255
    },
    {
      "id": "64814ce61280f000001ea2b5",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686195430,
      "updated": 1686195430
    },
    {
      "id": "6481449c1280f000001ea12b",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1686193309,
      "updated": 1686193309
    }
  ]
}