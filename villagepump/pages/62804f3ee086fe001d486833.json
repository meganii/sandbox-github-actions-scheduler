{
  "id": "62804f3ee086fe001d486833",
  "title": "SharePointドキュメントライブラリからいい感じにファイルパスを取得するブックマークレット",
  "created": 1652576064,
  "updated": 1652875538,
  "lines": [
    {
      "id": "62804f3ee086fe001d486833",
      "text": "SharePointドキュメントライブラリからいい感じにファイルパスを取得するブックマークレット",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652793087
    },
    {
      "id": "62804f4bb8db540000a2e88c",
      "text": "[2022/05/14] [SharePoint REST API]の成果物[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576075,
      "updated": 1652576147
    },
    {
      "id": "62804f4bb8db540000a2e88d",
      "text": " [Microsoft 365]ユーザは少ないかもしれないが、ツッコミあればください",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576075,
      "updated": 1652576116
    },
    {
      "id": "62804f5cb8db540000a2e88e",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576092,
      "updated": 1652576092
    },
    {
      "id": "62804f75b8db540000a2e88f",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576117,
      "updated": 1652576117
    },
    {
      "id": "62804f3fb8db540000a2e855",
      "text": "モチベーション",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e856",
      "text": "　ファイル格納場所を共有するときに不便なので作った",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e857",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e858",
      "text": "動き",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e859",
      "text": " Excel, PowerPoint, Wordファイルの場合は、フォルダ移動してもリンク切れにならない`_layouts/15/Doc.aspx?sourcedoc=`形式のリンクにする",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85a",
      "text": " ファイルを選択した場合、選択したファイルのリンクを作成",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85b",
      "text": "  [https://gyazo.com/3ee2efda3a05d2ab8b8bbb482a656aed]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85c",
      "text": "  [https://gyazo.com/cea0869f99918ec53be4181270bf117e]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85d",
      "text": "　ファイルを選択しない場合は、直下のファイルをすべて列挙する",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85e",
      "text": " 　[https://gyazo.com/03e123c91a18389440ef95ddd47b5317]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e85f",
      "text": " 　[https://gyazo.com/55016c38f29430ea67d4c588adf91c86]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e860",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e861",
      "text": "[ブックマークレット]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652612938
    },
    {
      "id": "62804f3fb8db540000a2e862",
      "text": "code:js",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e863",
      "text": " javascript: (async () => {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e864",
      "text": "   const selectedItems = [...document.querySelectorAll('div.is-selected')].map(x => x.ariaLabel.split(',')[0]);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e865",
      "text": "   const site = location.pathname.split('/')[2];",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e866",
      "text": "   const docList = location.pathname.split('/')[3];",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e867",
      "text": "   const id = new URLSearchParams(location.search).get('id');",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e868",
      "text": "   const path = id ? id.split('/').slice(3).join('/') : docList;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e869",
      "text": "   const baseurl = `${location.origin}/sites/${site}`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86a",
      "text": "   const url = `${baseurl}/_api/web/GetFolderByServerRelativeUrl('${path}')/Files`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86b",
      "text": "   const response = await fetch(url, {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86c",
      "text": "     headers: {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86d",
      "text": "       'Content-Type': 'application/json',",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86e",
      "text": "       'Accept': 'application/json;odata=verbose'",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e86f",
      "text": "     }",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e870",
      "text": "   });",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e871",
      "text": "   const files = await response.json();",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e872",
      "text": "   let text = `<${baseurl}/${path}>\\n`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e873",
      "text": "   let html = `<a href=\"${baseurl}/${path}\">${baseurl}/${path}</a><br />`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e874",
      "text": "   for (let file of files.d.results) {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e875",
      "text": "     const ext = file.Name.split('.').pop();",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e876",
      "text": "     const docUrl = /docx?|pptx?|xlsx?/.test(ext)",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e877",
      "text": "       ? `${baseurl}/_layouts/15/Doc.aspx?sourcedoc={${file.UniqueId}}`",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e878",
      "text": "       : `${baseurl}/${path}/${file.Name}`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e879",
      "text": "     console.log(file.Name, file.LinkingUri, file.UniqueId, docUrl);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87a",
      "text": "     if (selectedItems.length === 0 || selectedItems.includes(file.Name)) {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87b",
      "text": "       text = text + docUrl + '\\n';",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87c",
      "text": "       html = html + `- <a href=\"${docUrl}\">${file.Name}</a><br />`;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87d",
      "text": "     }",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87e",
      "text": "   }",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e87f",
      "text": "   const blob = new Blob([html], { type: \"text/html\" });",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e880",
      "text": "   const richTextInput = new ClipboardItem({ \"text/html\": blob });",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e881",
      "text": "   await navigator.clipboard.write([richTextInput]);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e882",
      "text": "   alert('copy!');",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e883",
      "text": " })();",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e884",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e885",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e886",
      "text": "改善点",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e887",
      "text": "　選択アイテムのDOM構造が変わった場合は、追随しなければならない",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e888",
      "text": "　`_api/web/GetFolderByServerRelativeUrl`でのファイル名でのフィルタ方法がわからなかったため、全取得している",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e889",
      "text": " 　フォルダ直下のファイルが増えた場合に困りそう",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e88a",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "62804f3fb8db540000a2e88b",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652576064,
      "updated": 1652576064
    },
    {
      "id": "6284bef10553320000026f4b",
      "text": "defaultのリンクのコピーとの違いがいまいちわかっていない…",
      "userId": "5d131fa66fe2890017055332",
      "created": 1652866800,
      "updated": 1652866813
    },
    {
      "id": "6284bef60553320000026f4c",
      "text": " デフォルトだと複数ファイルのファイパスコピーができないんですよ・・・あれ弊社テナントだけ？[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652866805,
      "updated": 1652874565
    },
    {
      "id": "6284dd29b8db540000ca43d6",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652874538,
      "updated": 1652874538
    },
    {
      "id": "6284e0c2b8db540000ca43d7",
      "text": "1ファイルコピーするだけで、次の①から④をコピーしないとファイルパスを取得できないと思っていたが、もしかして他にやり方がある？これ死ぬほどめんどくさい[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875458,
      "updated": 1652875538
    },
    {
      "id": "6284e0c6b8db540000ca43d8",
      "text": " ①リンクをコピー",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43d9",
      "text": "  [https://gyazo.com/675b0c39049083a7a1cdbd7f4ec3f786]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43da",
      "text": " ②「リンクのコピー」から赤枠を選択",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43db",
      "text": "  [https://gyazo.com/a8402adfef5b173588117ece0db4c17a]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43dc",
      "text": "　③「リンクの設定」から「既存アクセス権を持つユーザー」を選択",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43dd",
      "text": "  [https://gyazo.com/9649ab12a748ff339e218c038cf1e9f9]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43de",
      "text": " ④リンクをコピー",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    },
    {
      "id": "6284e0c6b8db540000ca43df",
      "text": "  [https://gyazo.com/3a799a305c5500c4b0b61f6c57baf215]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1652875463,
      "updated": 1652875463
    }
  ]
}