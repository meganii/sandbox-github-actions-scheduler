{
  "id": "6275fba1286bc90023fd4c9f",
  "title": "iPadで外部キーボードを利用するときもコピー・カット・切り取りがしたい",
  "created": 1651899298,
  "updated": 1693032557,
  "lines": [
    {
      "id": "6275fba1286bc90023fd4c9f",
      "text": "iPadで外部キーボードを利用するときもコピー・カット・切り取りがしたい",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899320
    },
    {
      "id": "6275fc40b8db540000f06de9",
      "text": "とりあえずIME ONでも動いた[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899459,
      "updated": 1651900642
    },
    {
      "id": "627600e0b8db540000f06df7",
      "text": " やっぱりIME ON のとき`command + c`を押下したとき、`c`のキー入力が入ってしまうのは要調査",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900642,
      "updated": 1651900717
    },
    {
      "id": "62760083b8db540000f06df2",
      "text": "[https://gyazo.com/4a7072ffa7971b84f4e3966844d12a14]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900549,
      "updated": 1651900550
    },
    {
      "id": "62760083b8db540000f06df3",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900550,
      "updated": 1651900550
    },
    {
      "id": "6275fc40b8db540000f06dea",
      "text": "前提",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899459,
      "updated": 1651899463
    },
    {
      "id": "6275fc44b8db540000f06dec",
      "text": "　iPad Pro 11 inch (第2世代)",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899463,
      "updated": 1651899493
    },
    {
      "id": "6275fc63b8db540000f06ded",
      "text": "　iPad OS 15.4.1",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899494,
      "updated": 1651899519
    },
    {
      "id": "6275fc87b8db540000f06dee",
      "text": "　利用外部キーボード",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899530,
      "updated": 1651899545
    },
    {
      "id": "6275fc97b8db540000f06def",
      "text": "　 [Logicool Folio Touch Keyboard Case with Trackpad]",
      "userId": "60508ed36a7abc00235e90c0",
      "created": 1651899546,
      "updated": 1693032557
    },
    {
      "id": "6275fc9eb8db540000f06df0",
      "text": "　設定 > Safari > 「デスクトップ用のWebページを表示」を有効",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899553,
      "updated": 1651900768
    },
    {
      "id": "6275fc9fb8db540000f06df1",
      "text": "　　これにより、userAgentがデスクトップ用になり、外部キーボードでの範囲選択が有効になる",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899553,
      "updated": 1651900806
    },
    {
      "id": "62760185b8db540000f06df9",
      "text": "　　iPadOS Safariとして動作すると、外部キーボードによる",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900808,
      "updated": 1651900843
    },
    {
      "id": "62760142b8db540000f06df8",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900741,
      "updated": 1651900741
    },
    {
      "id": "627601afb8db540000f06dfa",
      "text": "UserScript（調整中）",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900850,
      "updated": 1651900859
    },
    {
      "id": "627600a1b8db540000f06df4",
      "text": " [/meganii/scrapbox-userscript-for-ipad]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900580,
      "updated": 1651900863
    },
    {
      "id": "627600a1b8db540000f06df5",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900580,
      "updated": 1651900580
    },
    {
      "id": "627600a1b8db540000f06df6",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900580,
      "updated": 1651900580
    },
    {
      "id": "6275fb9fb8db5400000fccf8",
      "text": "from [2022/05/05]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccf9",
      "text": "iPadで外部キーボードを利用するときにコピー・カット・切り取りがしたい",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccfa",
      "text": " 前回（[2022/03/13#622db3a1b8db5400007712f3]）に引き続き、[Porterっぽい編集バーを生やすUserScript]を参考にさせてもらい、外部キーボードを利用したiPad Safariでも`ctrl+c`, `ctrl+v`, `ctrl+x`によるコピー、貼り付け、切り取りができるようになった",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccfb",
      "text": "　　iPad Pro x Logicool Folio Touch Keyboard Case with Trackpadの環境だと、日本語入力モードのときは`ctrl+c`, `ctrl+v`, `ctrl+x`がうまく働かず、単に`c`, `v`, `x`が入力されてしまうのは要調査",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccfc",
      "text": "　　　英字モードに切り替えると正常動作する",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccfd",
      "text": "　　　[Mousetrap]がうまく拾ってくれないのか、iPad Safariの問題か",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccfe",
      "text": "　　　`addEventListener(\"keydown\", (e) => console.log(e))`を実行すると、どちらかが原因なのかわかります[takker.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fccff",
      "text": "　　　 押しても何も表示されない場合は、iPad Safariがキーイベントをそもそも発生させていない",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd00",
      "text": "   以下のとおり、ctrl+c（command+c）をMousetrapでキャッチしているつもり、かつ、KeyboardEventは日本語入力モード時も `c`キー押下時のイベントは搬出しているみたい[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd01",
      "text": "    入力確定前だとMousetrapの挙動が違うのかな",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd02",
      "text": "     code:js",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd03",
      "text": "      Mousetrap(document.querySelector('#text-input')).bind(['ctrl+c', 'command+c'], async (e) => {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd04",
      "text": "          console.log('Copy');",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd05",
      "text": "          try {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd06",
      "text": "              const text = caret().selectedText;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd07",
      "text": "              if (!text) return;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd08",
      "text": "              await navigator.clipboard.writeText(text);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd09",
      "text": "            } catch (e: unknown) {",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0a",
      "text": "              console.error(e);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0b",
      "text": "              alert(`Faild to copy:\\n${JSON.stringify(e)}`);",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0c",
      "text": "            }",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0d",
      "text": "          return false;",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0e",
      "text": "      });",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd0f",
      "text": " 　　　英字入力モード",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd10",
      "text": "     [https://gyazo.com/260eb55fc4544a958623891f65204f81]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd11",
      "text": "    日本語入力モード",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd12",
      "text": "     [https://gyazo.com/8ea2251516e4256fa0e69f24981c8745]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd13",
      "text": "     [https://gyazo.com/3a508993afb31639733cd96b71568df5]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd14",
      "text": "    日本語モードだとkeyCode:229、英字モードだとkeyCode: 67の違いがあった",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd15",
      "text": "    [https://gyazo.com/181866da20d10bb5503612a7ba1d7d7d]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd16",
      "text": "    ctrl+x, ctrl+cの場合、keyCode 229",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd17",
      "text": "    ctrl+vの場合、正しくkeyCode86になるっぽい。謎。。。",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd18",
      "text": "   把握。[Mousetrap]が後方互換性のために[KeyboardEvent.keyCode]を使っているのが原因でしょう[takker.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd19",
      "text": "    Mousetrapは数年前から開発が停止している",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd1a",
      "text": "     [https://github.com/ccampbell/mousetrap/issues/512 Are there any alternatives to mousetrap? · Issue #512 · ccampbell/mousetrap]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd1b",
      "text": "    Mousetrapをやめてイベント処理を自前で書き直す他なさそうです",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd1c",
      "text": "    なるほど、ありがとうございます！試してみます[meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651899298
    },
    {
      "id": "6275fb9fb8db5400000fcd1d",
      "text": "　　　 [Mousetrap] をやめて、自前でハンドリングしたところIME ONでも動きました!![meganii.icon]",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651899298,
      "updated": 1651900926
    },
    {
      "id": "627601fcb8db540000f06dfc",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900927,
      "updated": 1651900928
    },
    {
      "id": "627601cbb8db540000f06dfb",
      "text": "",
      "userId": "5a1660501dab010014b8db54",
      "created": 1651900878,
      "updated": 1651900878
    }
  ]
}