{
  "id": "6204e497178b45002053c48d",
  "title": "pin-diary-5",
  "created": 1644487834,
  "updated": 1667130591,
  "lines": [
    {
      "id": "6204e497178b45002053c48d",
      "text": "pin-diary-5",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644487834,
      "updated": 1644487834
    },
    {
      "id": "6206416b1280f00000774500",
      "text": "[pin-diary]の実装その5",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577131,
      "updated": 1644577131
    },
    {
      "id": "6206416b1280f00000774501",
      "text": " [pin-diary-4] -> [* pin-diary-5] -> [pin-diary-6]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1644577131,
      "updated": 1646393989
    },
    {
      "id": "6204e49a1280f000003b30c6",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644487834,
      "updated": 1644577134
    },
    {
      "id": "6206416e1280f00000774502",
      "text": "使い方",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577134,
      "updated": 1644577136
    },
    {
      "id": "620641781280f00000774507",
      "text": " お試し",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577145,
      "updated": 1644577163
    },
    {
      "id": "620641921280f00000774526",
      "text": "  `await import(\"../../villagepump/pin-diary-5/script.js\");`を自分のページの`script.js`に貼り付ける",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577170,
      "updated": 1644577199
    },
    {
      "id": "6206418c1280f00000774524",
      "text": " ちゃんと使う",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577164,
      "updated": 1644577205
    },
    {
      "id": "620641b51280f00000774527",
      "text": "  いくつか方法があります",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577205,
      "updated": 1644577213
    },
    {
      "id": "620641bc1280f00000774528",
      "text": "   [このリンク https://scrapbox-bundler.vercel.app/?url=https://scrapbox.io/api/code/villagepump/pin-diary-5/mod.ts&bundle&minify&run&output=newtab]から取得したコードを自分のページに貼り付ける",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577213,
      "updated": 1644577276
    },
    {
      "id": "620641d51280f00000774529",
      "text": "    コードを更新したいときは`&reload`を↑のURLの後ろに付けてください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577237,
      "updated": 1644577276
    },
    {
      "id": "620641ea1280f0000077452a",
      "text": "   `deno bundle https://scrapbox.io/api/code/villagepump/pin-diary-5/script.js`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577259,
      "updated": 1644577276
    },
    {
      "id": "620641f71280f0000077452b",
      "text": " カスタマイズ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577271,
      "updated": 1644577287
    },
    {
      "id": "620642071280f0000077452e",
      "text": "  ↓のように、`launch()`の引数にproject nameを入れることで、pin-diaryを使いたいprojectを変更できます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577287,
      "updated": 1644577328
    },
    {
      "id": "620642101280f0000077452f",
      "text": "   code:script.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577296,
      "updated": 1644577302
    },
    {
      "id": "620642101280f00000774530",
      "text": "    import { launch } from \"./mod.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577296,
      "updated": 1644577302
    },
    {
      "id": "620642101280f00000774531",
      "text": "    ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577296,
      "updated": 1644577302
    },
    {
      "id": "620642101280f00000774532",
      "text": "    launch(\"villagepump\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577296,
      "updated": 1644577302
    },
    {
      "id": "620642031280f0000077452d",
      "text": "  特定日のページを[Pin留めページ]にしたいとき",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577284,
      "updated": 1644577358
    },
    {
      "id": "6206424c1280f00000774534",
      "text": "   code:js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577356,
      "updated": 1644577362
    },
    {
      "id": "620642521280f00000774535",
      "text": "    import { pinDiary } from \"./mod.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577362,
      "updated": 1644577415
    },
    {
      "id": "620642881280f00000774540",
      "text": "    ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577416,
      "updated": 1644577416
    },
    {
      "id": "620642891280f00000774541",
      "text": "    await pinDiary(\"villagepump\", new Date(2144, 0, 10));",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577416,
      "updated": 1644577437
    },
    {
      "id": "620642331280f00000774533",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577331,
      "updated": 1644577331
    },
    {
      "id": "62064a2c1280f0000042ee4a",
      "text": "特徴",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579372,
      "updated": 1644579374
    },
    {
      "id": "62064a2e1280f0000042ee4b",
      "text": " [[ページの有無に関わらず、任意のプロジェクトの任意のページからその日の日記をピン留めできる]]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579374,
      "updated": 1644580610
    },
    {
      "id": "62064d931280f0000036f5f4",
      "text": "  [https://gyazo.com/1bbd8d5471b61bc0b30fb5a92c42257f]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580243,
      "updated": 1644580262
    },
    {
      "id": "62064f171280f0000036f5ff",
      "text": "  このGIFだとピン留めしている様子がわからない[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580632,
      "updated": 1644580643
    },
    {
      "id": "62064f241280f0000036f600",
      "text": "   まあ別にいいか",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1644580643,
      "updated": 1644582783
    },
    {
      "id": "620657807838e300003e7669",
      "text": "   [右下の通信ステータス]を見るしかないっぽい[Mijinko_SD.icon]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1644582784,
      "updated": 1644582798
    },
    {
      "id": "6210b60e1280f000002813d6",
      "text": "  と強調してあるが、実際は[/villagepump]にいないと発動しないよう制限がかかっている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1645262349,
      "updated": 1645262382
    },
    {
      "id": "6210b6241280f000002813d7",
      "text": "  　APIを叩きすぎないようにするため",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1645262371,
      "updated": 1645262436
    },
    {
      "id": "62064a641280f0000042ee4c",
      "text": " [日記ページのtemplate]が入っていなかったら勝手に書き込む",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1644582783,
      "updated": 1644582783
    },
    {
      "id": "62064bff1280f0000036f5f1",
      "text": "  差し込み処理が結構雑",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579839,
      "updated": 1644579884
    },
    {
      "id": "62064a2c1280f0000042ee49",
      "text": " 作成状況を[右下の通信ステータス]に表示する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579372,
      "updated": 1644579905
    },
    {
      "id": "62064c341280f0000036f5f2",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579892,
      "updated": 1644579892
    },
    {
      "id": "620649ef1280f0000042ee43",
      "text": "実装",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579311,
      "updated": 1644579313
    },
    {
      "id": "62064a251280f0000042ee48",
      "text": " [ScrapboxのWebSocketを模倣]することで、backgroundから全ての操作を行っている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579365,
      "updated": 1644579935
    },
    {
      "id": "62064c5f1280f0000036f5f3",
      "text": "  [pin-diary-4]はピン留め操作のみをbackgroundからやっていた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579935,
      "updated": 1644580347
    },
    {
      "id": "62064de91280f0000036f5f6",
      "text": "  今回は全ての編集操作にwebsocketを採用した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580329,
      "updated": 1644580361
    },
    {
      "id": "620649f11280f0000042ee44",
      "text": " 外部自製ライブラリをバリバリ使っている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579313,
      "updated": 1644579327
    },
    {
      "id": "62064a001280f0000042ee45",
      "text": "  bundleサイズ増えちゃったかも……",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579328,
      "updated": 1644579337
    },
    {
      "id": "62065b091280f00000031ad7",
      "text": "   scrapbox-parserがまるごと入っている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644583688,
      "updated": 1644583702
    },
    {
      "id": "62064a0b1280f0000042ee46",
      "text": "  コードの追跡が面倒になるというデメリットもある……",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579339,
      "updated": 1644579364
    },
    {
      "id": "6206f4241280f000006d1e0a",
      "text": " 外部ライブラリは`deps.ts`にまとまっています",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622884,
      "updated": 1644622903
    },
    {
      "id": "6206f4381280f000006d1e0b",
      "text": "  テストコードに使った外部ライブラリは`deps_test.ts`に置いた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622905,
      "updated": 1644622919
    },
    {
      "id": "620649ee1280f0000042ee42",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579310,
      "updated": 1644579310
    },
    {
      "id": "62064e6e1280f0000036f5fa",
      "text": "改善したいところ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580462,
      "updated": 1644580468
    },
    {
      "id": "62064e741280f0000036f5fb",
      "text": " [/icons/done.icon][pin-diary-4]の`listDiaries()`の実装に無駄が有りすぎる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580468,
      "updated": 1644625061
    },
    {
      "id": "62064e951280f0000036f5fc",
      "text": " 　APIを叩きすぎ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580501,
      "updated": 1644580505
    },
    {
      "id": "62064e9a1280f0000036f5fd",
      "text": " 　もっと軽く実装し直したい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580506,
      "updated": 1644580524
    },
    {
      "id": "6206fca61280f000001289b8",
      "text": " 　09:17:44 実装した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644625063,
      "updated": 1644625067
    },
    {
      "id": "62066be01280f000005260c9",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644587999,
      "updated": 1644588000
    },
    {
      "id": "62066be11280f000005260ca",
      "text": "バグ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588000,
      "updated": 1644588003
    },
    {
      "id": "62066be31280f000005260cb",
      "text": " [/icons/done.icon]23:00:04 今スマホでscrapbox開いたら、`[2]`という謎ページが生成&ピン留めされた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588003,
      "updated": 1644620764
    },
    {
      "id": "62066c111280f000005260cc",
      "text": "  なんだこれ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588049,
      "updated": 1644588051
    },
    {
      "id": "62066c141280f000005260cd",
      "text": "  どっからでてきたこいつ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588051,
      "updated": 1644588058
    },
    {
      "id": "62066c1b1280f000005260ce",
      "text": "  明日調べます[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588058,
      "updated": 1644588062
    },
    {
      "id": "6206ea441280f0000001c2d3",
      "text": "  2022-02-12",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620356,
      "updated": 1644620639
    },
    {
      "id": "6206eb5f1280f00000fd9d56",
      "text": "   07:59:17 [日記ページのtemplate]の返り値の配列を分解したときにおかしなデータができている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620639,
      "updated": 1644620639
    },
    {
      "id": "6206ea661280f0000001c2d5",
      "text": "    `[title, header, footer] === [2, 0, 2]`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620390,
      "updated": 1644620642
    },
    {
      "id": "6206ead51280f0000001c2d6",
      "text": "    `getTemplate()`自体は正常な値を返している",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620501,
      "updated": 1644620642
    },
    {
      "id": "6206ea471280f0000001c2d4",
      "text": "     code:ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620359,
      "updated": 1644620642
    },
    {
      "id": "6206e9ec1280f0000001c2cf",
      "text": "      import { getTemplate } from \"../日記ページのtemplate/diary.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620268,
      "updated": 1644620642
    },
    {
      "id": "6206e9ed1280f0000001c2d0",
      "text": "      ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620268,
      "updated": 1644620642
    },
    {
      "id": "6206e9ed1280f0000001c2d1",
      "text": "      console.log(getTemplate(new Date()));",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620269,
      "updated": 1644620642
    },
    {
      "id": "6206eb591280f00000fd9d55",
      "text": "   08:03:56 minifyした`getTemplate()`が配列ではなく文字列を返していた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620633,
      "updated": 1644620663
    },
    {
      "id": "6206eb771280f00000fd9d57",
      "text": "   　`.join(\"\\n\")`しちゃっている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620663,
      "updated": 1644620675
    },
    {
      "id": "6206ebd01280f00000fd9d58",
      "text": "   08:05:54 解決",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620752,
      "updated": 1644620755
    },
    {
      "id": "6206ebdf1280f00000fd9d59",
      "text": "    単に自分がbundleしたコードの`getTemplate()`のversionが古かっただけでした",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620767,
      "updated": 1644620797
    },
    {
      "id": "6206ebfd1280f00000fd9d5a",
      "text": "     [scrapbox-bundler]の[cache]を消していなかった",
      "userId": "5b5e7121417cf700145b98c2",
      "created": 1644620797,
      "updated": 1667130591
    },
    {
      "id": "6206ec0d1280f00000fd9d5b",
      "text": "    お騒がせしました……",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644620813,
      "updated": 1644620823
    },
    {
      "id": "62066c631280f000005260cf",
      "text": " [/icons/done.icon]ピンを外す処理で与えられた日付を使っていない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588131,
      "updated": 1644623532
    },
    {
      "id": "62066c761280f000005260d0",
      "text": "  書き換え忘れていた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644588149,
      "updated": 1644588155
    },
    {
      "id": "6206f6ad1280f000006d1e3e",
      "text": "  2022-02-12 08:52:22  直した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623533,
      "updated": 1644623549
    },
    {
      "id": "62076d4b1280f000005d7342",
      "text": " [/icons/done.icon]今日の日付以外の日記ページのPinがはずれない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644653900,
      "updated": 1644653937
    },
    {
      "id": "62076d5b1280f000005d7343",
      "text": "  `!==`と`===`を間違えていた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644653916,
      "updated": 1644653928
    },
    {
      "id": "62064e6e1280f0000036f5f9",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580462,
      "updated": 1644580462
    },
    {
      "id": "62063e921280f000007744c5",
      "text": "不必要にややこしくなってしまった[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576402,
      "updated": 1644576424
    },
    {
      "id": "62063ea71280f000007744c6",
      "text": " algorithmは完全に効率度外視で書いた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576424,
      "updated": 1644576455
    },
    {
      "id": "62063ec71280f000007744c7",
      "text": " 流石にコードに自信が持てなかったのでテストを書いた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576455,
      "updated": 1644576476
    },
    {
      "id": "62063f8c1280f000007744d1",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576653,
      "updated": 1644576653
    },
    {
      "id": "6206301a1280f000007743a5",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572698,
      "updated": 1644622701
    },
    {
      "id": "6204e4af1280f000003b30cb",
      "text": "code:mod.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644487855,
      "updated": 1644576496
    },
    {
      "id": "6204e5451280f000003b311a",
      "text": " /// <reference no-default-lib=\"true\"/>",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488005,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b311b",
      "text": " /// <reference lib=\"esnext\"/>",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b311c",
      "text": " /// <reference lib=\"dom\"/>",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6206405b1280f000007744dc",
      "text": " import { patchTemplate } from \"./format.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576859,
      "updated": 1644577555
    },
    {
      "id": "6204e5461280f000003b311e",
      "text": " import {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644577567
    },
    {
      "id": "6206431e1280f00000774543",
      "text": "   pin,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577567,
      "updated": 1644577581
    },
    {
      "id": "6206432c1280f00000774545",
      "text": "   unpin,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577581,
      "updated": 1644577582
    },
    {
      "id": "6206432e1280f00000774546",
      "text": "   patch,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577582,
      "updated": 1644577583
    },
    {
      "id": "6206432f1280f00000774547",
      "text": "   useStatusBar,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577583,
      "updated": 1644577583
    },
    {
      "id": "6206f3831280f000006d1e02",
      "text": "   sleep,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622723,
      "updated": 1644622724
    },
    {
      "id": "6206f3891280f000006d1e03",
      "text": "   getTemplate,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622729,
      "updated": 1644622730
    },
    {
      "id": "620643201280f00000774544",
      "text": " } from \"./deps.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577568,
      "updated": 1644622736
    },
    {
      "id": "6206f7021280f000006d1e43",
      "text": " import { listPinnedDiaries } from \"./list.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623618,
      "updated": 1644623642
    },
    {
      "id": "6204e5461280f000003b3120",
      "text": " import type { Scrapbox } from \"./deps.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644622747
    },
    {
      "id": "6204e5461280f000003b3121",
      "text": " declare const scrapbox: Scrapbox;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3122",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "62063f1a1280f000007744cd",
      "text": " // initialize",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576539,
      "updated": 1644576539
    },
    {
      "id": "62063eff1280f000007744c8",
      "text": " export function launch(project: string, interval = 24 * 3600 * 1000) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576511,
      "updated": 1644576643
    },
    {
      "id": "6204e5461280f000003b3124",
      "text": "   const handleChange = () =>",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644576531
    },
    {
      "id": "6204e5461280f000003b3125",
      "text": "     scrapbox.Project.name === project ? startObserve(project, interval) : endObserve();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644576966
    },
    {
      "id": "6204e5461280f000003b3126",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644576531
    },
    {
      "id": "6204e5461280f000003b3128",
      "text": "   handleChange();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644576531
    },
    {
      "id": "6204e5461280f000003b3129",
      "text": "   scrapbox.addListener(\"project:changed\", handleChange);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644576531
    },
    {
      "id": "62063f171280f000007744c9",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576536,
      "updated": 1644576536
    },
    {
      "id": "6204e5461280f000003b312a",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "62063f2a1280f000007744cf",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576554,
      "updated": 1644576554
    },
    {
      "id": "62063f5e1280f000007744d0",
      "text": "一定時間ごとにピン留めを更新する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576934,
      "updated": 1644576935
    },
    {
      "id": "62063f251280f000007744ce",
      "text": "code:mod.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576934,
      "updated": 1644576934
    },
    {
      "id": "6204e5461280f000003b312b",
      "text": " let updateTimer: number | undefined;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b312c",
      "text": " async function startObserve(project: string, interval: number) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576962
    },
    {
      "id": "6204e5461280f000003b312d",
      "text": "   endObserve();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b3132",
      "text": "   await pinDiary(project, new Date());",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576960
    },
    {
      "id": "6204e5461280f000003b3133",
      "text": "   updateTimer = setInterval(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576982
    },
    {
      "id": "6204e5461280f000003b3134",
      "text": "     () => pinDiary(project, new Date()),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576957
    },
    {
      "id": "6204e5461280f000003b3135",
      "text": "     interval,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b3136",
      "text": "   );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b3137",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b3138",
      "text": " function endObserve() {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b3139",
      "text": "   clearInterval(updateTimer);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b313a",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576939,
      "updated": 1644576939
    },
    {
      "id": "6204e5461280f000003b313b",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576934,
      "updated": 1644576934
    },
    {
      "id": "62062ea51280f0000077437b",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576934,
      "updated": 1644576934
    },
    {
      "id": "62062ea61280f0000077437c",
      "text": "`project`中の`date`で指定した日付ページをピン留めする",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572325,
      "updated": 1644572363
    },
    {
      "id": "62062ea01280f0000077437a",
      "text": "code:mod.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572320,
      "updated": 1644576782
    },
    {
      "id": "6204e5461280f000003b313c",
      "text": " export async function pinDiary(project: string, date: Date): Promise<void> {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644577372
    },
    {
      "id": "6206448d1280f00000774564",
      "text": "   const { render, dispose } = useStatusBar();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577934,
      "updated": 1644577934
    },
    {
      "id": "620644871280f00000774563",
      "text": "   try {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577927,
      "updated": 1644577929
    },
    {
      "id": "6206f7651280f000006d1e4f",
      "text": "     // 今日以外の日付ページを外す",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623717,
      "updated": 1644623717
    },
    {
      "id": "620643941280f0000077454a",
      "text": "     render(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577684,
      "updated": 1644577941
    },
    {
      "id": "620643d91280f0000077454d",
      "text": "       { type: \"spinner\" },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577753,
      "updated": 1644577941
    },
    {
      "id": "620643d81280f0000077454c",
      "text": "       { type: \"text\", text: `unpin other diary pages...`},",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577753,
      "updated": 1644623691
    },
    {
      "id": "620643e21280f0000077454e",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577763,
      "updated": 1644577941
    },
    {
      "id": "6204e5461280f000003b3142",
      "text": "     for await (const { title } of listPinnedDiaries(project)) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644623669
    },
    {
      "id": "6206f7551280f000006d1e4b",
      "text": "       if (title === toYYYYMMDD(date)) continue;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623701,
      "updated": 1644653895
    },
    {
      "id": "6204e5461280f000003b3145",
      "text": "       await unpin(project, title);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644577941
    },
    {
      "id": "6204e5461280f000003b3146",
      "text": "     }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644577941
    },
    {
      "id": "62062f151280f0000077437e",
      "text": "     ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572437,
      "updated": 1644577941
    },
    {
      "id": "62062f391280f00000774381",
      "text": "     // 今日の日付ページをピン留めする",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572473,
      "updated": 1644577941
    },
    {
      "id": "62062ff11280f000007743a2",
      "text": "     const [title, header, footer] = getTemplate(date);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572657,
      "updated": 1644577941
    },
    {
      "id": "620644181280f00000774553",
      "text": "     render(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577817,
      "updated": 1644577941
    },
    {
      "id": "620644181280f00000774554",
      "text": "       { type: \"spinner\" },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577817,
      "updated": 1644577941
    },
    {
      "id": "620644181280f00000774555",
      "text": "       { type: \"text\", text: `pin \"/${project}/${title}\"...`},",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577817,
      "updated": 1644577941
    },
    {
      "id": "620644181280f00000774556",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577817,
      "updated": 1644577941
    },
    {
      "id": "62062f471280f00000774382",
      "text": "     await pin(project, title, { create: true });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572487,
      "updated": 1644577941
    },
    {
      "id": "62062f161280f0000077437f",
      "text": "     ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572438,
      "updated": 1644577941
    },
    {
      "id": "6204e5461280f000003b3147",
      "text": "     // 今日の日付ページにtemplateを挿入する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644577941
    },
    {
      "id": "620631791280f000007743b4",
      "text": "     const headers = header.split(\"\\n\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573049,
      "updated": 1644577941
    },
    {
      "id": "620631791280f000007743b5",
      "text": "     const footers = footer.split(\"\\n\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573049,
      "updated": 1644577941
    },
    {
      "id": "6206441f1280f00000774557",
      "text": "     render(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577823,
      "updated": 1644577941
    },
    {
      "id": "6206441f1280f00000774558",
      "text": "       { type: \"spinner\" },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577823,
      "updated": 1644577941
    },
    {
      "id": "6206441f1280f00000774559",
      "text": "       { type: \"text\", text: `format \"/${project}/${title}\"...`},",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577823,
      "updated": 1644577941
    },
    {
      "id": "6206441f1280f0000077455a",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577823,
      "updated": 1644577941
    },
    {
      "id": "62062fb41280f00000774383",
      "text": "     await patch(project, title, (lines) => [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644572596,
      "updated": 1644579076
    },
    {
      "id": "620649031280f000007e5037",
      "text": "       lines[0].text,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579076,
      "updated": 1644579090
    },
    {
      "id": "620649091280f000007e5038",
      "text": "       ...patchTemplate(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579081,
      "updated": 1644579092
    },
    {
      "id": "620640311280f000007744d7",
      "text": "         lines.slice(1).map(line => line.text),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576817,
      "updated": 1644579084
    },
    {
      "id": "620640371280f000007744d8",
      "text": "         headers,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576823,
      "updated": 1644579084
    },
    {
      "id": "620640391280f000007744d9",
      "text": "         footers,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576825,
      "updated": 1644579084
    },
    {
      "id": "6206403e1280f000007744da",
      "text": "       ),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576830,
      "updated": 1644579087
    },
    {
      "id": "620649151280f000007e503a",
      "text": "     ]);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644579093,
      "updated": 1644579097
    },
    {
      "id": "620644311280f0000077455f",
      "text": "     ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577841,
      "updated": 1644577941
    },
    {
      "id": "620644301280f0000077455b",
      "text": "     render(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577840,
      "updated": 1644577941
    },
    {
      "id": "620644301280f0000077455c",
      "text": "       { type: \"check-circle\" },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577840,
      "updated": 1644577941
    },
    {
      "id": "620644301280f0000077455d",
      "text": "       { type: \"text\", text: `Pinned \"/${project}/${title}\".`},",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577840,
      "updated": 1644577941
    },
    {
      "id": "620644301280f0000077455e",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577840,
      "updated": 1644577941
    },
    {
      "id": "620644961280f00000774565",
      "text": "   } catch(e: unknown) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577943,
      "updated": 1644577951
    },
    {
      "id": "620645141280f00000774571",
      "text": "     render(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774572",
      "text": "       { type: \"exclamation-triangle\" },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774573",
      "text": "       { type: \"text\", text: e instanceof Error ?",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774574",
      "text": "         `${e.name} ${e.message}` :",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774575",
      "text": "         `Unknown error! (see developper console)`,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774576",
      "text": "       },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "620645141280f00000774577",
      "text": "     );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578068,
      "updated": 1644578069
    },
    {
      "id": "6206452a1280f00000774584",
      "text": "     console.error(e);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578090,
      "updated": 1644578099
    },
    {
      "id": "620644a11280f00000774567",
      "text": "   } finally {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577953,
      "updated": 1644578081
    },
    {
      "id": "6206451b1280f00000774582",
      "text": "     await sleep(1000);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578075,
      "updated": 1644578075
    },
    {
      "id": "6206446c1280f00000774562",
      "text": "     dispose();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577900,
      "updated": 1644578076
    },
    {
      "id": "620645231280f00000774583",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578084,
      "updated": 1644578084
    },
    {
      "id": "6204e5461280f000003b315c",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b315d",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b315e",
      "text": " function toYYYYMMDD(date: Date) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b315f",
      "text": "   return `${date.getFullYear()}/${zero(date.getMonth() + 1)}/${",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3160",
      "text": "     zero(date.getDate())",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3161",
      "text": "   }`;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3162",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3163",
      "text": " function zero(n: number) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3164",
      "text": "   return String(n).padStart(2, \"0\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "6204e5461280f000003b3165",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "620631d01280f000007743b9",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573136,
      "updated": 1644573136
    },
    {
      "id": "6206375b1280f000007743ef",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574555,
      "updated": 1644574556
    },
    {
      "id": "6206f4671280f000006d1e0e",
      "text": "ピン留めされた日記ページを探す",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622950,
      "updated": 1644622972
    },
    {
      "id": "6206f47c1280f000006d1e0f",
      "text": "code:list.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622972,
      "updated": 1644622974
    },
    {
      "id": "6206f5281280f000006d1e24",
      "text": " import { listPages, PageSummary } from \"./deps.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623144,
      "updated": 1644623919
    },
    {
      "id": "6206f5281280f000006d1e25",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623144,
      "updated": 1644623144
    },
    {
      "id": "6206f47e1280f000006d1e10",
      "text": " export async function* listPinnedDiaries(project: string): AsyncGenerator<PageSummary> {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622974,
      "updated": 1644623929
    },
    {
      "id": "6206f4de1280f000006d1e19",
      "text": "   for await (const page of listPinnedPages(project)) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623070,
      "updated": 1644623833
    },
    {
      "id": "6206f6801280f000006d1e3d",
      "text": "     if (!/\\d{4}\\/\\d{2}\\/\\d{2}/.test(page.title)) continue;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623488,
      "updated": 1644623596
    },
    {
      "id": "6206f6ec1280f000006d1e3f",
      "text": "     yield page;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623596,
      "updated": 1644623600
    },
    {
      "id": "6206f6f01280f000006d1e40",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623601,
      "updated": 1644623602
    },
    {
      "id": "6206f48b1280f000006d1e12",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622987,
      "updated": 1644622987
    },
    {
      "id": "6206f5021280f000006d1e1b",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623106,
      "updated": 1644623106
    },
    {
      "id": "6206f6281280f000006d1e3b",
      "text": " /** 全てのピン留めされたページを取得する */",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623401,
      "updated": 1644623471
    },
    {
      "id": "6206f57c1280f000006d1e32",
      "text": " async function* listPinnedPages(project: string, skip = 0): AsyncGenerator<PageSummary> {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623228,
      "updated": 1644623921
    },
    {
      "id": "6206f5941280f000006d1e34",
      "text": "   const { count, pages } = await ensureList(project, skip);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623253,
      "updated": 1644623797
    },
    {
      "id": "6206f5ae1280f000006d1e35",
      "text": "   for (const page of pages) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623278,
      "updated": 1644623810
    },
    {
      "id": "6206f5bd1280f000006d1e36",
      "text": "     if (page.pin === 0) continue;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623293,
      "updated": 1644623304
    },
    {
      "id": "6206f5c91280f000006d1e37",
      "text": "     yield page;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623305,
      "updated": 1644623309
    },
    {
      "id": "6206f5cd1280f000006d1e38",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623310,
      "updated": 1644623311
    },
    {
      "id": "6206f5d01280f000006d1e39",
      "text": "   if ((pages.at(-1)?.pin ?? 0) === 0) return;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623312,
      "updated": 1644623349
    },
    {
      "id": "6206f5f71280f000006d1e3a",
      "text": "   yield* listPinnedPages(project, skip + 1000);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623351,
      "updated": 1644623396
    },
    {
      "id": "6206f5921280f000006d1e33",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623251,
      "updated": 1644623251
    },
    {
      "id": "6206f57b1280f000006d1e31",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623228,
      "updated": 1644623228
    },
    {
      "id": "6206f5021280f000006d1e1c",
      "text": " async function ensureList(project: string, skip: number) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623106,
      "updated": 1644623371
    },
    {
      "id": "6206f5511280f000006d1e28",
      "text": "   const result = await listPages(project, { limit: 1000, skip });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623185,
      "updated": 1644623191
    },
    {
      "id": "6206f6451280f000006d1e3c",
      "text": "   // login errorなどは全部例外として扱う",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623430,
      "updated": 1644623445
    },
    {
      "id": "6206f55f1280f000006d1e29",
      "text": "   if (!result.ok) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f55f1280f000006d1e2a",
      "text": "     const error = new Error();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f55f1280f000006d1e2b",
      "text": "     error.name = result.value.name;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f55f1280f000006d1e2c",
      "text": "     error.message = result.value.message;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f55f1280f000006d1e2d",
      "text": "     throw error;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f55f1280f000006d1e2e",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623199,
      "updated": 1644623199
    },
    {
      "id": "6206f5601280f000006d1e2f",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623200,
      "updated": 1644623200
    },
    {
      "id": "6206f5601280f000006d1e30",
      "text": "   return result.value;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623200,
      "updated": 1644623203
    },
    {
      "id": "6206f54f1280f000006d1e27",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623183,
      "updated": 1644623183
    },
    {
      "id": "6206f6fa1280f000006d1e41",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623610,
      "updated": 1644623610
    },
    {
      "id": "6206f4661280f000006d1e0d",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622950,
      "updated": 1644622950
    },
    {
      "id": "6206f33f1280f000006d1dec",
      "text": "dependencies",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622656,
      "updated": 1644622705
    },
    {
      "id": "6206f3711280f000006d1dfd",
      "text": " [日記ページのtemplate]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622705,
      "updated": 1644622705
    },
    {
      "id": "6206f3711280f000006d1dfe",
      "text": " [scrapbox-userscript-std]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622705,
      "updated": 1644622705
    },
    {
      "id": "6206f3711280f000006d1dff",
      "text": " 型定義ファイル",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622705,
      "updated": 1644623888
    },
    {
      "id": "6206f3421280f000006d1dee",
      "text": "code:deps.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622658,
      "updated": 1644622665
    },
    {
      "id": "6206f7821280f000006d1e57",
      "text": " export { getTemplate } from \"../日記ページのtemplate/diary.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623746,
      "updated": 1644623746
    },
    {
      "id": "6206f34a1280f000006d1df3",
      "text": " export {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644622683
    },
    {
      "id": "6206f34a1280f000006d1df4",
      "text": "   pin,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644622683
    },
    {
      "id": "6206f34a1280f000006d1df5",
      "text": "   unpin,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644622683
    },
    {
      "id": "6206f34a1280f000006d1df6",
      "text": "   patch,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644622683
    },
    {
      "id": "6206f34a1280f000006d1df7",
      "text": "   useStatusBar,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644622683
    },
    {
      "id": "6206f51e1280f000006d1e23",
      "text": "   listPages,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623738,
      "updated": 1644623738
    },
    {
      "id": "6206f34a1280f000006d1df8",
      "text": " } from \"https://raw.githubusercontent.com/takker99/scrapbox-userscript-std/0.8.0/mod.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644623984
    },
    {
      "id": "6206f34a1280f000006d1df9",
      "text": " export { sleep } from \"https://raw.githubusercontent.com/takker99/scrapbox-userscript-std/0.8.0/sleep.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644792393
    },
    {
      "id": "6206f34a1280f000006d1dfb",
      "text": " export type {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622666,
      "updated": 1644623875
    },
    {
      "id": "6206f8031280f000006d1e58",
      "text": "   Scrapbox,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623875,
      "updated": 1644623880
    },
    {
      "id": "6206f8061280f000006d1e5a",
      "text": "   PageSummary,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623878,
      "updated": 1644623915
    },
    {
      "id": "6206f8051280f000006d1e59",
      "text": " } from \"https://raw.githubusercontent.com/scrapbox-jp/types/0.0.8/mod.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644623877,
      "updated": 1644623882
    },
    {
      "id": "6206f3691280f000006d1dfc",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622697,
      "updated": 1644622697
    },
    {
      "id": "6206f33f1280f000006d1ded",
      "text": "code:deps_test.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622656,
      "updated": 1644622772
    },
    {
      "id": "6206f3bb1280f000006d1e07",
      "text": " export { assertEquals } from \"https://deno.land/std@0.125.0/testing/asserts.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622779,
      "updated": 1644622781
    },
    {
      "id": "6206f3b41280f000006d1e06",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622772,
      "updated": 1644622773
    },
    {
      "id": "6206f3ae1280f000006d1e05",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622767,
      "updated": 1644622767
    },
    {
      "id": "62063ad61280f0000077442d",
      "text": "日記ページにtemplateを入れる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575446,
      "updated": 1644575454
    },
    {
      "id": "62390f121280f00000c11cd0",
      "text": " バグ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1647906578,
      "updated": 1647906580
    },
    {
      "id": "62390f141280f00000c11cd1",
      "text": "  [2022/03/21#6237db0e1280f0000097f5a8]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1647906580,
      "updated": 1647906580
    },
    {
      "id": "62063acb1280f0000077442c",
      "text": "code:format.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575435,
      "updated": 1644575442
    },
    {
      "id": "62063b1f1280f00000774474",
      "text": " import { patchLines, findSplitIndex } from \"./util.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575519,
      "updated": 1644575519
    },
    {
      "id": "62063b1f1280f00000774475",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575519,
      "updated": 1644575519
    },
    {
      "id": "62064ecc1280f0000036f5fe",
      "text": " // linesにタイトルを入れないように",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644580556,
      "updated": 1644580563
    },
    {
      "id": "62063ae01280f0000077442e",
      "text": " export function patchTemplate(lines: string[], headers: string[], footers: string[]): string[] {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575456,
      "updated": 1644576122
    },
    {
      "id": "62063b0c1280f00000774431",
      "text": "   // headerとfooterに相当する行を補う",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f00000774432",
      "text": "   const bodies = patchLines(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575549
    },
    {
      "id": "62063b3c1280f00000774476",
      "text": "     patchLines(lines, headers).reverse(),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575549,
      "updated": 1644575550
    },
    {
      "id": "62063d891280f000007744b4",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576137,
      "updated": 1644576137
    },
    {
      "id": "62063d8a1280f000007744b5",
      "text": "[Array.prototype.reverse()]は元の配列を変更する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576138,
      "updated": 1644576155
    },
    {
      "id": "62063d9c1280f000007744b6",
      "text": " [Array.prototype.splice()]パターンかよ止めてくれ……[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576156,
      "updated": 1644576170
    },
    {
      "id": "62063d7d1280f000007744b3",
      "text": "code:format.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576125,
      "updated": 1644576135
    },
    {
      "id": "62063b3e1280f00000774477",
      "text": "     [...footers].reverse(),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575550,
      "updated": 1644576083
    },
    {
      "id": "62063b411280f00000774478",
      "text": "   ).reverse();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575553,
      "updated": 1644575553
    },
    {
      "id": "62063b0c1280f00000774439",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f0000077443a",
      "text": "   // headerとfooterの間に余裕をもたせる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f0000077443b",
      "text": "   const headerStart = findSplitIndex(bodies, headers);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f0000077443c",
      "text": "   const footerStart = bodies.length - 1 - findSplitIndex(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644576195
    },
    {
      "id": "62063dc31280f000007744b7",
      "text": "     [...bodies].reverse(),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576195,
      "updated": 1644576201
    },
    {
      "id": "62063dc81280f000007744b9",
      "text": "     [...footers].reverse(),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576201,
      "updated": 1644576202
    },
    {
      "id": "62063dc51280f000007744b8",
      "text": "   );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576197,
      "updated": 1644576197
    },
    {
      "id": "62063b0c1280f0000077443d",
      "text": "   return [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f0000077443e",
      "text": "     ...bodies.slice(0, headerStart + 1),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644576374
    },
    {
      "id": "62063b0c1280f0000077443f",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f00000774440",
      "text": "     ...bodies.slice(headerStart + 1, footerStart).join(\"\\n\").trim().split(\"\\n\"),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644576378
    },
    {
      "id": "62063b0c1280f00000774441",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f00000774442",
      "text": "     ...bodies.slice(footerStart),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b0c1280f00000774443",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575500,
      "updated": 1644575524
    },
    {
      "id": "62063b011280f0000077442f",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575489,
      "updated": 1644575489
    },
    {
      "id": "6206f3ab1280f000006d1e04",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622763,
      "updated": 1644622763
    },
    {
      "id": "62063c351280f000007744b0",
      "text": "$ deno test https://scrapbox.io/api/code/villagepump/pin-diary-5/format_test.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575797,
      "updated": 1644575803
    },
    {
      "id": "62063b521280f0000077447a",
      "text": "code:format_test.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575570,
      "updated": 1644575575
    },
    {
      "id": "62063b601280f0000077447c",
      "text": " import { patchTemplate } from \"./format.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575585,
      "updated": 1644575592
    },
    {
      "id": "6206f3c41280f000006d1e08",
      "text": " import { assertEquals } from \"./deps_test.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622788,
      "updated": 1644622795
    },
    {
      "id": "62063b6a1280f0000077447e",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575594,
      "updated": 1644575594
    },
    {
      "id": "62063b6a1280f0000077447f",
      "text": " Deno.test(\"patchTemplate()\", () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575594,
      "updated": 1644575607
    },
    {
      "id": "62063b831280f00000774482",
      "text": "   const headers = [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575631
    },
    {
      "id": "62063b831280f00000774483",
      "text": "     \"header start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575634
    },
    {
      "id": "62063b831280f00000774484",
      "text": "     \"header content\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575639
    },
    {
      "id": "62063be51280f000007744a7",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575717,
      "updated": 1644575718
    },
    {
      "id": "62063b831280f00000774485",
      "text": "     \"header end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575636
    },
    {
      "id": "62063b831280f00000774486",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f00000774487",
      "text": "   const lines = [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f00000774488",
      "text": "     \"何か\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f00000774489",
      "text": "     \"aaa\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f0000077448a",
      "text": "     \"header content\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575726
    },
    {
      "id": "62063b831280f0000077448b",
      "text": "     \" コメントが書いてあるかも\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f0000077448c",
      "text": "     \"header end modified\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575729
    },
    {
      "id": "62063b831280f0000077448d",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f0000077448e",
      "text": "     \"本文とか\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b831280f0000077448f",
      "text": "     \"おしまい\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063bac1280f00000774496",
      "text": "     \"footer end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575660,
      "updated": 1644575667
    },
    {
      "id": "62063bb31280f00000774497",
      "text": "     \" ↑footerの残骸\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575667,
      "updated": 1644575680
    },
    {
      "id": "62063b831280f00000774490",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575619,
      "updated": 1644575619
    },
    {
      "id": "62063b891280f00000774491",
      "text": "   const footers = [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575625,
      "updated": 1644575646
    },
    {
      "id": "62063ba21280f00000774493",
      "text": "     \"footer start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575650,
      "updated": 1644575654
    },
    {
      "id": "62063ba21280f00000774494",
      "text": "     \"footer content\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575650,
      "updated": 1644575656
    },
    {
      "id": "62063ba21280f00000774495",
      "text": "     \"footer end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575650,
      "updated": 1644575657
    },
    {
      "id": "62063b9e1280f00000774492",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575646,
      "updated": 1644575647
    },
    {
      "id": "62063bd01280f000007744a6",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575696,
      "updated": 1644575696
    },
    {
      "id": "62063bcf1280f0000077449a",
      "text": "   assertEquals<string[]>(patchTemplate(lines, headers, footers), [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575794
    },
    {
      "id": "62063bcf1280f0000077449b",
      "text": "     \"header start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575702
    },
    {
      "id": "62063bcf1280f0000077449c",
      "text": "     \"何か\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063bcf1280f0000077449d",
      "text": "     \"aaa\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063bcf1280f0000077449e",
      "text": "     \"header content\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575710
    },
    {
      "id": "62063bcf1280f000007744a0",
      "text": "     \" コメントが書いてあるかも\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063bcf1280f000007744a1",
      "text": "     \"header end modified\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575744
    },
    {
      "id": "62063bcf1280f000007744a2",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063e821280f000007744c3",
      "text": "     \"header end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576386,
      "updated": 1644576386
    },
    {
      "id": "62063e2b1280f000007744c0",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644576299,
      "updated": 1644576299
    },
    {
      "id": "62063bcf1280f000007744a3",
      "text": "     \"本文とか\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063bcf1280f000007744a4",
      "text": "     \"おしまい\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063c191280f000007744aa",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575769,
      "updated": 1644575770
    },
    {
      "id": "62063c201280f000007744ac",
      "text": "     \"footer start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575776,
      "updated": 1644575776
    },
    {
      "id": "62063c201280f000007744ad",
      "text": "     \"footer content\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575776,
      "updated": 1644575776
    },
    {
      "id": "62063c201280f000007744ae",
      "text": "     \"footer end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575776,
      "updated": 1644575776
    },
    {
      "id": "62063c241280f000007744af",
      "text": "     \" ↑footerの残骸\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575780,
      "updated": 1644575780
    },
    {
      "id": "62063bcf1280f000007744a5",
      "text": "   ]);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575695,
      "updated": 1644575695
    },
    {
      "id": "62063b771280f00000774480",
      "text": " });",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575607,
      "updated": 1644575609
    },
    {
      "id": "62063b581280f0000077447b",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575575,
      "updated": 1644575575
    },
    {
      "id": "62063b521280f00000774479",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575570,
      "updated": 1644575570
    },
    {
      "id": "6206374e1280f000007743ee",
      "text": "code:util.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574542,
      "updated": 1644574553
    },
    {
      "id": "620631d11280f000007743ba",
      "text": " export function patchLines(lines: string[], appends: string[]) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573137,
      "updated": 1644574544
    },
    {
      "id": "6206320c1280f000007743c0",
      "text": "   let index = 0;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573196,
      "updated": 1644573813
    },
    {
      "id": "620634751280f000007743d7",
      "text": "   const result = [] as string[];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573813,
      "updated": 1644573882
    },
    {
      "id": "620633d51280f000007743d4",
      "text": "   for (let i = 0; i < appends.length; i++) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573653,
      "updated": 1644573745
    },
    {
      "id": "620633e31280f000007743d5",
      "text": "     const pos = lines.findIndex((line, j) => j >= index && line.trim() === appends[i].trim());",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573667,
      "updated": 1644574189
    },
    {
      "id": "6206340d1280f000007743d6",
      "text": "     if (pos < 0) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573710,
      "updated": 1644574015
    },
    {
      "id": "6206353f1280f000007743dc",
      "text": "       result.push(appends[i]);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574015,
      "updated": 1644574015
    },
    {
      "id": "6206354b1280f000007743de",
      "text": "       continue;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574027,
      "updated": 1644574029
    },
    {
      "id": "620635411280f000007743dd",
      "text": "     }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574017,
      "updated": 1644574018
    },
    {
      "id": "620634d01280f000007743da",
      "text": "     result.push(...lines.slice(index, pos + 1));",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573904,
      "updated": 1644574069
    },
    {
      "id": "620635331280f000007743db",
      "text": "     index = pos + 1;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574003,
      "updated": 1644574183
    },
    {
      "id": "6206325c1280f000007743c4",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573276,
      "updated": 1644574009
    },
    {
      "id": "6206386a1280f00000774408",
      "text": "   result.push(...lines.slice(index));",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574826,
      "updated": 1644574842
    },
    {
      "id": "6206325d1280f000007743c5",
      "text": "   return result;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573276,
      "updated": 1644574109
    },
    {
      "id": "620631f21280f000007743bc",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644573170,
      "updated": 1644573170
    },
    {
      "id": "6204e5461280f000003b3166",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644488006,
      "updated": 1644488006
    },
    {
      "id": "620638ff1280f00000774418",
      "text": " export function findSplitIndex(lines: string[], query: string[]) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574975,
      "updated": 1644575831
    },
    {
      "id": "6206397a1280f0000077441d",
      "text": "   let index = -1;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575099,
      "updated": 1644575155
    },
    {
      "id": "620639241280f00000774419",
      "text": "   for (const text of query) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575012,
      "updated": 1644575075
    },
    {
      "id": "6206394b1280f0000077441b",
      "text": "     const pos = lines.findIndex((line, j) => j > index && line.trim() === text.trim());",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575052,
      "updated": 1644575283
    },
    {
      "id": "620639981280f0000077441e",
      "text": "     if (pos < 0) return -1;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575129,
      "updated": 1644575137
    },
    {
      "id": "620639a11280f0000077441f",
      "text": "     index = pos;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575137,
      "updated": 1644575146
    },
    {
      "id": "6206394c1280f0000077441c",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575052,
      "updated": 1644575052
    },
    {
      "id": "620639b81280f00000774420",
      "text": "   return index;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575160,
      "updated": 1644575172
    },
    {
      "id": "620639251280f0000077441a",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644575013,
      "updated": 1644575013
    },
    {
      "id": "620638ea1280f00000774417",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574954,
      "updated": 1644574954
    },
    {
      "id": "620638e21280f00000774416",
      "text": "$ deno test https://scrapbox.io/api/code/villagepump/pin-diary-5/util_test.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574946,
      "updated": 1644574950
    },
    {
      "id": "6204e4ab1280f000003b30c9",
      "text": "code:util_test.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644487851,
      "updated": 1644574620
    },
    {
      "id": "620637ad1280f000007743f3",
      "text": " import { patchLines } from \"./util.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574637,
      "updated": 1644574637
    },
    {
      "id": "6206f3d31280f000006d1e09",
      "text": " import { assertEquals } from \"./deps_test.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644622803,
      "updated": 1644622803
    },
    {
      "id": "620637c11280f000007743f5",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574657,
      "updated": 1644574657
    },
    {
      "id": "6206377e1280f000007743f2",
      "text": " Deno.test(\"patchLines()\", () => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574590,
      "updated": 1644574656
    },
    {
      "id": "620638011280f000007743fa",
      "text": "   const template = [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574721,
      "updated": 1644574726
    },
    {
      "id": "620638051280f000007743fb",
      "text": "     \"template start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574726,
      "updated": 1644574732
    },
    {
      "id": "6206380c1280f000007743fd",
      "text": "     \"template template\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574732,
      "updated": 1644574740
    },
    {
      "id": "620638141280f000007743fe",
      "text": "     \"template end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574740,
      "updated": 1644575749
    },
    {
      "id": "620638071280f000007743fc",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574727,
      "updated": 1644574748
    },
    {
      "id": "6206381c1280f000007743ff",
      "text": "   const lines = [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574748,
      "updated": 1644574751
    },
    {
      "id": "6206381f1280f00000774400",
      "text": "     \"何か\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574751,
      "updated": 1644574761
    },
    {
      "id": "620638501280f00000774404",
      "text": "     \"aaa\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574800,
      "updated": 1644574808
    },
    {
      "id": "620638291280f00000774401",
      "text": "     \"template template\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574761,
      "updated": 1644574778
    },
    {
      "id": "6206383a1280f00000774402",
      "text": "     \" コメントが書いてあるかも\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574778,
      "updated": 1644574785
    },
    {
      "id": "620638411280f00000774403",
      "text": "     \"template end modified\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574785,
      "updated": 1644575750
    },
    {
      "id": "6206385b1280f00000774406",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574811,
      "updated": 1644574814
    },
    {
      "id": "6206385e1280f00000774407",
      "text": "     \"本文とか\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574814,
      "updated": 1644574819
    },
    {
      "id": "6206387d1280f00000774409",
      "text": "     \"おしまい\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574845,
      "updated": 1644574849
    },
    {
      "id": "620638591280f00000774405",
      "text": "   ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574809,
      "updated": 1644574821
    },
    {
      "id": "620637c21280f000007743f6",
      "text": "   assertEquals<string[]>(patchLines(lines, template), [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574658,
      "updated": 1644574863
    },
    {
      "id": "620638941280f0000077440c",
      "text": "     \"template start\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574868,
      "updated": 1644574868
    },
    {
      "id": "6206389a1280f0000077440d",
      "text": "     \"何か\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574874,
      "updated": 1644574874
    },
    {
      "id": "6206389a1280f0000077440e",
      "text": "     \"aaa\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574874,
      "updated": 1644574874
    },
    {
      "id": "6206389a1280f0000077440f",
      "text": "     \"template template\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574874,
      "updated": 1644574874
    },
    {
      "id": "620638cb1280f00000774415",
      "text": "     \"template end\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574923,
      "updated": 1644575752
    },
    {
      "id": "6206389a1280f00000774410",
      "text": "     \" コメントが書いてあるかも\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574874,
      "updated": 1644574874
    },
    {
      "id": "620638a71280f00000774411",
      "text": "     \"template end modified\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574887,
      "updated": 1644622853
    },
    {
      "id": "620638a71280f00000774412",
      "text": "     \"\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574887,
      "updated": 1644574887
    },
    {
      "id": "620638a71280f00000774413",
      "text": "     \"本文とか\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574887,
      "updated": 1644574887
    },
    {
      "id": "620638a71280f00000774414",
      "text": "     \"おしまい\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574887,
      "updated": 1644574887
    },
    {
      "id": "620638901280f0000077440b",
      "text": "   ]);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574864,
      "updated": 1644574866
    },
    {
      "id": "620637c01280f000007743f4",
      "text": " })",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574656,
      "updated": 1644574656
    },
    {
      "id": "620637781280f000007743f1",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644574585,
      "updated": 1644574585
    },
    {
      "id": "620640ff1280f000007744eb",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577023,
      "updated": 1644577023
    },
    {
      "id": "620640ff1280f000007744ec",
      "text": "[/icons/hr.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577023,
      "updated": 1644577027
    },
    {
      "id": "620641001280f000007744ed",
      "text": "bundled code",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577024,
      "updated": 1644577033
    },
    {
      "id": "620641091280f000007744ef",
      "text": " [get the bundled code https://scrapbox-bundler.vercel.app/?url=https://scrapbox.io/api/code/villagepump/pin-diary-5/mod.ts&bundle&minify&run&output=newtab]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577034,
      "updated": 1644577074
    },
    {
      "id": "620641041280f000007744ee",
      "text": "code:mod.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577029,
      "updated": 1644577078
    },
    {
      "id": "620646f41280f000007e5020",
      "text": " function G(e,t){let n=0,r=[];for(let o=0;o<t.length;o++){let s=e.findIndex((i,a)=>a>=n&&i.trim()===t[o].trim());if(s<0){r.push(t[o]);continue}r.push(...e.slice(n,s+1)),n=s+1}return r.push(...e.slice(n)),r}function X(e,t){let n=-1;for(let r of t){let o=e.findIndex((s,i)=>i>n&&s.trim()===r.trim());if(o<0)return-1;n=o}return n}function be(e,t,n){let r=G(G(e,t).reverse(),[...n].reverse()).reverse(),o=X(r,t),s=r.length-1-X([...r].reverse(),[...n].reverse());return[...r.slice(0,o+1),\"\",...r.slice(o+1,s).join(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644578548,
      "updated": 1644654085
    },
    {
      "id": "62076e031280f000005d7344",
      "text": " `).trim().split(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d7345",
      "text": " `),\"\",...r.slice(s)]}function u(e,t){if(t.length<e)throw new TypeError(e+\" argument\"+(e>1?\"s\":\"\")+\" required, but only \"+t.length+\" present\")}function l(e){u(1,arguments);let t=Object.prototype.toString.call(e);return e instanceof Date||typeof e==\"object\"&&t===\"[object Date]\"?new Date(e.getTime()):typeof e==\"number\"||t===\"[object Number]\"?new Date(e):((typeof e==\"string\"||t===\"[object String]\")&&typeof console!=\"undefined\"&&(console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"),console.warn(new Error().stack)),new Date(NaN))}function V(e){u(1,arguments);let n=l(e).getFullYear();return n%400==0||n%4==0&&n%100!=0}function J(e){u(1,arguments);let t=l(e);return String(new Date(t))===\"Invalid Date\"?NaN:V(t)?366:365}function Z(e){u(1,arguments);let t=l(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function A(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Y(e){u(1,arguments);let t=l(e);return t.setHours(0,0,0,0),t}var Xe=864e5;function ee(e,t){u(2,arguments);let n=Y(e),r=Y(t),o=n.getTime()-A(n),s=r.getTime()-A(r);return Math.round((o-s)/Xe)}function te(e){u(1,arguments);let t=l(e);return ee(t,Z(t))+1}function f(e){if(e===null||e===!0||e===!1)return NaN;let t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function I(e,t){u(2,arguments);let n=l(e),r=f(t);return isNaN(r)?new Date(NaN):(r&&n.setDate(n.getDate()+r),n)}function K(e,t){u(2,arguments);let n=f(t);return I(e,-n)}function ne(e,t){u(2,arguments);let r=f(t)*7;return I(e,r)}function $(e,t){u(2,arguments);let n=f(t);return ne(e,-n)}function _(e,t){u(2,arguments);let n=l(e),r=f(t);if(isNaN(r))return new Date(NaN);if(!r)return n;let o=n.getDate(),s=new Date(n.getTime());s.setMonth(n.getMonth()+r+1,0);let i=s.getDate();return o>=i?s:(n.setFullYear(s.getFullYear(),s.getMonth(),o),n)}function R(e,t){u(2,arguments);let n=f(t);return _(e,-n)}function re(e,t){u(2,arguments);let n=f(t);return _(e,n*12)}function oe(e,t){u(2,arguments);let n=f(t);return re(e,-n)}function se(e){return u(1,arguments),l(e).getDay()}function ie(e){return u(1,arguments),l(e).getFullYear()}function T(e,t){for(var n=e<0?\"-\":\"\",r=Math.abs(e).toString();r.length<t;)r=\"0\"+r;return n+r}var Ve={y(e,t){let n=e.getUTCFullYear(),r=n>0?n:1-n;return T(t===\"yy\"?r%100:r,t.length)},M(e,t){let n=e.getUTCMonth();return t===\"M\"?String(n+1):T(n+1,2)},d(e,t){return T(e.getUTCDate(),t.length)},a(e,t){let n=e.getUTCHours()/12>=1?\"pm\":\"am\";switch(t){case\"a\":case\"aa\":return n.toUpperCase();case\"aaa\":return n;case\"aaaaa\":return n[0];case\"aaaa\":default:return n===\"am\"?\"a.m.\":\"p.m.\"}},h(e,t){return T(e.getUTCHours()%12||12,t.length)},H(e,t){return T(e.getUTCHours(),t.length)},m(e,t){return T(e.getUTCMinutes(),t.length)},s(e,t){return T(e.getUTCSeconds(),t.length)},S(e,t){let n=t.length,r=e.getUTCMilliseconds(),o=Math.floor(r*Math.pow(10,n-3));return T(o,t.length)}},we=Ve;function ae(e){u(1,arguments);var t=l(e);return!isNaN(t)}function ce(e,t){u(2,arguments);let n=l(e).getTime(),r=f(t);return new Date(n+r)}function ue(e,t){u(2,arguments);let n=f(t);return ce(e,-n)}var Je=/(\\w)\\1*|''|'(''|[^'])+('|$)|./g,Ze=/^'([^]*?)'?$/,et=/''/g,tt=/[a-zA-Z]/;function g(e,t){u(2,arguments);let n=l(e);if(!ae(n))throw new RangeError(\"Invalid time value\");let r=A(n),o=ue(n,r),s=t.match(Je);return s?s.map(a=>{if(a===\"''\")return\"'\";let c=a[0];if(c===\"'\")return nt(a);let p=we[c];if(p)return p(o,a);if(c.match(tt))throw new RangeError(\"Format string contains an unescaped latin alphabet character `\"+c+\"`\");return a}).join(\"\"):\"\"}function nt(e){let t=e.match(Ze);return t?t[1].replace(et,\"'\"):e}var b=\"yyyy/MM/dd\",de=e=>[g(e,b),[`[${g(K(e,1),b)}.icon]←${g(e,b)}→[${g(I(e,1),b)}.icon]`,`[[${rt(e)}曜日]]`,`${ie(e)}年 ${(te(e)*100/J(e)).toFixed(2)}％経過`,`[🌏 https://ja.wikipedia.org/wiki/${g(e,\"M月d日\")}]`,[`[${g($(e,1),b)}.icon]`,`[${g($(e,2),b)}.icon]`,`[${g($(e,3),b)}.icon]`,`[${g(R(e,1),b)}.icon]`,`[${g(R(e,2),b)}.icon]`,`[${g(R(e,3),b)}.icon]`].join(\" \"),\"今日のn年前\",` [${g(oe(e,1),b)}]`].join(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d7346",
      "text": " `),`[${g(K(e,1),b)}]←${g(e,b)}→[${g(I(e,1),b)}]`];function rt(e){switch(se(e)){case 0:return\"日\";case 1:return\"月\";case 2:return\"火\";case 3:return\"水\";case 4:return\"木\";case 5:return\"金\";case 6:return\"土\"}}var L=e=>`connect.sid=${e}`;function ot(e){return e!=null}function st(e){return ot(e)?(e.name===void 0||typeof e.name==\"string\")&&typeof e.message==\"string\":!1}function S(e){try{let t=typeof e==\"string\"?JSON.parse(e):e;return st(t)?t:!1}catch(t){if(t instanceof SyntaxError)return!1;throw t}}function M(e,t){let n=new Error;return n.name=e,n.message=t,n}var j=e=>e.replaceAll(\" \",\"_\").toLowerCase();var pe=e=>[...e].map((t,n)=>t===\" \"?\"_\":!it.includes(t)||n===e.length-1&&at.includes(t)?encodeURIComponent(t):t).join(\"\"),it='@$&+=:;\",',at=':;\",';async function Ee(e,t,n){let r=`https://scrapbox.io/api/pages/${e}/${pe(t)}?followRename=${n?.followRename??!0}`,o=await fetch(r,n?.sid?{headers:{Cookie:L(n.sid)}}:void 0);if(!o.ok){let i=S(await o.text());if(!i)throw M(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${r}\"`);return{ok:!1,value:i}}let s=await o.json();return{ok:!0,value:s}}async function me(e,t){let{sort:n,limit:r,skip:o}=t??{},s=new URLSearchParams;n!==void 0&&s.append(\"sort\",n),r!==void 0&&s.append(\"limit\",`${r}`),o!==void 0&&s.append(\"skip\",`${o}`);let i=`https://scrapbox.io/api/pages/${e}?${s.toString()}`,a=await fetch(i,t?.sid?{headers:{Cookie:L(t.sid)}}:void 0);if(!a.ok){let p=S(await a.text());if(!p)throw M(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${i}\"`);return{ok:!1,value:p}}let c=await a.json();return{ok:!0,value:c}}var ve=(e,t)=>{if(!(e instanceof HTMLDivElement))throw new TypeError(`\"${t}\" must be HTMLDivElememt but actual is \"${e}\"`)};var ke=()=>ct(document.getElementsByClassName(\"status-bar\")?.[0],\"div.status-bar\"),ct=(e,t)=>{if(!!e)return ve(e,t),e};function le(){let e=ke();if(!e)throw new Error(\"div.status-bar can't be found\");let t=document.createElement(\"div\");return e.append(t),{render:(...n)=>{t.textContent=\"\";let r=Ie(...n);r&&t.append(r)},dispose:()=>t.remove()}}function Ie(...e){let t=e.flatMap(r=>{switch(r.type){case\"spinner\":return[ft()];case\"check-circle\":return[gt()];case\"exclamation-triangle\":return[xt()];case\"text\":return[z(r.text)];case\"group\":{let o=Ie(...r.items);return o?[o]:[]}}});if(t.length===0)return;if(t.length===1)return t[0];let n=document.createElement(\"span\");return n.classList.add(\"item-group\"),n.append(...t),n}function z(e){let t=document.createElement(\"span\");return t.classList.add(\"item\"),t.append(e),t}function ft(){let e=document.createElement(\"i\");return e.classList.add(\"fa\",\"fa-spinner\"),z(e)}function gt(){let e=document.createElement(\"i\");return e.classList.add(\"kamon\",\"kamon-check-circle\"),z(e)}function xt(){let e=document.createElement(\"i\");return e.classList.add(\"fas\",\"fa-exclamation-triangle\"),z(e)}var ht=\"4.2.0\";async function N(){let t=(await yt())(\"https://scrapbox.io\",{reconnectionDelay:5e3,transports:[\"websocket\"]});return await new Promise((n,r)=>{let o=s=>r(s);t.once(\"connect\",()=>{t.off(\"disconnect\",o),n()}),t.once(\"disconnect\",o)}),t}function yt(){let e=`https://cdnjs.cloudflare.com/ajax/libs/socket.io/${ht}/socket.io.min.js`;if(document.querySelector(`script[src=\"${e}\"]`))return Promise.resolve(window.io);let t=document.createElement(\"script\");return t.src=e,new Promise((n,r)=>{t.onload=()=>n(window.io),t.onerror=o=>r(o),document.head.append(t)})}function P(e,t=9e4){function n(o,s){let i;return new Promise((a,c)=>{let p=d=>{clearTimeout(i),c(new Error(d))};e.emit(o,s,d=>{clearTimeout(i),e.off(\"disconnect\",p),d.error&&c(new Error(JSON.stringify(d.error))),\"data\"in d?a(d?.data):a(void 0)}),i=setTimeout(()=>{e.off(\"disconnect\",p),c(new Error(`Timeout: exceeded ${t}ms`))},t),e.once(\"disconnect\",p)})}async function*r(...o){let s,i=()=>new Promise(c=>s=c),a=c=>{s?.(c)};for(let c of o)e.on(c,a);try{for(;;)yield await i()}finally{for(let c of o)e.off(c,a)}}return{request:n,response:r}}async function Le(e,t){let n=`https://scrapbox.io/api/projects/${e}`,r=await fetch(n,t?.sid?{headers:{Cookie:L(t.sid)}}:void 0);if(!r.ok){let s=S(await r.json());if(!s)throw M(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${n}\"`);return{ok:!1,value:s}}let o=await r.json();return{ok:!0,value:o}}async function Me(e){let t=\"https://scrapbox.io/api/users/me\",n=await fetch(t,e?.sid?{headers:{Cookie:L(e.sid)}}:void 0);if(!n.ok)throw M(\"UnexpectedError\",`Unexpected error has occuerd when fetching \"${t}\"`);return await n.json()}var W;async function U(){if(W!==void 0)return W;let e=await Me();if(e.isGuest)throw new Error(\"this script can only be executed by Logged in users\");return W=e.id,W}var Ce=new Map;async function H(e){let t=Ce.get(e);if(t!==void 0)return t;let n=await Le(e);if(!n.ok){let{name:o,message:s}=n.value;throw new Error(`${o} ${s}`)}let{id:r}=n.value;return Ce.set(e,r),r}function Ne(e){return e.padStart(8,\"0\")}function Pe(e){let t=Math.floor(new Date().getTime()/1e3).toString(16),n=Math.floor(16777214*Math.random()).toString(16);return`${Ne(t).slice(-8)}${e.slice(-6)}0000${Ne(n)}`}function Oe(e,t){let n=e.length>t.length,r=n?t:e,o=n?e:t,s=r.length+1,i=r.length+o.length+3,a=new Array(i);a.fill(-1);let c=[];function p(m,E,D){let k=Math.max(E,D),B=k-m;for(;B<r.length&&k<o.length&&r[B]===o[k];)++B,++k;return a[m+s]=c.length,c.push([{x:B,y:k},a[m+(E>D?-1:1)+s]]),k}let d=new Array(i);d.fill(-1);let w=-1,h=o.length-r.length;do{++w;for(let m=-w;m<=h-1;++m)d[m+s]=p(m,d[m-1+s]+1,d[m+1+s]);for(let m=h+w;m>=h+1;--m)d[m+s]=p(m,d[m-1+s]+1,d[m+1+s]);d[h+s]=p(h,d[h-1+s]+1,d[h+1+s])}while(d[h+s]!==o.length);let q=[],v=a[h+s];for(;v!==-1;)q.push(c[v][0]),v=c[v][1];return{from:e,to:t,editDistance:h+w*2,buildSES:function*(){let m=0,E=0;for(let{x:D,y:k}of bt(q))for(;m<D||E<k;)k-D>E-m?(yield{value:o[E],type:n?\"deleted\":\"added\"},++E):k-D<E-m?(yield{value:r[m],type:n?\"added\":\"deleted\"},++m):(yield{value:r[m],type:\"common\"},++m,++E)}}}function*Ae(e){let t=[],n=[];function*r(){if(t.length>n.length){for(let o=0;o<n.length;o++)yield Se(t[o],n[o]);for(let o=n.length;o<t.length;o++)yield t[o]}else{for(let o=0;o<t.length;o++)yield Se(t[o],n[o]);for(let o=t.length;o<n.length;o++)yield n[o]}t=[],n=[]}for(let o of e)switch(o.type){case\"added\":t.push(o);break;case\"deleted\":n.push(o);break;case\"common\":yield*r(),yield o;break}yield*r()}function Se(e,t){return{value:e.value,oldValue:t.value,type:\"replaced\"}}function*bt(e){for(let t=e.length-1;t>=0;t--)yield e[t]}function*He(e,t,{userId:n}){let{buildSES:r}=Oe(e.map(({text:i})=>i),t),o=0,s=e[0].id;for(let i of Ae(r())){switch(i.type){case\"added\":yield{_insert:s,lines:{id:Pe(n),text:i.value}};continue;case\"deleted\":yield{_delete:s,lines:-1};break;case\"replaced\":yield{_update:s,lines:{text:i.value}};break}o++,s=e[o]?.id??\"_end\"}}var wt=e=>({type:\"title\",text:e.rows[0].text}),Et=e=>{let{rows:[t,...n]}=e,{indent:r=0,text:o=\"\"}=t??{},s=o.replace(/^\\s*code:/,\"\");return{indent:r,type:\"codeBlock\",fileName:s,content:n.map(i=>i.text.substring(r+1)).join(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d7347",
      "text": " `)}},x=(e,{parseOnNested:t,parseOnQuoted:n,patterns:r})=>(o,s,i)=>{var a,c,p,d,w,h;if(!t&&s.nested)return(a=i==null?void 0:i())!==null&&a!==void 0?a:[];if(!n&&s.quoted)return(c=i==null?void 0:i())!==null&&c!==void 0?c:[];for(let q of r){let v=q.exec(o);if(v===null)continue;let m=o.substring(0,v.index),E=o.substring(v.index+((d=(p=v[0])===null||p===void 0?void 0:p.length)!==null&&d!==void 0?d:0)),D=e((w=v[0])!==null&&w!==void 0?w:\"\",s);return[...O(m,s),...D,...O(E,s)]}return(h=i==null?void 0:i())!==null&&h!==void 0?h:[]},y=e=>[{type:\"plain\",raw:e,text:e}],vt=x(y,{parseOnNested:!0,parseOnQuoted:!0,patterns:[/^()(.*)()$/]}),kt=/^>.*$/,Tt=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"quote\",raw:e,nodes:O(e.substring(1),{...t,quoted:!0})}],Dt=x(Tt,{parseOnNested:!1,parseOnQuoted:!1,patterns:[kt]}),It=/^\\? .+$/,Lt=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"helpfeel\",raw:e,text:e.substring(2)}],Mt=x(Lt,{parseOnNested:!1,parseOnQuoted:!1,patterns:[It]}),Ct=/\\[\\[https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)\\]\\]/i,Nt=/\\[\\[https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}\\]\\]/,Pt=(e,t)=>{if(t.context===\"table\")return y(e,t);let n=e.substring(2,e.length-2),r=/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}$/.test(n);return[{type:\"strongImage\",raw:e,src:r?`${n}/thumb/1000`:n}]},Ot=x(Pt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Ct,Nt]}),At=/\\[[^[\\]]*\\.icon(?:\\*[1-9]\\d*)?\\]/;function $e(e){return(t,n)=>{if(e===\"strongIcon\"&&n.context===\"table\")return y(t,n);let r=e===\"icon\"?t.substring(1,t.length-1):t.substring(2,t.length-2),o=r.lastIndexOf(\".icon\"),s=r.substring(0,o),i=s.startsWith(\"/\")?\"root\":\"relative\",a=r.substring(o+5,r.length),c=a.startsWith(\"*\")?parseInt(a.substring(1),10):1;return new Array(c).fill({}).map(()=>({path:s,pathType:i,type:e,raw:t}))}}var St=$e(\"icon\"),Ht=x(St,{parseOnNested:!1,parseOnQuoted:!0,patterns:[At]}),$t=/\\[\\[[^[\\]]*\\.icon(?:\\*\\d+)?\\]\\]/,_t=$e(\"strongIcon\"),Rt=x(_t,{parseOnNested:!1,parseOnQuoted:!0,patterns:[$t]}),jt=/\\[\\[(?:[^[]|\\[[^[]).*?\\]*\\]\\]/,Ut=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"strong\",raw:e,nodes:O(e.substring(2,e.length-2),{...t,nested:!0})}],Ft=x(Ut,{parseOnNested:!1,parseOnQuoted:!0,patterns:[jt]}),qt=/\\[\\$ .+? \\]/,Bt=/\\[\\$ [^\\]]+\\]/,Yt=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"formula\",raw:e,formula:e.substring(3,e.length-(e.endsWith(\" ]\")?2:1))}],Kt=x(Yt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[qt,Bt]}),zt=/\\[[!\"#%&'()*+,\\-./{|}<>_~]+ (?:\\[[^[\\]]+\\]|[^\\]])+\\]/,Wt=(e,t)=>{if(t.context===\"table\")return y(e,t);let n=e.indexOf(\" \"),r=e.substring(1,n),o=e.substring(n+1,e.length-1),s=new Set(r);if(s.has(\"*\")){let i=r.split(\"*\").length-1;s.delete(\"*\"),s.add(`*-${Math.min(i,10)}`)}return[{type:\"decoration\",raw:e,rawDecos:r,decos:Array.from(s),nodes:O(o,{...t,nested:!0})}]},Qt=x(Wt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[zt]}),Gt=/`.*?`/,Xt=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"code\",raw:e,text:e.substring(1,e.length-1)}],Vt=x(Xt,{parseOnNested:!1,parseOnQuoted:!0,patterns:[Gt]}),Jt=/^[$%] .+$/,Zt=(e,t)=>{var n;if(t.context===\"table\")return y(e,t);let r=(n=e[0])!==null&&n!==void 0?n:\"\",o=e.substring(2);return[{type:\"commandLine\",raw:e,symbol:r,text:o}]},en=x(Zt,{parseOnNested:!1,parseOnQuoted:!1,patterns:[Jt]}),tn=/\\[\\s+\\]/,nn=(e,t)=>t.context===\"table\"?y(e,t):[{type:\"blank\",raw:e,text:e.substring(1,e.length-1)}],rn=x(nn,{parseOnNested:!1,parseOnQuoted:!0,patterns:[tn]}),on=/\\[https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)(?:\\?[^\\]\\s]+)?(?:\\s+https?:\\/\\/[^\\s\\]]+)?\\]/i,sn=/\\[https?:\\/\\/[^\\s\\]]+\\s+https?:\\/\\/[^\\s\\]]+\\.(?:png|jpe?g|gif|svg)(?:\\?[^\\]\\s]+)?\\]/i,an=/\\[https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}(?:\\/raw)?(?:\\s+https?:\\/\\/[^\\s\\]]+)?\\]/,cn=/\\[https?:\\/\\/[^\\s\\]]+\\s+https?:\\/\\/(?:[0-9a-z-]+\\.)?gyazo\\.com\\/[0-9a-f]{32}(?:\\/raw)?\\]/,un=e=>/^https?:\\/\\/[^\\s\\]]+\\.(png|jpe?g|gif|svg)(\\?[^\\]\\s]+)?$/i.test(e)||dn(e),dn=e=>/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}(\\/raw)?$/.test(e),pn=(e,t)=>{if(t.context===\"table\")return y(e,t);let n=e.search(/\\s/),r=n!==-1?e.substring(1,n):e.substring(1,e.length-1),o=n!==-1?e.substring(n,e.length-1).trimLeft():\"\",[s,i]=un(o)?[o,r]:[r,o];return[{type:\"image\",raw:e,src:/^https?:\\/\\/([0-9a-z-]\\.)?gyazo\\.com\\/[0-9a-f]{32}$/.test(s)?`${s}/thumb/1000`:s,link:i}]},mn=x(pn,{parseOnNested:!0,parseOnQuoted:!0,patterns:[on,sn,an,cn]}),ln=/\\[https?:\\/\\/[^\\s\\]]+\\s+[^\\]]*[^\\s]\\]/,fn=/\\[[^[\\]]*[^\\s]\\s+https?:\\/\\/[^\\s\\]]+\\]/,gn=/\\[https?:\\/\\/[^\\s\\]]+\\]/,xn=/https?:\\/\\/[^\\s]+/,hn=(e,t)=>{if(t.context===\"table\")return y(e,t);let n=e.startsWith(\"[\")&&e.endsWith(\"]\")?e.substring(1,e.length-1):e,r=/^https?:\\/\\/[^\\s\\]]/.test(n),o=(r?/^https?:\\/\\/[^\\s\\]]+/:/https?:\\/\\/[^\\s\\]]+$/).exec(n);if((o==null?void 0:o[0])===void 0)return[];let s=r?n.substring(o[0].length):n.substring(0,o.index-1);return[{type:\"link\",raw:e,pathType:\"absolute\",href:o[0],content:s.trim()}]},yn=x(hn,{parseOnNested:!0,parseOnQuoted:!0,patterns:[ln,fn,gn,xn]}),_e=/\\[([^\\]]*[^\\s])\\s+([NS]\\d+(?:\\.\\d+)?,[EW]\\d+(?:\\.\\d+)?(?:,Z\\d+)?)\\]/,Re=/\\[([NS]\\d+(?:\\.\\d+)?,[EW]\\d+(?:\\.\\d+)?(?:,Z\\d+)?)(?:\\s+([^\\]]*[^\\s]))?\\]/,bn=e=>{let[t=\"\",n=\"\",r=\"\"]=e.split(\",\"),o=parseFloat(t.replace(/^N/,\"\").replace(/^S/,\"-\")),s=parseFloat(n.replace(/^E/,\"\").replace(/^W/,\"-\")),i=/^Z\\d+$/.test(r)?parseInt(r.replace(/^Z/,\"\"),10):14;return{latitude:o,longitude:s,zoom:i}},wn=(e,t)=>{var n;if(t.context===\"table\")return y(e,t);let r=(n=e.match(_e))!==null&&n!==void 0?n:e.match(Re);if(r===null)return[];let o=e.startsWith(\"[N\")||e.startsWith(\"[S\"),[,s=\"\",i=\"\"]=o?r:[r[0],r[2],r[1]],{latitude:a,longitude:c,zoom:p}=bn(s),d=i!==\"\"?`https://www.google.com/maps/place/${encodeURIComponent(i)}/@${a},${c},${p}z`:`https://www.google.com/maps/@${a},${c},${p}z`;return[{type:\"googleMap\",raw:e,latitude:a,longitude:c,zoom:p,place:i,url:d}]},En=x(wn,{parseOnNested:!1,parseOnQuoted:!0,patterns:[_e,Re]}),vn=/\\[\\/?[^[\\]]+\\]/,kn=e=>{let t=e.substring(1,e.length-1);return[{type:\"link\",raw:e,pathType:t.startsWith(\"/\")?\"root\":\"relative\",href:t,content:\"\"}]},Tn=x(kn,{parseOnNested:!0,parseOnQuoted:!0,patterns:[vn]}),Dn=/(?:^|\\s)#\\S+/,In=(e,t)=>{if(t.context===\"table\")return y(e,t);if(e.startsWith(\"#\"))return[{type:\"hashTag\",raw:e,href:e.substring(1)}];let n=e.substring(0,1),r=e.substring(1);return[...y(n,t),{type:\"hashTag\",raw:r,href:r.substring(1)}]},Ln=x(In,{parseOnNested:!0,parseOnQuoted:!0,patterns:[Dn]}),Mn=(e,t,n)=>{var r;return e===\"\"?[]:(r=n==null?void 0:n())!==null&&r!==void 0?r:[]},Cn=(...e)=>(t,n)=>e.reduceRight((r,o)=>()=>o(t,n,r),()=>vt(t,n))(),O=Cn(Mn,Dt,Mt,Vt,en,Kt,rn,Qt,Ot,Rt,Ft,mn,yn,Ht,En,Tn,Ln),Nn=e=>{let{rows:[t,...n]}=e,{indent:r=0,text:o=\"\"}=t??{},s=o.replace(/^\\s*table:/,\"\");return{indent:r,type:\"table\",fileName:s,cells:n.map(i=>i.text.substring(r+1)).map(i=>i.split(\"\t\").map(a=>O(a,{nested:!1,quoted:!1,context:\"table\"})))}},Pn=e=>{let{indent:t,text:n}=e.rows[0];return{indent:t,type:\"line\",nodes:O(n.substring(t),{nested:!1,quoted:!1,context:\"line\"})}},je=e=>{switch(e.type){case\"title\":return wt(e);case\"codeBlock\":return Et(e);case\"table\":return Nn(e);case\"line\":return Pn(e)}},Ue=e=>e.split(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d7348",
      "text": " `).map(t=>{var n,r,o;return{indent:(o=(r=(n=/^\\s+/.exec(t))===null||n===void 0?void 0:n[0])===null||r===void 0?void 0:r.length)!==null&&o!==void 0?o:0,text:t}}),On=(e,t)=>{var n,r;return(e.type===\"codeBlock\"||e.type===\"table\")&&t.indent>((r=(n=e.rows[0])===null||n===void 0?void 0:n.indent)!==null&&r!==void 0?r:0)},Fe=(e,t)=>{let n=e[e.length-1];return n!==void 0&&On(n,t)?(n.rows.push(t),e):(e.push({type:/^\\s*code:/.test(t.text)?\"codeBlock\":/^\\s*table:/.test(t.text)?\"table\":\"line\",rows:[t]}),e)},qe=(e,t)=>{var n;if((n=t.hasTitle)!==null&&n!==void 0?n:!0){let[r,...o]=e;return r===void 0?[]:[{type:\"title\",rows:[r]},...o.reduce(Fe,[])]}return e.reduce(Fe,[])};function fe(e,t,{userId:n,head:r}){let o=t.flatMap(d=>d.split(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d7349",
      "text": " `)),s=[...He(e,o,{userId:n})];(e[0].text!==o[0]||!r.persistent)&&s.push({title:o[0]});let i=e.slice(1,6).map(d=>d.text),a=o.slice(1,6);i.join(\"\")!==a.join(\"\")&&s.push({descriptions:a});let[c,p]=An(o.join(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d734a",
      "text": " `));return(r.linksLc.length!==c.length||!r.linksLc.every(d=>c.includes(d)))&&s.push({links:c}),r.image!==p&&s.push({image:p}),s}function An(e){let t=Ue(e),n=qe(t,{hasTitle:!0}).flatMap(i=>{switch(i.type){case\"codeBlock\":case\"title\":return[];case\"line\":case\"table\":return[je(i)]}}),r=[],o=null,s=i=>{switch(i.type){case\"hashTag\":r.push(j(i.href));return;case\"link\":{if(i.pathType!==\"relative\")return;r.push(j(i.href));return}case\"image\":case\"strongImage\":{o??=i.src.endsWith(\"/thumb/1000\")?i.src.replace(/\\/thumb\\/1000$/,\"/raw\"):i.src;return}case\"strong\":case\"quote\":case\"decoration\":{for(let a of i.nodes)s(a);return}default:return}};for(let i of Sn(n))s(i);return[r,o]}function*Sn(e){for(let t of e)switch(t.type){case\"codeBlock\":case\"title\":continue;case\"line\":for(let n of t.nodes)yield n;continue;case\"table\":{for(let n of t.cells)for(let r of n)for(let o of r)yield o;continue}}}async function C(e,t){let n=await Ee(e,t);if(!n.ok)throw new Error(`You have no privilege of editing \"/${e}/${t}\".`);let{commitId:r,persistent:o,image:s,links:i,lines:a,id:c,pin:p}=n.value;return{commitId:r,pageId:c,persistent:o,image:s,linksLc:i.map(d=>j(d)),pin:p,lines:a}}async function F(e,t,n){return t.length===0?{commitId:n.parentId}:await e(\"socket.io-request\",{method:\"commit\",data:{kind:\"page\",...n,changes:t,cursor:null,freeze:!0}})}async function Q(e,t,{project:n,title:r,retry:o=3,parentId:s,...i}){try{s=(await F(e,t,{parentId:s,...i})).commitId}catch{console.log(\"Faild to push a commit. Retry after pulling new commits\");for(let c=0;c<o;c++){let{commitId:p}=await C(n,r);s=p;try{s=(await F(e,t,{parentId:s,...i})).commitId,console.log(\"Success in retrying\");break}catch{continue}}throw Error(\"Faild to retry pushing.\")}return s}var Be=()=>Number.MAX_SAFE_INTEGER-Math.floor(Date.now()/1e3);async function ge(e,t,n){let[r,o,s]=await Promise.all([C(e,t),H(e),U()]),i=r,a=await N();try{let{request:c}=P(a);for(let p=0;p<3;p++)try{let d=n(i.lines),w=d instanceof Promise?await d:d,h=fe(i.lines,w,{userId:s,head:i});await F(c,h,{parentId:i.commitId,projectId:o,pageId:i.pageId,userId:s});break}catch{if(p===2)throw Error(\"Faild to retry pushing.\");console.log(\"Faild to push a commit. Retry after pulling new commits\");try{i=await C(e,t)}catch(w){throw w}}}finally{a.disconnect()}}async function xe(e,t,n){let[r,o,s]=await Promise.all([C(e,t),H(e),U()]);if(r.pin>0||!r.persistent&&!(n?.create??!1))return;let i={parentId:r.commitId,projectId:o,pageId:r.pageId,userId:s,project:e,title:t},a=await N(),{request:c}=P(a);if(!r.persistent){let p=await Q(c,[{title:t}],i);i.parentId=p}try{await Q(c,[{pin:Be()}],i)}finally{a.disconnect()}}async function he(e,t){let[n,r,o]=await Promise.all([C(e,t),H(e),U()]);if(n.pin==0||!n.persistent)return;let s={parentId:n.commitId,projectId:r,pageId:n.pageId,userId:o,project:e,title:t},i=await N(),{request:a}=P(i);try{await Q(a,[{pin:0}],s)}finally{i.disconnect()}}var ye=e=>new Promise(t=>setTimeout(()=>t(),e));async function*Ye(e){for await(let t of Ke(e))!/\\d{4}\\/\\d{2}\\/\\d{2}/.test(t.title)||(yield t)}async function*Ke(e,t=0){let{count:n,pages:r}=await Hn(e,t);for(let o of r)o.pin!==0&&(yield o);(r.at(-1)?.pin??0)!==0&&(yield*Ke(e,t+1e3))}async function Hn(e,t){let n=await me(e,{limit:1e3,skip:t});if(!n.ok){let r=new Error;throw r.name=n.value.name,r.message=n.value.message,r}return n.value}function Ma(e,t=24*3600*1e3){let n=()=>scrapbox.Project.name===e?$n(e,t):We();n(),scrapbox.addListener(\"project:changed\",n)}var ze;async function $n(e,t){We(),await Qe(e,new Date),ze=setInterval(()=>Qe(e,new Date),t)}function We(){clearInterval(ze)}async function Qe(e,t){let{render:n,dispose:r}=le();try{n({type:\"spinner\"},{type:\"text\",text:\"unpin other diary pages...\"});for await(let{title:p}of Ye(e))p!==_n(t)&&await he(e,p);let[o,s,i]=de(t);n({type:\"spinner\"},{type:\"text\",text:`pin \"/${e}/${o}\"...`}),await xe(e,o,{create:!0});let a=s.split(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d734b",
      "text": " `),c=i.split(`",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d734c",
      "text": " `);n({type:\"spinner\"},{type:\"text\",text:`format \"/${e}/${o}\"...`}),await ge(e,o,p=>[p[0].text,...be(p.slice(1).map(d=>d.text),a,c)]),n({type:\"check-circle\"},{type:\"text\",text:`Pinned \"/${e}/${o}\".`})}catch(o){n({type:\"exclamation-triangle\"},{type:\"text\",text:o instanceof Error?`${o.name} ${o.message}`:\"Unknown error! (see developper console)\"}),console.error(o)}finally{await ye(1e3),r()}}function _n(e){return`${e.getFullYear()}/${Ge(e.getMonth()+1)}/${Ge(e.getDate())}`}function Ge(e){return String(e).padStart(2,\"0\")}export{Ma as launch,Qe as pinDiary};",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654099
    },
    {
      "id": "62076e031280f000005d734d",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644654085,
      "updated": 1644654085
    },
    {
      "id": "620641351280f000007744f0",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1644577077,
      "updated": 1644577077
    }
  ]
}