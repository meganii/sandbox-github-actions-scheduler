{
  "id": "66333c7479cd8b002443800c",
  "title": "Viteのpublicフォルダに.gzファイルを置いて配信するとダウンロードしたデータがおかしくなる",
  "created": 1714633845,
  "updated": 1714672045,
  "lines": [
    {
      "id": "66333c7479cd8b002443800c",
      "text": "Viteのpublicフォルダに.gzファイルを置いて配信するとダウンロードしたデータがおかしくなる",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633870
    },
    {
      "id": "66333c757838e30000fc38ac",
      "text": "[Mijinko_SD.icon] from [2024/05/02]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633855
    },
    {
      "id": "66333c757838e30000fc38ad",
      "text": " [Vite]の[publicディレクトリ]に[.gz]ファイルを置いて配信するとダウンロードしたデータがおかしくなる不具合に見舞われている",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633895
    },
    {
      "id": "66333c757838e30000fc38ae",
      "text": " \t[https://gyazo.com/378236e423af09116c87e7220543f407]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38af",
      "text": " \t← 元のファイル（306B）",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b0",
      "text": " \tダウンロードしたファイル（65536B）→",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b1",
      "text": " \t 2^16Bってことは、プログラムが暴走して無限に0埋めしたとかそんなかんじか[takker.icon]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b2",
      "text": " \tどうやって解決しようか",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b3",
      "text": " \tダウンロードしたファイルについてちょっとわかったこと",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b4",
      "text": " \t\t何故か解凍された状態で送信されてる……",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b5",
      "text": " \t\tダウンロードしたファイルと元のファイルを解凍した後のチェックサムが同じ",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b6",
      "text": " \t\tおかしいやろがい",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b7",
      "text": " \t複数ファイルを圧縮して送信したらどうなるのか確認してみた",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b8",
      "text": " \t\t`fugu.tgz`と`fugu.gz`で検証（拡張子を変えただけでデータは同じ）",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38b9",
      "text": " \t\t[https://gyazo.com/02006f320f3b205f6e01da3c01c59ec2]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38ba",
      "text": " \t\t両方とも中身は開ける",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333c757838e30000fc38bb",
      "text": " \t\tでも何故かファイルサイズが`.gz`の時だけ大きい",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714633851
    },
    {
      "id": "66333d137838e30000fc38bd",
      "text": " \t\t[.tgz]：90,811B（オリジナルと同じ）",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714634004,
      "updated": 1714634031
    },
    {
      "id": "66333d667838e30000fc38bf",
      "text": " \t\t\t[チェックサム]も一致",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714634087,
      "updated": 1714634093
    },
    {
      "id": "66333d2f7838e30000fc38be",
      "text": " \t\t[.gz]：97,280B（オリジナルより大きい）",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714634031,
      "updated": 1714634045
    },
    {
      "id": "663342027838e30000e9eda8",
      "text": " \t[- [セキュリティソフト]切っても変わらなかったので、それが原因では無さそう]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714635266,
      "updated": 1714671780
    },
    {
      "id": "663342117838e30000e9eda9",
      "text": " \t[Firefox]でも同じ現象が発生したのでブラウザが原因の線も薄い",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714635282,
      "updated": 1714635328
    },
    {
      "id": "66333c757838e30000fc38bc",
      "text": "\tとりあえず拡張子の[.gz]を[.tgz]に変更すれば回避できることがわかったけれど、どうせだし原因分析もしたいので、もう少し調査する",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714633845,
      "updated": 1714636894
    },
    {
      "id": "6633d0ab7838e300006037bc",
      "text": "\t[HTTPヘッダー]を調べてみたら、レスポンスに[X-Content-Encoding-Over-Network]がついてた",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671787,
      "updated": 1714671818
    },
    {
      "id": "6633d0ce7838e300006037bd",
      "text": "\t\t`X-Content-Encoding-Over-Network: gzip`",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671823,
      "updated": 1714671826
    },
    {
      "id": "6633d0d27838e300006037be",
      "text": "\t\t調べたら[ESET]が原因っぽい",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671827,
      "updated": 1714671883
    },
    {
      "id": "6633d10b7838e300006037bf",
      "text": "\t\t\t[https://sunday-morning.app/posts/2020-08-22-nginx-gzip nginxでgzip圧縮設定をしたのに反映されない現象が発生]",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671883,
      "updated": 1714671884
    },
    {
      "id": "6633d17d7838e300006037c2",
      "text": "\t\t\t勝手に解凍した上で再配信してくるらしい",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671998,
      "updated": 1714672045
    },
    {
      "id": "6633d10c7838e300006037c0",
      "text": "\t\tでも、キャッシュを切った上でセキュリティを切っても変わらなかったんだよな",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671885,
      "updated": 1714671907
    },
    {
      "id": "6633d1227838e300006037c1",
      "text": "\t\t\tなんでだろう",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714671907,
      "updated": 1714671910
    },
    {
      "id": "663348287838e30000e9edaa",
      "text": "",
      "userId": "60fb0a79f3364000237838e3",
      "created": 1714636841,
      "updated": 1714636841
    }
  ]
}