{
  "id": "661b6723b4608f00259d56e0",
  "title": "プロジェクトホームを開くとエラーが出る2024/4/14→ページ遷移で#text-inputが消えるせい",
  "created": 1713071979,
  "updated": 1713343115,
  "lines": [
    {
      "id": "661b6723b4608f00259d56e0",
      "text": "プロジェクトホームを開くとエラーが出る2024/4/14→ページ遷移で#text-inputが消えるせい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713071979,
      "updated": 1713337808
    },
    {
      "id": "661b67c25f1e0d0000130ab2",
      "text": "[プロジェクトホーム]を開くと動かないものがある",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072067,
      "updated": 1713072641
    },
    {
      "id": "661b67695f1e0d00003b1a57",
      "text": "\tエラーは出ないがバグる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713071979,
      "updated": 1713072072
    },
    {
      "id": "661b6b145f1e0d000012da8d",
      "text": "\tリロードすると治る",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072918,
      "updated": 1713072923
    },
    {
      "id": "661b6a325f1e0d000012da74",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072691,
      "updated": 1713072691
    },
    {
      "id": "661b6a325f1e0d000012da75",
      "text": "[2024/04/09#6615054cc9ec6a0000087aa3]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072691,
      "updated": 1713072691
    },
    {
      "id": "661b6a335f1e0d000012da76",
      "text": "\t> [/foldrr/scrapbox-editor-indent-line]を使わせて頂いているが、ここ1週間くらいうまく動かなくなっている[cak.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072692,
      "updated": 1713072707
    },
    {
      "id": "661b6a3c5f1e0d000012da77",
      "text": " >   動かないときはリロードするとなおる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072701,
      "updated": 1713072701
    },
    {
      "id": "661b67e25f1e0d0000130ab9",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072099,
      "updated": 1713072099
    },
    {
      "id": "661b6aa35f1e0d000012da78",
      "text": "[2024/04/11#6617b28f5f1e0d00001e2c1c]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072804,
      "updated": 1713072804
    },
    {
      "id": "661b6aa35f1e0d000012da79",
      "text": " >\t[https://gyazo.com/1168cefc7b7255c4d971910ca210b64c]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072804,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da7b",
      "text": " > \t\tﾍﾝなエラーが出てる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713073237
    },
    {
      "id": "661b6ab75f1e0d000012da7c",
      "text": " > \t\tあと改行が2行になってる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da7d",
      "text": " >   なんのUserScriptのしわざだ",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da7e",
      "text": " >    エラーは[選択範囲に似ているリンクを入力補完するUserScript]ぽいな",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da7f",
      "text": " >    　認知しているけど、問題なく使えているため修正するモチベがいまのところない[takker.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da80",
      "text": " >    あとscrapbubble",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da81",
      "text": " >     リロードで直るので直すモチベがない[takker.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da82",
      "text": " >     ただ原因がわからないのが気になる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da83",
      "text": " >      上のスクショによると、`#editor`がないタイミングがあるのが原因だろうか",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da84",
      "text": " >      しかし[takker.icon]のコンソールには、`#editor`のエラーが発生しない",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da85",
      "text": " >      　にも関わらず動かなくなる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da86",
      "text": " >   keep-indentのせいぽいな",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da87",
      "text": " >    わからないけど治った...",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da88",
      "text": " >    なおってない...",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da89",
      "text": " >    `keep-indent`初耳[takker.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da8a",
      "text": " >    　どこの部品の名前だろう",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6ab75f1e0d000012da8b",
      "text": " >    　スクボのHTMLからは見つからなかった",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072824,
      "updated": 1713072824
    },
    {
      "id": "661b6acc5f1e0d000012da8c",
      "text": "  ああ、これは上の[/foldrr/foldrr.icon]さんのUserScriptです[wogikaze.icon](気づかなかった)",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072845,
      "updated": 1713072890
    },
    {
      "id": "661b6aa35f1e0d000012da7a",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072804,
      "updated": 1713072804
    },
    {
      "id": "661b67e25f1e0d0000130aba",
      "text": "検証中[wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072099,
      "updated": 1713072103
    },
    {
      "id": "661b67e65f1e0d0000130abb",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072103,
      "updated": 1713072103
    },
    {
      "id": "661b67f75f1e0d0000130abe",
      "text": "エラーは出ないが動かなくなる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072120,
      "updated": 1713072659
    },
    {
      "id": "661b67e85f1e0d0000130abc",
      "text": " [scrapbubble]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072105,
      "updated": 1713072120
    },
    {
      "id": "661b78ab1280f00000b894a3",
      "text": " これ一番謎[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713076397,
      "updated": 1713076404
    },
    {
      "id": "661b67995f1e0d0000130aac",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072026,
      "updated": 1713072026
    },
    {
      "id": "661b69a65f1e0d000012da6d",
      "text": "エラーがでて動かなくなる",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072551,
      "updated": 1713072662
    },
    {
      "id": "661b69a85f1e0d000012da6f",
      "text": " [選択範囲に似ているリンクを入力補完するUserScript]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072554,
      "updated": 1713072574
    },
    {
      "id": "661b69a75f1e0d000012da6e",
      "text": "  [https://gyazo.com/987c0a2bdbf98adcf03cbd595bcfe761]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072552,
      "updated": 1713072583
    },
    {
      "id": "661f68c91280f00000a19b8d",
      "text": "  [#text-input]が存在しないエラー",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334474,
      "updated": 1713334483
    },
    {
      "id": "661f68d21280f00000a19b8f",
      "text": "  予想",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334483,
      "updated": 1713334485
    },
    {
      "id": "661f68d41280f00000a19b90",
      "text": "  　scrapboxのレンダリング方式が変わって、`#text-input`が存在しないケースが発生した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334485,
      "updated": 1713334525
    },
    {
      "id": "661f68cc1280f00000a19b8e",
      "text": "  2024-04-17 15:15:30 検証中",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334477,
      "updated": 1713334531
    },
    {
      "id": "661f69031280f00000a19b91",
      "text": "   `#text-input`のtype guard周りにブレークポイントを置いた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334532,
      "updated": 1713334548
    },
    {
      "id": "661f69131280f00000a19b92",
      "text": "   とりあえずこれでデバッガーが立ち上がるまで待つ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334548,
      "updated": 1713334567
    },
    {
      "id": "661f691d1280f00000a19b93",
      "text": "    まだ発生条件を絞り込めていないので、そこから調べるしかない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334558,
      "updated": 1713334580
    },
    {
      "id": "661f696f1280f00000a19b94",
      "text": "   15:17:20 こういうときに限ってエラーが出ないんだよな～～",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334640,
      "updated": 1713334651
    },
    {
      "id": "661f697a1280f00000a19b95",
      "text": "   　でてくれ～",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334651,
      "updated": 1713334653
    },
    {
      "id": "661b69c65f1e0d000012da71",
      "text": "\tindex.js",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072583,
      "updated": 1713072606
    },
    {
      "id": "661b69dc5f1e0d000012da72",
      "text": "\t [https://gyazo.com/c095944db0b6c5e2b90cf74e9fc8ce92]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713072606,
      "updated": 1713072608
    },
    {
      "id": "661b69df5f1e0d000012da73",
      "text": "  これは遭遇したことないかも[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713072608,
      "updated": 1713334346
    },
    {
      "id": "661b6c2a5f1e0d0000495b4c",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713073199,
      "updated": 1713073199
    },
    {
      "id": "661f6a5e1280f00000a19b96",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334880,
      "updated": 1713334880
    },
    {
      "id": "661f6a5e1280f00000a19b97",
      "text": "2024-04-17 15:21:21 エラーの原因わかった！！！！！！！！！！！！！！！[takker.icon*5]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334880,
      "updated": 1713334888
    },
    {
      "id": "661f6b2f1280f00000a19ba4",
      "text": " わかったこと",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335088,
      "updated": 1713335090
    },
    {
      "id": "661f6ae21280f00000a19b9d",
      "text": "  ページ編集画面以外で[#editor]と[#text-input]が消えるようになった",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335011,
      "updated": 1713335091
    },
    {
      "id": "661f6b051280f00000a19ba0",
      "text": "   以前は`display: none;`されるだけだった",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335045,
      "updated": 1713335091
    },
    {
      "id": "661f6a671280f00000a19b98",
      "text": "   [Scrapboxのトップページ] (おそらくstreamでもそうなる)に移動すると[#editor]が入っている`div.container`がDOMごと消える",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334888,
      "updated": 1713335091
    },
    {
      "id": "661f6ac91280f00000a19b9b",
      "text": "   `#text-input`は`#editor`の中にあるので、これらも巻き添えになって消える",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713334986,
      "updated": 1713335091
    },
    {
      "id": "661f6bc01280f00000a19bad",
      "text": "  つまり、バグ発生のタイミングは「編集画面以外にアクセスする」こと",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335234,
      "updated": 1713335255
    },
    {
      "id": "661f6b3e1280f00000a19ba8",
      "text": " バグ発生の仕組み",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335104,
      "updated": 1713335111
    },
    {
      "id": "661f6b351280f00000a19ba6",
      "text": " 　[選択範囲に似ているリンクを入力補完するUserScript]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335094,
      "updated": 1713335112
    },
    {
      "id": "661f6b341280f00000a19ba5",
      "text": "   このコードは常に`#text-input`が存在する前提でコードを組んでいる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335093,
      "updated": 1713335163
    },
    {
      "id": "661f6b131280f00000a19ba1",
      "text": "   そのため、存在しない場合はエラーを吐いてしまう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335060,
      "updated": 1713335167
    },
    {
      "id": "661f6b7f1280f00000a19ba9",
      "text": "   ただし、偶然にもエラーを吐いてもコードが止まらないような設計になっていたらしく、エラーを吐く以外の実害はなかった",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335168,
      "updated": 1713335609
    },
    {
      "id": "661f6b821280f00000a19baa",
      "text": "  [カーソルが行頭になくてもTabでインデントするUserScript]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335172,
      "updated": 1713335180
    },
    {
      "id": "661f6b8b1280f00000a19bab",
      "text": "   上に同じ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335180,
      "updated": 1713335622
    },
    {
      "id": "661f6d411280f00000deacac",
      "text": "   `#text-input`に[addEventListener]でlistenerを登録していたため、一度消えて作り直されるとlistenerがリセットされる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335622,
      "updated": 1713335657
    },
    {
      "id": "661f6d681280f00000deacad",
      "text": "   　これを考慮していないコードはかなり有りそう[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335657,
      "updated": 1713335664
    },
    {
      "id": "661f6d6f1280f00000deacae",
      "text": "   　`document.getElementById(\"text-input\").addEventListener`系は全部修正が必要だと思っていい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335664,
      "updated": 1713335753
    },
    {
      "id": "661f753d1280f000003a88bc",
      "text": "   2024-04-17 16:08:01 修正済み",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713337663,
      "updated": 1713337684
    },
    {
      "id": "661f6b251280f00000a19ba3",
      "text": "  [ScrapBubble]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335078,
      "updated": 1713335265
    },
    {
      "id": "661f6be01280f00000a19bae",
      "text": "   `#editor`内に`div`を作り、その中でPreactを動かす仕組みになっている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335265,
      "updated": 1713335293
    },
    {
      "id": "661f6bfc1280f00000a19baf",
      "text": "   そのため、`#editor`の巻き添えを食らってUIが消えてしまっていた",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335293,
      "updated": 1713335344
    },
    {
      "id": "661f6c2f1280f00000a19bb0",
      "text": "    エラーでrenderingが止まったわけではなかったので、原因に気づきにくかった[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335344,
      "updated": 1713335367
    },
    {
      "id": "661f6c461280f00000a19bb1",
      "text": "   cf. [選択範囲に似ているリンクを入力補完するUserScript]などは`body`直下に`div`をはやしているので、scrapboxのReactによるDOM削除の影響を受けない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335367,
      "updated": 1713335399
    },
    {
      "id": "661f6c681280f00000a19bb3",
      "text": "対策",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335402,
      "updated": 1713335407
    },
    {
      "id": "661f6c6e1280f00000a19bb4",
      "text": "　`#text-input`が存在しない可能性を考慮してコードを書く",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335407,
      "updated": 1713335422
    },
    {
      "id": "661f6dd01280f00000deacaf",
      "text": "　 event listenerを登録したいときは、ページ遷移するたびに登録し直す",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335761,
      "updated": 1713335775
    },
    {
      "id": "661f6c7e1280f00000a19bb5",
      "text": "　`#editor`になにかDOMを生やすときは、ページ遷移するたびに生やし直す",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713335423,
      "updated": 1713335449
    },
    {
      "id": "661f75551280f00000e731ef",
      "text": "[scrapbox-userscript-std]に、ページ遷移しても`#text-input`へlistenerを再登録してくれる関数を導入する予定です",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713337686,
      "updated": 1713337769
    },
    {
      "id": "661f75a81280f00000e731f0",
      "text": " 今日(2024-04-17)はもう時間がないので、明日やります",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713337769,
      "updated": 1713337781
    },
    {
      "id": "661f75b41280f00000e731f1",
      "text": " しばしお待ちを",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713337781,
      "updated": 1713337784
    },
    {
      "id": "661f79a31280f00000ae548a",
      "text": " [ちゃんと動かないと自分が大変困るので必死で開発する]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713338789,
      "updated": 1713338804
    },
    {
      "id": "661f79a91280f00000ae548b",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1713338795,
      "updated": 1713338795
    },
    {
      "id": "661f89e75f1e0d00002614cc",
      "text": "[大偉業.icon]andありがとう[イドバタニシの茶2.icon][wogikaze.icon]",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713342953,
      "updated": 1713343115
    },
    {
      "id": "661f89e95f1e0d00002614cd",
      "text": "",
      "userId": "616ca537c25a92001e5f1e0d",
      "created": 1713342955,
      "updated": 1713342955
    }
  ]
}