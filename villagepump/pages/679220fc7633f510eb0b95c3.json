{
  "id": "679220fc7633f510eb0b95c3",
  "title": "scrapbox-userscript-std/browser/websocket",
  "created": 1737630045,
  "updated": 1737680598,
  "lines": [
    {
      "id": "679220fc7633f510eb0b95c3",
      "text": "scrapbox-userscript-std/browser/websocket",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630045,
      "updated": 1737630045
    },
    {
      "id": "67924710aff09e0000c057c5",
      "text": "使い方を整理した[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639696,
      "updated": 1737639821
    },
    {
      "id": "6792478daff09e0000c057c7",
      "text": "\thttps://github.com/nishio/write_cosense/blob/main/README.md",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639821,
      "updated": 1737639821
    },
    {
      "id": "679248561280f00000368b59",
      "text": "\tしごとがはやい[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737640022,
      "updated": 1737640025
    },
    {
      "id": "67924710aff09e0000c057c6",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639696,
      "updated": 1737639696
    },
    {
      "id": "67924192aff09e000000b80786",
      "text": " ワタシCosenseチョットデキル",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638291,
      "updated": 1737638291
    },
    {
      "id": "679241a21280f0000048037c",
      "text": " 　挿入位置計算間違えてた()[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638306,
      "updated": 1737638323
    },
    {
      "id": "679241b41280f0000048037d",
      "text": " 　直そう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638324,
      "updated": 1737638328
    },
    {
      "id": "679241e11280f0000048037e",
      "text": " 　直した",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638369,
      "updated": 1737638372
    },
    {
      "id": "6792215caff09e0000f4ae2e",
      "text": "TEST HERE",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630045,
      "updated": 1737638092
    },
    {
      "id": "6792432eaff09e000000054679",
      "text": " ワタシCosenseチョットデキル:2025-01-23T13:25:00.610Z",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638702,
      "updated": 1737638702
    },
    {
      "id": "67924269aff09e00000093a6ed",
      "text": " ワタシCosenseチョットデキル1737638503707",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638505,
      "updated": 1737638505
    },
    {
      "id": "67924211aff09e0000001f40bc",
      "text": " ワタシCosenseチョットデキル",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638417,
      "updated": 1737638417
    },
    {
      "id": "6792215daff09e0000f4ae2f",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630046,
      "updated": 1737630046
    },
    {
      "id": "67924153aff09e0000c057a4",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638227,
      "updated": 1737638227
    },
    {
      "id": "67924154aff09e0000c057a7",
      "text": "code:sample.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638228,
      "updated": 1737638237
    },
    {
      "id": "67924154aff09e0000c057a8",
      "text": "\timport { insertLines } from \"./insertLines.ts\";",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638228,
      "updated": 1737638249
    },
    {
      "id": "67924166aff09e0000c057aa",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638247,
      "updated": 1737638286
    },
    {
      "id": "6792418e1280f0000048037b",
      "text": " await insertLines(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638286,
      "updated": 1737638286
    },
    {
      "id": "67924166aff09e0000c057ac",
      "text": "   \"villagepump\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638247,
      "updated": 1737638287
    },
    {
      "id": "67924166aff09e0000c057ad",
      "text": "   \"scrapbox-userscript-std/browser/websocket\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638247,
      "updated": 1737638288
    },
    {
      "id": "67924166aff09e0000c057ae",
      "text": "   \"TEST HERE\",",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638247,
      "updated": 1737638268
    },
    {
      "id": "67924166aff09e0000c057b4",
      "text": "   \" ワタシCosenseチョットデキル:\" + new Date().toISOString(),",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638247,
      "updated": 1737638693
    },
    {
      "id": "67924166aff09e0000c057b5",
      "text": "   { sid: Deno.env.get(\"CONNECT_SID\")! },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638247,
      "updated": 1737638257
    },
    {
      "id": "67924166aff09e0000c057b6",
      "text": " );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638247,
      "updated": 1737638257
    },
    {
      "id": "67924154aff09e0000c057a9",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638228,
      "updated": 1737638228
    },
    {
      "id": "679241f0aff09e0000c057ba",
      "text": "[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638385,
      "updated": 1737638385
    },
    {
      "id": "67924153aff09e0000c057a5",
      "text": "若干カオスになってるけどw とりあえず",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638227,
      "updated": 1737638368
    },
    {
      "id": "679241f5aff09e0000c057bd",
      "text": "\t% export CONNECT_SID=\"<your sid>\"",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638389,
      "updated": 1737638402
    },
    {
      "id": "679241e0aff09e0000c057b8",
      "text": "\t% deno run -A -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/sample.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638368,
      "updated": 1737638524
    },
    {
      "id": "679241e2aff09e0000c057b9",
      "text": "\tでscrapboxに書き込まれることまでは確認された",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638370,
      "updated": 1737638382
    },
    {
      "id": "67924295aff09e0000c057bf",
      "text": " \tこれはダメ[nishio.icon] `% deno run -A -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std/browser/websocket/sample.ts`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638550,
      "updated": 1737652827
    },
    {
      "id": "679242a71280f0000048037f",
      "text": " \t　`scrapbox-userscript-std/browser/websocket`がページ名ではなく、3つの階層として認識されてしまうため[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638567,
      "updated": 1737638596
    },
    {
      "id": "679242c41280f00000480380",
      "text": " \t　`/`を階層の区切りとして認識されないよう、`%2F`に変えておく必要がある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638596,
      "updated": 1737638612
    },
    {
      "id": "67924153aff09e0000c057a6",
      "text": "[/emoji/tada.icon][takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638227,
      "updated": 1737638405
    },
    {
      "id": "679241f3aff09e0000c057bb",
      "text": "正しい位置に表示された！[/emoji/tada.icon][/emoji/tada.icon][nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638387,
      "updated": 1737638435
    },
    {
      "id": "679241f3aff09e0000c057bc",
      "text": "\tやったー、Botが日記に書き込んだぞ！",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638387,
      "updated": 1737639388
    },
    {
      "id": "679245dbaff09e0000c057c4",
      "text": "\t\t[/nishio/日記2025-01-23#679245be6a7a3f00000087dd86]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639388,
      "updated": 1737639388
    },
    {
      "id": "679245cfaff09e0000c057c0",
      "text": "　わーいわーい[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639376,
      "updated": 1737640035
    },
    {
      "id": "679245cfaff09e0000c057c1",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639376,
      "updated": 1737639376
    },
    {
      "id": "679245cfaff09e0000c057c2",
      "text": "helper関数として、`insertLines`や`updateLine`あたりを作っておくと便利そうかな[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639376,
      "updated": 1737640536
    },
    {
      "id": "679245cfaff09e0000c057c3",
      "text": "箇条書きで",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737639376,
      "updated": 1737680528
    },
    {
      "id": "6792e690aff09e0000c057cd",
      "text": "\tA",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680528,
      "updated": 1737680529
    },
    {
      "id": "6792e691aff09e0000c057ce",
      "text": "\t\tB",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680529,
      "updated": 1737680530
    },
    {
      "id": "6792e692aff09e0000c057cf",
      "text": "\t\tC",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680530,
      "updated": 1737680534
    },
    {
      "id": "6792e696aff09e0000c057d0",
      "text": "のA,BがあるときにAを指示してCの位置に追加するものがあるとCosense的には自然な気がした[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680534,
      "updated": 1737680567
    },
    {
      "id": "6792e6b6aff09e0000c057d5",
      "text": "\t「Aの下に追加」だとA,Cがある状態でBに書いちゃうので",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680567,
      "updated": 1737680598
    },
    {
      "id": "6792e6aaaff09e0000c057d1",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680555,
      "updated": 1737680555
    },
    {
      "id": "6792e6aaaff09e0000c057d2",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680555,
      "updated": 1737680555
    },
    {
      "id": "6792e6aaaff09e0000c057d3",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737680555,
      "updated": 1737680555
    },
    {
      "id": "6792215daff09e0000f4ae30",
      "text": "% git clone https://github.com/takker99/scrapbox-userscript-std",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630046,
      "updated": 1737630046
    },
    {
      "id": "6792215eaff09e0000f4ae31",
      "text": "Roo-Clineに質問する[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630046,
      "updated": 1737630254
    },
    {
      "id": "679221acaff09e0000f4ae33",
      "text": "\t特定のページの特定の内容の行の下に行を追加したい[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630125,
      "updated": 1737630271
    },
    {
      "id": "67922260aff09e0000f4ae37",
      "text": "\t(Roo)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630305,
      "updated": 1737630306
    },
    {
      "id": "679221acaff09e0000f4ae34",
      "text": " \t`/websocket`ディレクトリ内で、行を追加するための操作に関連するコードを見つけました。特に、`applyCommit.ts`や`updateCodeFile.ts`などのファイルに、行を挿入するためのロジックが含まれています。これらのファイルを詳しく調べることで、特定のページに行を追加する方法を理解できるかもしれません。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630125,
      "updated": 1737630308
    },
    {
      "id": "67922226aff09e0000f4ae36",
      "text": " \t\t次に、`applyCommit.ts`ファイルを詳しく調べて、行を追加する具体的な方法を確認します。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630246,
      "updated": 1737630308
    },
    {
      "id": "6792219baff09e0000f4ae32",
      "text": "\t\t`applyCommit.ts`ファイルには、Scrapboxページの行に対してコミット（変更）を適用するための関数`applyCommit`が定義されています。この関数を使用することで、特定のページの特定の内容の行の下に新しい行を追加することが可能です。具体的には、`changes`配列に`_insert`プロパティを持つオブジェクトを追加し、挿入したい位置または`_end`を指定することで、新しい行を追加できます。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630108,
      "updated": 1737630311
    },
    {
      "id": "67922bfa1280f000007dead4",
      "text": "\t(takker)",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737632762,
      "updated": 1737632765
    },
    {
      "id": "67922c071280f000007dead8",
      "text": "\t 行を追加するための操作には、`jsr:@cosense/std/websocket`からexportされている関数`patch`が使えます。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737632775,
      "updated": 1737632832
    },
    {
      "id": "67922c401280f000007deada",
      "text": "\t これは、指定したページの全文を指定したものに一括で書き換える関数です。scrapboxページの行に対してのコミットを直接作成するのは煩雑なため、代わりに変更後のページの内容を指定するだけで変更できるよう設計されています。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737632832,
      "updated": 1737633001
    },
    {
      "id": "679234691280f0000041a5b3",
      "text": "\t 　この設計は[宣言的UI]の考え方を下敷きにしています",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634922,
      "updated": 1737634951
    },
    {
      "id": "679234921280f0000041a5b4",
      "text": "\t 　React Componentが描画してほしい内容を返すと同様、`patch`には書き換え後のページの内容を渡すのです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634962,
      "updated": 1737635021
    },
    {
      "id": "679234cd1280f0000041a5b5",
      "text": "\t 　実際の書き換えは、Reactと同様、内部で差分だけを抽出し、最小限のcommitで更新されるよう処理しています",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737635021,
      "updated": 1737635087
    },
    {
      "id": "67922cea1280f000007deadd",
      "text": "\t 続いて、この`patch`を使って、特定のページの特定の行の下に指定した文字列を挿入する関数`insertLines`を実装します。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633001,
      "updated": 1737633091
    },
    {
      "id": "67922cfc1280f000007deade",
      "text": " \t code:insertLines.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633021,
      "updated": 1737633395
    },
    {
      "id": "679248011280f00000368b56",
      "text": " \t  // Supress errors related to XMLHttpRequest",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639938,
      "updated": 1737639960
    },
    {
      "id": "679248061280f00000368b58",
      "text": " \t  import type {} from \"jsr:/@kitsonk/xhr@0.5/globals\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639942,
      "updated": 1737639972
    },
    {
      "id": "67922cff1280f000007deadf",
      "text": " \t  import { patch, type PatchOptions } from \"jsr:@cosense/std@0.29/websocket\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633024,
      "updated": 1737634658
    },
    {
      "id": "67922d0f1280f000007deae0",
      "text": " \t  ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633039,
      "updated": 1737633382
    },
    {
      "id": "67922d4e1280f000007deae3",
      "text": " \t  export const insertLines = (",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633102,
      "updated": 1737638738
    },
    {
      "id": "67922d5b1280f000007deae4",
      "text": " \t    project: string,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633115,
      "updated": 1737633382
    },
    {
      "id": "67922d5e1280f000007deae6",
      "text": " \t    title: string,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633118,
      "updated": 1737633382
    },
    {
      "id": "67922d631280f000007deae7",
      "text": " \t    targetLineText: string,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633123,
      "updated": 1737633382
    },
    {
      "id": "67922d7d1280f000007deae8",
      "text": " \t    text: string,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633149,
      "updated": 1737633382
    },
    {
      "id": "67922f971280f000007deb09",
      "text": " \t    options?: PatchOptions,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633687,
      "updated": 1737633700
    },
    {
      "id": "67922d5b1280f000007deae5",
      "text": " \t  ) => patch(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633115,
      "updated": 1737633382
    },
    {
      "id": "67922da11280f000007deaeb",
      "text": " \t    project,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633185,
      "updated": 1737633382
    },
    {
      "id": "67922da31280f000007deaec",
      "text": " \t    title,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633188,
      "updated": 1737633382
    },
    {
      "id": "67922da51280f000007deaed",
      "text": " \t    (lines_) => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633188,
      "updated": 1737633382
    },
    {
      "id": "67922dad1280f000007deaee",
      "text": " \t      let index = lines_.findIndex(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633197,
      "updated": 1737633382
    },
    {
      "id": "67922dc11280f000007deaf0",
      "text": " \t        (line) => line.text === targetLineText",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633217,
      "updated": 1737633382
    },
    {
      "id": "67922dc31280f000007deaf1",
      "text": " \t      );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633219,
      "updated": 1737633382
    },
    {
      "id": "67922dcf1280f000007deaf2",
      "text": " \t      index = index < 0 ? lines_.length : index;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633231,
      "updated": 1737633382
    },
    {
      "id": "67922ded1280f000007deaf3",
      "text": " \t      const lines = lines_.map((line) => line.text);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633261,
      "updated": 1737633382
    },
    {
      "id": "67922e121280f000007deaf4",
      "text": " \t      ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633298,
      "updated": 1737633382
    },
    {
      "id": "67922e131280f000007deaf5",
      "text": " \t      return [",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633298,
      "updated": 1737633382
    },
    {
      "id": "67922e141280f000007deaf6",
      "text": " \t        ...lines.slice(0,index + 1),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633300,
      "updated": 1737638349
    },
    {
      "id": "67922e2e1280f000007deaf9",
      "text": " \t        ...text.split(\"\\n\"),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633326,
      "updated": 1737633382
    },
    {
      "id": "67922e281280f000007deaf8",
      "text": " \t        ...lines.slice(index + 1),",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633320,
      "updated": 1737638347
    },
    {
      "id": "67922e171280f000007deaf7",
      "text": " \t      ];",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633303,
      "updated": 1737633382
    },
    {
      "id": "67922db21280f000007deaef",
      "text": " \t    },",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633202,
      "updated": 1737633711
    },
    {
      "id": "67922faf1280f000007deb0a",
      "text": " \t    options,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633711,
      "updated": 1737633712
    },
    {
      "id": "67922e4e1280f000007deafa",
      "text": " \t  );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633358,
      "updated": 1737633382
    },
    {
      "id": "67922e761280f000007deafb",
      "text": " \t　この関数は、`/project/title`内で、`targetLineText`に完全一致する行の下に`text`を挿入します。`targetLineText`が見つからなかったときは、末尾に挿入します。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633399,
      "updated": 1737633471
    },
    {
      "id": "679233441280f0000041a5a9",
      "text": " \t　`patch`にはproject,title,更新関数, optionsの順に引数を渡します",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634628,
      "updated": 1737634669
    },
    {
      "id": "6792336e1280f0000041a5ab",
      "text": " \t　　更新関数では、書き換え後のページの内容を`string[]`で返します",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634669,
      "updated": 1737634698
    },
    {
      "id": "6792338a1280f0000041a5ac",
      "text": " \t　　`string[]`を直接渡すのではなく、関数を介して渡しているのは次の理由からです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634698,
      "updated": 1737634728
    },
    {
      "id": "679233a81280f0000041a5ad",
      "text": " \t　　　`patch`を実行時したときのページの内容をもとに新しいページの中身を作るという操作をしやすくするため",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634728,
      "updated": 1737634758
    },
    {
      "id": "679233c61280f0000041a5ae",
      "text": " \t　　　　これは`insertLines`の実装からも推測できるでしょう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634758,
      "updated": 1737634771
    },
    {
      "id": "679233d21280f0000041a5af",
      "text": " \t　　　書き換えに失敗したとき再試行できるようにするため",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634771,
      "updated": 1737634796
    },
    {
      "id": "679233ed1280f0000041a5b0",
      "text": " \t　　　　単純なネットワークエラーの他、`patch`を実行中に他のユーザが新しいコミットを加えたとき、すでに存在するページとタイトルが被ってしまったときなどに再度実行されます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634796,
      "updated": 1737634870
    },
    {
      "id": "679234361280f0000041a5b1",
      "text": " \t　　　　第2引数に再試行の理由が渡されるので、それをもとに書き換え処理を変えることができます。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634870,
      "updated": 1737634899
    },
    {
      "id": "67922ec21280f000007deafe",
      "text": " \tこの関数の利用例として、[scrapbox-userscript-std/browser/websocket]の`TEST HERE`という行の下に`ワタシCosenseチョットデキル`をインデントを下げて挿入するコードを紹介します",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633474,
      "updated": 1737633581
    },
    {
      "id": "67922f2d1280f000007deaff",
      "text": " \t　code:main-takker.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633581,
      "updated": 1737633586
    },
    {
      "id": "67922f321280f000007deb00",
      "text": " \t　 import { insertLines } from \"./insertLines.ts\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633586,
      "updated": 1737633614
    },
    {
      "id": "67922f481280f000007deb03",
      "text": " \t　 ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633608,
      "updated": 1737633771
    },
    {
      "id": "67922f441280f000007deb02",
      "text": " \t　 await insertLines(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633604,
      "updated": 1737633643
    },
    {
      "id": "67922f6b1280f000007deb04",
      "text": " \t　   \"villagepump\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633643,
      "updated": 1737633649
    },
    {
      "id": "67922f711280f000007deb06",
      "text": " \t　   \"scrapbox-userscript-std%2Fbrowser%2Fwebsocket\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633649,
      "updated": 1737633661
    },
    {
      "id": "67923d9f1280f0000002e492",
      "text": " \t　`\"scrapbox-userscript-std%2Fbrowser%2Fwebsocket\"`じゃなくて`\"scrapbox-userscript-std/browser/websocket\"`で問題なかったの忘れてた[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637279,
      "updated": 1737637305
    },
    {
      "id": "67923db91280f0000002e494",
      "text": " \t　　percent encodingは`patch`がよしなに処理してくれる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637305,
      "updated": 1737637316
    },
    {
      "id": "679240b11280f00000480377",
      "text": " \t　`\"scrapbox-userscript-std/browser/websocket\"`に変えれば、このページにちゃんと書き込まれます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638065,
      "updated": 1737638073
    },
    {
      "id": "6792412f1280f0000048037a",
      "text": " \t　 (変に書き換えるとまずいかと思ってそのままにしてた)",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638191,
      "updated": 1737638224
    },
    {
      "id": "67923da21280f0000002e493",
      "text": " \t　code:main-takker.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637282,
      "updated": 1737637282
    },
    {
      "id": "67922f7d1280f000007deb07",
      "text": " \t　   \"TEST HERE\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633661,
      "updated": 1737633668
    },
    {
      "id": "67922f851280f000007deb08",
      "text": " \t　   \" ワタシCosenseチョットデキル\",",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633669,
      "updated": 1737633680
    },
    {
      "id": "67922fb21280f000007deb0b",
      "text": " \t　   { sid: Deno.env.get(\"CONNECT_SID\")! },",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737633714,
      "updated": 1737637893
    },
    {
      "id": "67922f6c1280f000007deb05",
      "text": " \t　 );",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633644,
      "updated": 1737633682
    },
    {
      "id": "679230061280f000007deb0e",
      "text": " \t このコードは次のコマンドで実行できるかもしれません",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633798,
      "updated": 1737633948
    },
    {
      "id": "679230301280f000007deb0f",
      "text": "  \t $ deno run -A -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633841,
      "updated": 1737633850
    },
    {
      "id": "679230a21280f000007deb15",
      "text": "  \t 実行環境がないため、試すことができません。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633954,
      "updated": 1737634012
    },
    {
      "id": "679230e91280f000007deb17",
      "text": "  \t 静的検査は",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634025,
      "updated": 1737634032
    },
    {
      "id": "679230f01280f000007deb19",
      "text": "  \t 　$ deno check --remote -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634032,
      "updated": 1737634042
    },
    {
      "id": "679230f11280f000007deb1a",
      "text": "  \t でできます。",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634033,
      "updated": 1737634036
    },
    {
      "id": "67923c44aff09e0000c0576b",
      "text": "  \t code:error",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636933,
      "updated": 1737636939
    },
    {
      "id": "67923c4aaff09e0000c0576c",
      "text": "  \t  error: TS2559 [ERROR]: Type '\"{ sid: Deno.env.get(\\\"CONNECT_SID\\\") }\"' has no properties in common with type 'PushOptions'.",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636939,
      "updated": 1737636939
    },
    {
      "id": "67923c4baff09e0000c0576d",
      "text": "       `{ sid: Deno.env.get(\"CONNECT_SID\") }`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636939,
      "updated": 1737636939
    },
    {
      "id": "67923c4baff09e0000c0576e",
      "text": "       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636939,
      "updated": 1737636939
    },
    {
      "id": "67923c4baff09e0000c0576f",
      "text": "         at https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts:8:3",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636939,
      "updated": 1737636939
    },
    {
      "id": "67923c13aff09e0000c0576a",
      "text": "\t\t\t\tふーむ[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636884,
      "updated": 1737636944
    },
    {
      "id": "67923c50aff09e0000c05770",
      "text": "\t\t\t\t\t`sid?: string;`か",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636944,
      "updated": 1737637178
    },
    {
      "id": "67923d39aff09e0000c05771",
      "text": "\t\t\t\t\t`sid: Deno.env.get(\"CONNECT_SID\")!`にかえてみた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637178,
      "updated": 1737637182
    },
    {
      "id": "67923d441280f0000002e48c",
      "text": "\t\t\t\t\t　そっか`!`が必要だった[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637188,
      "updated": 1737637323
    },
    {
      "id": "67923d3daff09e0000c05772",
      "text": "\t\t\t\tcode:error",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637182,
      "updated": 1737637184
    },
    {
      "id": "67923d40aff09e0000c05773",
      "text": "\t\t\t\t % deno check --remote -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637184,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05774",
      "text": "     error: Integrity check failed for remote specifier. The source code is invalid, as it does not match the expected hash in the lock file.",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05775",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05776",
      "text": "       Specifier: https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05777",
      "text": "       Actual: a528530e94f8b0e7576759c33e9105e044c0415658cb5869186e4f120be43b74",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05778",
      "text": "       Expected: c2e6a834a5d567fd94c0c0bfbbf6edc0a2a9d88073d3936e8e432fc527968ddf",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c05779",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c0577a",
      "text": "     This could be caused by:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c0577b",
      "text": "       * the lock file may be corrupt",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c0577c",
      "text": "       * the source itself may be corrupt",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c0577d",
      "text": "     ",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d4baff09e0000c0577e",
      "text": "     Investigate the lockfile; delete it to regenerate the lockfile or --reload to reload the source code from the server.",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637195,
      "updated": 1737637195
    },
    {
      "id": "67923d571280f0000002e48e",
      "text": "    それが出たかー[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637207,
      "updated": 1737637215
    },
    {
      "id": "67923d5f1280f0000002e48f",
      "text": "    　lock fileめんどい",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637215,
      "updated": 1737637220
    },
    {
      "id": "67923d641280f0000002e490",
      "text": "    　`--no-lock`とかいうoptionがあったはず。それ渡せば回避できるはずです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637220,
      "updated": 1737637241
    },
    {
      "id": "67923d7b1280f0000002e491",
      "text": "    　もしくは`deno.lock`を削除してください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637242,
      "updated": 1737637256
    },
    {
      "id": "67923e1aaff09e0000c0577f",
      "text": "    code:error",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637403,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05780",
      "text": "     Warning Workspace member '@cosense/std@0.0.0' was not used because it did not match '@cosense/std@0.29'",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05781",
      "text": "         at https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/insertLines.ts:1:42",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05782",
      "text": "     Check https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std/browser/websocket/main-takker.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05783",
      "text": "     error: TS2559 [ERROR]: Type '\"{ sid: Deno.env.get(\\\"CONNECT_SID\\\")! }\"' has no properties in common with type 'PushOptions'.",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05784",
      "text": "       `{ sid: Deno.env.get(\"CONNECT_SID\")! }`,",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05785",
      "text": "       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1eaff09e0000c05786",
      "text": "         at https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts:8:3",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637406,
      "updated": 1737637406
    },
    {
      "id": "67923e1faff09e0000c05787",
      "text": "\t\t\t\t!をつけてもダメみたい[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637408,
      "updated": 1737637415
    },
    {
      "id": "67923e551280f00000480364",
      "text": "\t\t\t repoの`deno.jsonc`の設定と衝突してますね[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637461,
      "updated": 1737637523
    },
    {
      "id": "67923e671280f00000480365",
      "text": "\t\t\t 　cloneしたrepoの配下でない、適当なdirectoryに移動して、再度実行してください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637479,
      "updated": 1737637527
    },
    {
      "id": "67923ed1aff09e0000c05788",
      "text": "\t\t\t 　\tあー、なるほど[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637586,
      "updated": 1737637596
    },
    {
      "id": "67923f3baff09e0000c05794",
      "text": "\t\t\t 　\trepoの外に出たらXMLHttpRequestが見つからなくなった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637692,
      "updated": 1737637712
    },
    {
      "id": "67923f40aff09e0000c05795",
      "text": "\t\t\t 　\tcode:error",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637697,
      "updated": 1737637699
    },
    {
      "id": "67923f43aff09e0000c05796",
      "text": "\t\t\t 　\t Check https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std/browser/websocket/main-takker.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637699,
      "updated": 1737637699
    },
    {
      "id": "67923f43aff09e0000c05797",
      "text": "       error: TS2304 [ERROR]: Cannot find name 'XMLHttpRequest'.",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637699,
      "updated": 1737637699
    },
    {
      "id": "67923f43aff09e0000c05798",
      "text": "           constructor(createRequest: (opts: RequestOptions) => XMLHttpRequest, uri: string, opts: RequestOptions);",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637699,
      "updated": 1737637699
    },
    {
      "id": "67923f43aff09e0000c05799",
      "text": "                                                                ~~~~~~~~~~~~~~",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637699,
      "updated": 1737637699
    },
    {
      "id": "67923f43aff09e0000c0579a",
      "text": "           at file:///Users/nishio/Library/Caches/deno/npm/registry.npmjs.org/engine.io-client/6.6.3/build/esm/transports/polling-xhr.d.ts:65:58",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637699,
      "updated": 1737637699
    },
    {
      "id": "67923f541280f0000048036d",
      "text": "      えっなんでそのエラーがでるの[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637717,
      "updated": 1737637732
    },
    {
      "id": "67923f641280f0000048036e",
      "text": "      これは[takker.icon]のコードミスの可能性高いな……",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637732,
      "updated": 1737637745
    },
    {
      "id": "67923f711280f0000048036f",
      "text": "      　[socket.io-client]のoptionsをミスってる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637745,
      "updated": 1737637773
    },
    {
      "id": "67923f9d1280f00000480371",
      "text": "      いや、型エラー出てるだけかも",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637789,
      "updated": 1737637806
    },
    {
      "id": "67923faf1280f00000480372",
      "text": "      　`XMLHttpRequest`は使わないはずなので、無視して実行しても問題ないはずです[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637807,
      "updated": 1737637838
    },
    {
      "id": "67923fce1280f00000480373",
      "text": "      　　書き込みに成功しているのはさっき確認しましたし",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637838,
      "updated": 1737637851
    },
    {
      "id": "67923fdf1280f00000480374",
      "text": "      　もちろんエラーが出るのは気持ち悪いので、後日対策考えます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637855,
      "updated": 1737637873
    },
    {
      "id": "679247461280f00000368b4e",
      "text": "      [scrapbox-userscript-std]側で対処するのは難しそう[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639750,
      "updated": 1737639773
    },
    {
      "id": "6792475e1280f00000368b50",
      "text": "      　`XMLHttpRequest`の型エラーが出るのは、server-sideでコードを動かしたときのみ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639774,
      "updated": 1737639795
    },
    {
      "id": "679247731280f00000368b51",
      "text": "      　もしlibrary側で一律に`XMLHttpRequest`の型定義を入れてしまうと、browser向けコードを書くとき、二重定義エラーとなってしまう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639795,
      "updated": 1737639846
    },
    {
      "id": "679247a61280f00000368b53",
      "text": "      ユーザー側で対処するしかない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639846,
      "updated": 1737639859
    },
    {
      "id": "679247b31280f00000368b54",
      "text": "      幸い、　https://jsr.io/@kitsonk/xhr/doc/globals を入れればエラーを抑制できそう",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639859,
      "updated": 1737639916
    },
    {
      "id": "679247ec1280f00000368b55",
      "text": "      　`insertLines.ts`に入れておきます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737639916,
      "updated": 1737639927
    },
    {
      "id": "6792df3d1280f000006ffd1f",
      "text": "       2025-01-24 09:30:55 だめだった。効果ない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737678655,
      "updated": 1737678663
    },
    {
      "id": "67923ea51280f00000480368",
      "text": "\t\t\t type errorは[takker.icon]のコードのミスっぽい[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637541,
      "updated": 1737637556
    },
    {
      "id": "67923eb41280f00000480369",
      "text": "\t\t\t 　調べます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637556,
      "updated": 1737637557
    },
    {
      "id": "67923ef21280f0000048036a",
      "text": "\t\t\t 　いや、まちがってないな……`sid?: string`だし",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637618,
      "updated": 1737637637
    },
    {
      "id": "67923eddaff09e0000c05789",
      "text": "\t\t\t 　code:ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637597,
      "updated": 1737637615
    },
    {
      "id": "67923eecaff09e0000c05793",
      "text": "\t\t\t\t 　export interface BaseOptions {",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637612,
      "updated": 1737637616
    },
    {
      "id": "67923ee7aff09e0000c0578a",
      "text": "       sid?: string;",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637607,
      "updated": 1737637611
    },
    {
      "id": "67923ee7aff09e0000c05792",
      "text": "     ってなってるけど...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637607,
      "updated": 1737637631
    },
    {
      "id": "67923f061280f0000048036b",
      "text": "     `Deno.env.get()`の型定義をみてみます[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637638,
      "updated": 1737637652
    },
    {
      "id": "67923f241280f0000048036c",
      "text": "     いや問題ないな。[Deno.env.get() https://docs.deno.com/api/deno/~/Deno.Env.get]の戻り値は`string | undefined`だからあってる",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637668,
      "updated": 1737637690
    },
    {
      "id": "67923f63aff09e0000c0579b",
      "text": "     [- そこ自信ないんだけど ]`interface {x?: string}`[-  と ]`{x: string | undefined}`[- は別じゃない？][nishio.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637731,
      "updated": 1737637982
    },
    {
      "id": "67923fdeaff09e0000c0579c",
      "text": "     \tていうか`TS2559 [ERROR]: Type '\"{ sid: Deno.env.get(\\\"CONNECT_SID\\\")! }\"' has no properties in common with type 'PushOptions'.`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637854,
      "updated": 1737637864
    },
    {
      "id": "67923fe8aff09e0000c0579e",
      "text": "     \tこれstring literal型では",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637864,
      "updated": 1737637872
    },
    {
      "id": "67924010aff09e0000c0579f",
      "text": "     \tback quote外したら直ったw",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737637904,
      "updated": 1737637913
    },
    {
      "id": "6792400d1280f00000480375",
      "text": "     \t間違えて`\\`\\``で囲んでたのか〜[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637901,
      "updated": 1737637918
    },
    {
      "id": "6792401f1280f00000480376",
      "text": "     \t　気づかなかった",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637919,
      "updated": 1737637920
    },
    {
      "id": "679240fbaff09e0000c057a0",
      "text": "    code::",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638139,
      "updated": 1737638153
    },
    {
      "id": "67924106aff09e0000c057a1",
      "text": "     % deno run -A -r=https://scrapbox.io https://scrapbox.io/api/code/villagepump/scrapbox-userscript-std%2Fbrowser%2Fwebsocket/main-takker.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638151,
      "updated": 1737638151
    },
    {
      "id": "67924106aff09e0000c057a2",
      "text": "     Warning: Not implemented: ClientRequest.options.createConnection",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638151,
      "updated": 1737638151
    },
    {
      "id": "6792410aaff09e0000c057a3",
      "text": "    エラーなく完了したが書き込まれてはいなそう[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737638155,
      "updated": 1737638177
    },
    {
      "id": "67923fe1aff09e0000c0579d",
      "text": "    　[scrapbox-userscript-std/browser/websocket#679240b11280f00000480377][takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737637858,
      "updated": 1737638172
    },
    {
      "id": "6792410e1280f00000480378",
      "text": "  `{ sid: Deno.env.get(\"CONNECT_SID\")! }`,",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737638158,
      "updated": 1737638158
    },
    {
      "id": "67923b2baff09e0000c0575e",
      "text": "  \t注意点として、[connect.sid]を環境変数`CONNECT_SID`に与える必要があります",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636651,
      "updated": 1737637408
    },
    {
      "id": "679230571280f000007deb12",
      "text": "  \t　与え方は一般的なshellscriptと同じです",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633879,
      "updated": 1737633893
    },
    {
      "id": "679230651280f000007deb13",
      "text": "  \t　[.env]ファイルも使えます",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633893,
      "updated": 1737633901
    },
    {
      "id": "6792306d1280f000007deb14",
      "text": "  \t　　方法は[公式docs https://docs.deno.com/runtime/reference/env_variables/#.env-file]を参照ください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737633901,
      "updated": 1737633928
    },
    {
      "id": "67922264aff09e0000f4ae38",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630309,
      "updated": 1737630309
    },
    {
      "id": "6792229aaff09e0000c05605",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630363,
      "updated": 1737630363
    },
    {
      "id": "6792229baff09e0000c05606",
      "text": "TEST HERE",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630363,
      "updated": 1737630365
    },
    {
      "id": "6792229daff09e0000c05608",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630366,
      "updated": 1737630366
    },
    {
      "id": "6792259daff09e0000c05658",
      "text": "Roo Clineが生成したサンプル",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631134,
      "updated": 1737631141
    },
    {
      "id": "67922454aff09e0000c05609",
      "text": "\t(deleted)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630805,
      "updated": 1737631604
    },
    {
      "id": "67922571aff09e0000c0561a",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631089,
      "updated": 1737631089
    },
    {
      "id": "67922454aff09e0000c0560a",
      "text": "これはどうやって実行したらいい？[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630805,
      "updated": 1737630807
    },
    {
      "id": "67922456aff09e0000c0560b",
      "text": "(Roo)",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630807,
      "updated": 1737630809
    },
    {
      "id": "6792229baff09e0000c05607",
      "text": "\twebsocket/scrapboxApiSample.tsを実行するには、Denoを使用します。以下の手順で実行できます。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630364,
      "updated": 1737630823
    },
    {
      "id": "67922467aff09e0000c0560c",
      "text": " Denoがインストールされていない場合は、Denoの公式サイトからインストールしてください。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630823,
      "updated": 1737630825
    },
    {
      "id": "67922467aff09e0000c0560e",
      "text": " ターミナルを開き、websocket/scrapboxApiSample.tsがあるディレクトリに移動します。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630823,
      "updated": 1737630823
    },
    {
      "id": "67922467aff09e0000c0560f",
      "text": " 次のコマンドを実行してスクリプトを実行します:",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630823,
      "updated": 1737630823
    },
    {
      "id": "67922467aff09e0000c05610",
      "text": " $ deno run --allow-net=api.scrapbox.io websocket/scrapboxApiSample.ts",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630823,
      "updated": 1737630831
    },
    {
      "id": "67922467aff09e0000c05611",
      "text": " このコマンドは、ネットワークアクセスを許可し、Scrapbox APIにアクセスしてページを更新します。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630823,
      "updated": 1737630823
    },
    {
      "id": "679224eeaff09e0000c05612",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630959,
      "updated": 1737630959
    },
    {
      "id": "679224eeaff09e0000c05613",
      "text": "エラーになった",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630959,
      "updated": 1737631154
    },
    {
      "id": "679224efaff09e0000c05614",
      "text": " Response status: 403",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630959,
      "updated": 1737631155
    },
    {
      "id": "679224efaff09e0000c05615",
      "text": " Response text: {\"name\":\"SessionError\",\"message\":\"Your session has been expired. Please reload. (CSRF Token does not match)\"}",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630960,
      "updated": 1737631155
    },
    {
      "id": "679224efaff09e0000c05616",
      "text": " Error: Error: Failed to update the page",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630960,
      "updated": 1737631155
    },
    {
      "id": "679224efaff09e0000c05617",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630960,
      "updated": 1737630960
    },
    {
      "id": "679226c4aff09e0000c05659",
      "text": "コードを読んだらapplyCommitを使ってないじゃん？？",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631428,
      "updated": 1737631438
    },
    {
      "id": "679224f0aff09e0000c05618",
      "text": "\tそこを突っ込んだら書き直してくれた",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737630961,
      "updated": 1737631548
    },
    {
      "id": "6792273baff09e0000c0565b",
      "text": "\t`Error: SyntaxError: \"newLine\" is an invalid id.`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631548,
      "updated": 1737631551
    },
    {
      "id": "6792273baff09e0000c0565a",
      "text": "\tvalidなIDをつけないとダメそう",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631548,
      "updated": 1737631596
    },
    {
      "id": "67922914aff09e0000c056a8",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632020,
      "updated": 1737632020
    },
    {
      "id": "679227ddaff09e0000b3e241",
      "text": "一ポモドーロでできるようにならなかったから保留[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631709,
      "updated": 1737631729
    },
    {
      "id": "679227e8aff09e0000b3e242",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737631720,
      "updated": 1737632027
    },
    {
      "id": "67922922aff09e0000c056ab",
      "text": "validなline idを生成する方法がコードのどこかにあるはずです[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632035,
      "updated": 1737636577
    },
    {
      "id": "67922924aff09e0000c056ad",
      "text": "\t(Roo)websocket/id.tsファイルに、createNewLineIdという関数が定義されています。この関数を使用して、有効な行IDを生成できます。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632037,
      "updated": 1737632045
    },
    {
      "id": "6792292daff09e0000c056ae",
      "text": "\tなるほど！",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632046,
      "updated": 1737632048
    },
    {
      "id": "67922930aff09e0000c056af",
      "text": "\t`Error: SyntaxError: \"67922949user0000009671aa\" is an invalid id.`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632048,
      "updated": 1737632098
    },
    {
      "id": "67922963aff09e0000c056b0",
      "text": "\tダメじゃん...",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632099,
      "updated": 1737632102
    },
    {
      "id": "67922966aff09e0000c056b1",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632102,
      "updated": 1737632102
    },
    {
      "id": "679229bbaff09e0000c05700",
      "text": "createNewLineIdに渡すべきuserIdの取得方法があるはずです[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632188,
      "updated": 1737636579
    },
    {
      "id": "679229bcaff09e0000c05701",
      "text": "\t(Roo)websocket/pull.tsファイルにgetUserId関数が定義されています。この関数を使用して、現在のユーザーIDを取得できます。この関数をwebsocket/scrapboxApiSample.tsに組み込んで、ユーザーIDを取得するようにコードを修正します。",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632188,
      "updated": 1737632199
    },
    {
      "id": "679229c7aff09e0000c05702",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632199,
      "updated": 1737632199
    },
    {
      "id": "679229faaff09e0000c05703",
      "text": "`error: Uncaught SyntaxError: The requested module './pull.ts' does not provide an export named 'getUserId'`",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632251,
      "updated": 1737632252
    },
    {
      "id": "679229fdaff09e0000c05704",
      "text": "\t泥沼だ！[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632253,
      "updated": 1737632264
    },
    {
      "id": "67922bc51280f000007dead1",
      "text": "わかりやすいdocs用意してなくてマジごめんなさい……[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737632708,
      "updated": 1737632726
    },
    {
      "id": "679229fdaff09e0000c05705",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737632253,
      "updated": 1737632253
    },
    {
      "id": "679231291280f000007deb1b",
      "text": "[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634089,
      "updated": 1737634096
    },
    {
      "id": "679231301280f000007deb1c",
      "text": "　[jsr: specifier]でimportしなければならない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634096,
      "updated": 1737634118
    },
    {
      "id": "679231771280f000007deb20",
      "text": "　　ん？[scrapbox-userscript-std]をlocalにcloneして書いているのか",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634167,
      "updated": 1737634193
    },
    {
      "id": "679231911280f000007deb21",
      "text": "　　　それならパスは通るか",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634193,
      "updated": 1737634201
    },
    {
      "id": "679231b91280f000007deb22",
      "text": "　`applyCommit`や`createNewLineId`はprivate functionsで、外部から使うことは想定していない",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634233,
      "updated": 1737634261
    },
    {
      "id": "679231d51280f000007deb23",
      "text": "　　だからjsr経由ではimportできないようにしてある",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634261,
      "updated": 1737634276
    },
    {
      "id": "679231e41280f000007deb24",
      "text": "　　今回はrepoをcloneして使ってしまっているため、制限を突破して使えてしまっている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634276,
      "updated": 1737634298
    },
    {
      "id": "679231461280f000007deb1e",
      "text": "　APIの使い方が誤っている",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1737634118,
      "updated": 1737634125
    },
    {
      "id": "6792314d1280f000007deb1f",
      "text": "　 [api/pages/:projectname/:pagetitle]にPOSTしても書き換えられない",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737634125,
      "updated": 1737636042
    },
    {
      "id": "679238c9aff09e0000c0575a",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636042,
      "updated": 1737636042
    },
    {
      "id": "679238c9aff09e0000c0575b",
      "text": "上記の内容を再度Roo Clineに与えてみる[nishio.icon]",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636042,
      "updated": 1737636054
    },
    {
      "id": "679238d6aff09e0000c0575d",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636054,
      "updated": 1737636054
    },
    {
      "id": "679238ceaff09e0000c0575c",
      "text": "",
      "userId": "582e63d27c56960011aff09e",
      "created": 1737636047,
      "updated": 1737636047
    }
  ]
}