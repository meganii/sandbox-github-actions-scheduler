{
  "id": "61302474c678f8001de75d9b",
  "title": "井戸端の底",
  "created": 1630545017,
  "updated": 1722150281,
  "lines": [
    {
      "id": "61302474c678f8001de75d9b",
      "text": "井戸端の底",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630545017,
      "updated": 1630545019
    },
    {
      "id": "6130247d79e1130000132133",
      "text": "　井戸端のlast updated順で一番下の方にあるページって何だろう[blu3mo.icon]",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630545021,
      "updated": 1646747117
    },
    {
      "id": "6130249e79e1130000132135",
      "text": "　　[死んだテキスト]が堆積しているはず",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630545054,
      "updated": 1630545075
    },
    {
      "id": "613040201280f000002d7f2a",
      "text": "　　ほい[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552096,
      "updated": 1630552099
    },
    {
      "id": "613040231280f000002d7f2b",
      "text": "　　 code:js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552099,
      "updated": 1630552101
    },
    {
      "id": "613040251280f000002d7f2c",
      "text": "　　  import {browse} from \"https://scrapbox.io/api/code/villagepump/井戸端の底/browse.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552101,
      "updated": 1630552932
    },
    {
      "id": "613040291280f000002d7f2d",
      "text": "    ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552105,
      "updated": 1630552105
    },
    {
      "id": "613040291280f000002d7f2e",
      "text": "    await browse(\"updated\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552105,
      "updated": 1630552947
    },
    {
      "id": "613029a479e11300004a5048",
      "text": " last visitedの一番下も気になる",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630546341,
      "updated": 1630546356
    },
    {
      "id": "6130402b1280f000002d7f30",
      "text": "  ほい[takker.icon]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552107,
      "updated": 1630552108
    },
    {
      "id": "61303f541280f000002d7f24",
      "text": "   code:js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551892,
      "updated": 1630552110
    },
    {
      "id": "61303f621280f000002d7f25",
      "text": "    import {browse} from \"https://scrapbox.io/api/code/villagepump/井戸端の底/browse.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551906,
      "updated": 1630552960
    },
    {
      "id": "6130426d1280f000002d7f41",
      "text": "    ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552685,
      "updated": 1630552685
    },
    {
      "id": "6130426d1280f000002d7f42",
      "text": "    await browse(\"accessed\");",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552685,
      "updated": 1630552973
    },
    {
      "id": "6130299d79e11300004a5047",
      "text": "",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630546333,
      "updated": 1630546333
    },
    {
      "id": "613024b379e1130000132136",
      "text": "　井戸端の井戸の底？",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630545076,
      "updated": 1630546332
    },
    {
      "id": "62358fae5e90c00000a5e244",
      "text": "　[深淵]",
      "userId": "60508ed36a7abc00235e90c0",
      "created": 1647677358,
      "updated": 1647677365
    },
    {
      "id": "6130247e79e1130000132134",
      "text": "",
      "userId": "5d89b1f60230ae001779e113",
      "created": 1630545022,
      "updated": 1630545022
    },
    {
      "id": "613046631280f00000647f28",
      "text": "code:browse.d.ts",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630553699,
      "updated": 1630553705
    },
    {
      "id": "613046711280f00000647f2a",
      "text": " export type SortOptions = \"updated\" | \"accessed\" | \"views\" | \"created\" | \"linked\" | \"pageRank\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630553713,
      "updated": 1630553760
    },
    {
      "id": "6130469c1280f00000647f2b",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630553757,
      "updated": 1630553757
    },
    {
      "id": "613046691280f00000647f29",
      "text": " export function browse(type: SortOptions, project?: string): Promise<void>;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630553705,
      "updated": 1630553774
    },
    {
      "id": "6130430f1280f000002d7f4c",
      "text": "code:browse.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552847,
      "updated": 1630552859
    },
    {
      "id": "613043301280f000002d7f50",
      "text": " import {fetchPages} from \"https://scrapbox.io/api/code/villagepump/井戸端の底/fetch.js\";",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552880,
      "updated": 1630552881
    },
    {
      "id": "613043311280f000002d7f51",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552881
    },
    {
      "id": "613043341280f000002d7f61",
      "text": " export async function browse(type, project = scrapbox.Project.name) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552884,
      "updated": 1630552903
    },
    {
      "id": "613043311280f000002d7f52",
      "text": "   const pages = await fetchPages(project);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552906
    },
    {
      "id": "613043311280f000002d7f53",
      "text": "   const messages = pages",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552888
    },
    {
      "id": "613043311280f000002d7f54",
      "text": "     .sort((a, b) => a[type] - b[type])",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552916
    },
    {
      "id": "613043311280f000002d7f55",
      "text": "     .map(({title}) => title);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552888
    },
    {
      "id": "613043311280f000002d7f56",
      "text": "     ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552888
    },
    {
      "id": "613043311280f000002d7f57",
      "text": "   console.log(messages);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552888
    },
    {
      "id": "613043311280f000002d7f58",
      "text": "   alert(messages.map((title, index) => `${index + 1}\\t${title}`).join(\"\\n\"));",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552888
    },
    {
      "id": "613043361280f000002d7f62",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552886,
      "updated": 1630552886
    },
    {
      "id": "613043311280f000002d7f59",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552881,
      "updated": 1630552881
    },
    {
      "id": "613043861280f000002d7f7c",
      "text": "[alert()]で表示できる最大文字数を軽く超えてしまったので、正確なリストはコンソールの方を見てください",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552966,
      "updated": 1630552979
    },
    {
      "id": "6130430f1280f000002d7f4b",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552847,
      "updated": 1630552847
    },
    {
      "id": "61303f1a1280f000002d7f09",
      "text": "code:fetch.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551834,
      "updated": 1630551899
    },
    {
      "id": "61303f1d1280f000002d7f0b",
      "text": " export async function fetchPages(project) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551848
    },
    {
      "id": "61303f1d1280f000002d7f10",
      "text": "   const pageNum = await getProjectPageCount(project); //取得するページ数",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551855
    },
    {
      "id": "61303f1d1280f000002d7f11",
      "text": "   const limitParam = pageNum > 1000 ? 1000 : pageNum; // APIで一度に取得するページ数",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551837
    },
    {
      "id": "61303f1d1280f000002d7f12",
      "text": "   const maxIndex = pageNum > 1000 ? Math.floor(pageNum / 1000) + 1 : 1; // APIを叩く回数",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551837
    },
    {
      "id": "61303f501280f000002d7f23",
      "text": "   ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551888,
      "updated": 1630551888
    },
    {
      "id": "61303f1d1280f000002d7f17",
      "text": "   // 一気にAPIを叩いてページ情報を取得する",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551837
    },
    {
      "id": "61303f1d1280f000002d7f18",
      "text": "   return (",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630552264
    },
    {
      "id": "613040c81280f000002d7f34",
      "text": "     await Promise.all(",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552264,
      "updated": 1630552267
    },
    {
      "id": "613040cb1280f000002d7f35",
      "text": "       [...Array(maxIndex).keys()]",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552267,
      "updated": 1630552338
    },
    {
      "id": "61303f1d1280f000002d7f19",
      "text": "         .map(async (index) => {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630552341
    },
    {
      "id": "61303f1d1280f000002d7f1a",
      "text": "           const res = await fetch(`/api/pages/${project}/?limit=${limitParam}&skip=${index*1000}`);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630552272
    },
    {
      "id": "613040a41280f000002d7f32",
      "text": "           const {pages} = await res.json();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552228,
      "updated": 1630552272
    },
    {
      "id": "613040ad1280f000002d7f33",
      "text": "           return pages;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552237,
      "updated": 1630552272
    },
    {
      "id": "61303f1d1280f000002d7f1d",
      "text": "         })",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630552273
    },
    {
      "id": "613040d11280f000002d7f36",
      "text": "     )",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552273,
      "updated": 1630552299
    },
    {
      "id": "613040db1280f000002d7f37",
      "text": "   ).flat();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552283,
      "updated": 1630552300
    },
    {
      "id": "61303f1d1280f000002d7f22",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551837,
      "updated": 1630551837
    },
    {
      "id": "613040731280f000002d7f31",
      "text": " ",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630552179,
      "updated": 1630552179
    },
    {
      "id": "61303f1a1280f000002d7f0a",
      "text": "",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551834,
      "updated": 1630551834
    },
    {
      "id": "61303ed71280f000002d7efd",
      "text": "code:fetch.js",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551766,
      "updated": 1630551903
    },
    {
      "id": "61303f031280f000002d7eff",
      "text": " async function getProjectPageCount(project) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551810,
      "updated": 1630551818
    },
    {
      "id": "61303f031280f000002d7f00",
      "text": "   try {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f01",
      "text": "     const response = await fetch(`/api/pages/${project}/?limit=1`);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f02",
      "text": "     if(!response.ok) throw Error(`Invalid response. status code: ${response.status}`);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f03",
      "text": "     const json = await response.json();",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f04",
      "text": "     return parseInt(json.count);",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f05",
      "text": "   } catch(e) {",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f06",
      "text": "    throw e;",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f07",
      "text": "   }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "61303f031280f000002d7f08",
      "text": " }",
      "userId": "5ef2bdebb60650001e1280f0",
      "created": 1630551811,
      "updated": 1630551811
    },
    {
      "id": "66a5ed8671b3c200001508f3",
      "text": "",
      "userId": "661b6e882a96e9002371b3c2",
      "created": 1722150279,
      "updated": 1722150279
    }
  ]
}